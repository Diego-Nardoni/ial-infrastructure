AWSTemplateFormatVersion: '2010-09-09'
Description: 'IAL RAG Storage - S3 bucket for knowledge base and vector indices'

Parameters:
  ProjectName:
    Type: String
    Default: ial-fork
    Description: Project name for resource naming

Resources:
  # S3 Bucket for RAG Knowledge Base
  RAGStorageBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${ProjectName}-rag-store-${AWS::AccountId}'
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      VersioningConfiguration:
        Status: Enabled
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Component
          Value: IAL-Foundation
        - Key: Purpose
          Value: RAGStorage

  # S3 Bucket for vector indices
  VectorIndicesBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${ProjectName}-rag-storage-indices-${AWS::AccountId}'
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Component
          Value: IAL-Foundation
        - Key: Purpose
          Value: VectorIndices

Outputs:
  RAGStorageBucketName:
    Description: Name of the RAG storage bucket
    Value: !Ref RAGStorageBucket
    Export:
      Name: !Sub '${ProjectName}-41-RAGStorageBucketName'
  
  VectorIndicesBucketName:
    Description: Name of the vector indices bucket
    Value: !Ref VectorIndicesBucket
    Export:
      Name: !Sub '${ProjectName}-41-VectorIndicesBucketName'
