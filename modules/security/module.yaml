module:
  name: "security"
  version: "1.0.0"
  description: "Security and compliance components - KMS, IAM, secrets, WAF"
  author: "IaL Framework"
  
metadata:
  category: "security"
  maturity: "stable"
  dependencies: ["foundation"]
  parallel_safe: true
  estimated_duration: "30min"
  team_owner: "security-team"
  risk_level: "high"

interface:
  inputs:
    required:
      - project_name: 
          type: "string"
          description: "Project name for resource naming"
      - environment:
          type: "string" 
          description: "Environment (dev/staging/prod)"
          allowed_values: ["dev", "staging", "prod"]
    optional:
      - kms_key_rotation:
          type: "boolean"
          default: true
          description: "Enable KMS key rotation"
      - enable_waf:
          type: "boolean"
          default: true
          description: "Deploy WAF protection"
      - alert_email:
          type: "string"
          description: "Email for security alerts"

  outputs:
    - kms_key_id:
        description: "KMS key ID for encryption"
        export_name: "${project_name}-kms-key-id"
    - security_group_ids:
        description: "Security group IDs created"
        export_name: "${project_name}-security-groups"
    - iam_roles:
        description: "IAM roles created"
        export_name: "${project_name}-iam-roles"

phases:
  - name: "kms-security"
    file: "phases/01-kms-security.yaml"
    description: "KMS encryption setup"
    dependencies: []
  - name: "security-services" 
    file: "phases/02-security-services.yaml"
    description: "Security services configuration"
    dependencies: ["kms-security"]
  - name: "secrets-manager"
    file: "phases/03-secrets-manager.yaml"
    description: "Secrets Manager setup"
    dependencies: ["kms-security"]
  - name: "iam-roles"
    file: "phases/04-iam-roles.yaml"
    description: "IAM roles and policies"
    dependencies: ["kms-security"]
  - name: "iam-bedrock-github"
    file: "phases/05-iam-bedrock-github.yaml"
    description: "Bedrock and GitHub IAM integration"
    dependencies: ["iam-roles"]
  - name: "waf-cloudfront"
    file: "phases/06-waf-cloudfront.yaml"
    description: "WAF and CloudFront protection"
    dependencies: ["security-services"]

validation:
  pre_deploy:
    - check: "aws sts get-caller-identity"
      description: "Verify AWS credentials"
    - check: "aws kms list-keys --limit 1"
      description: "Verify KMS access"
  post_deploy:
    - check: "aws kms describe-key --key-id ${kms_key_id}"
      description: "Verify KMS key creation"
    - check: "aws iam list-roles --path-prefix /${project_name}/"
      description: "Verify IAM roles creation"

rollback:
  strategy: "reverse_order"
  phases:
    - "waf-cloudfront"
    - "iam-bedrock-github" 
    - "iam-roles"
    - "secrets-manager"
    - "security-services"
    - "kms-security"
