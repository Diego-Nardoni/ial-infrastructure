{
  "phase_number": 50,
  "phase_name": "storage",
  "yaml_content": "```yaml\nAWSTemplateFormatVersion: '2010-09-09'\nDescription: Bucket S3 com encripta\u00e7\u00e3o de dados em repouso e em tr\u00e2nsito, pol\u00edticas de ciclo de vida e rastreamento\nParameters:\n  BucketName:\n    Type: String\n    Default: ial-s3-bucket\n    Description: Nome do bucket S3\n  DeletionPolicy:\n    Type: String\n    Default: Retain\n    AllowedValues:\n      - Delete\n      - Retain\n    Description: Pol\u00edtica de dele\u00e7\u00e3o do bucket\n\nResources:\n  S3Bucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Ref BucketName\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      LifecycleConfiguration:\n        Rules:\n          - Id: DeleteOldObjects\n            Status: Enabled\n            Transitions:\n              - StorageClass: Glacier\n                TransitionInDays: 90\n            ExpirationInDays: 365\n      VersioningConfiguration:\n        Status: Enabled\n      LoggingConfiguration:\n        DestinationBucketName: !Ref LogBucket\n        LogFilePrefix: s3-logs/\n      DeletionPolicy: !Ref DeletionPolicy\n      Tags:\n        - Key: ManagedBy\n          Value: IAL  \n        - Key: CreatedAt\n          Value: '2025-12-01T14:56:11.593552'\n\n  LogBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${AWS::StackName}-logs'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      VersioningConfiguration:\n        Status: Enabled\n      DeletionPolicy: !Ref DeletionPolicy\n      Tags:\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:56:11.593552'\n\n  BucketPolicy:\n    Type: AWS::S3::BucketPolicy\n    Properties:\n      Bucket: !Ref S3Bucket\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Sid: DenyUnEncryptedObjectUploads\n            Effect: Deny\n            Principal: '*'\n            Action: 's3:PutObject'\n            Resource: \n              !Sub 'arn:aws:s3:::${S3Bucket}/*'\n            Condition:\n              Bool:\n                'aws:SecureTransport': 'false'\n          - Sid: DenyInsecureConnections\n            Effect: Deny\n            Principal: '*'\n            Action: 's3:*'\n            Resource: \n              !Sub 'arn:aws:s3:::${S3Bucket}/*'\n            Condition:\n              Bool:\n                'aws:SecureTransport': 'false'\n            \nOutputs:\n  S3BucketName:\n    Value: !Ref S3Bucket\n    Description: Nome do bucket S3\n    Export:\n      Name: !Sub '${AWS::StackName}-S3BucketName'\n```",
  "dependencies": [],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T14:56:24.299235"
}