{
  "phase_number": 50,
  "phase_name": "storage",
  "yaml_content": "```yaml\n# Recurso: S3 Bucket\n# Descri\u00e7\u00e3o: Cria um S3 Bucket criptografado com KMS, logs de acesso e lifecycle policy\n\nParameters:\n  EnvironmentName:\n    Description: 'Nome do ambiente (e.g. dev, staging, prod)'\n    Type: String\n\nResources:\n\n  # Cria o bucket S3\n  S3Bucket:\n    Type: 'AWS::S3::Bucket'\n    Properties:\n      # Habilita versionamento\n      VersioningConfiguration:\n        Status: Enabled\n      # Criptografia KMS\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: 'aws:kms'\n      # Bucket Policy para permitir acesso apenas a contas/roles permitidas\n      BucketPolicy:\n        PolicyDocument:\n          Version: '2012-10-17'\n          Statement:\n            - Sid: 'DenyUnEncryptedObjectUploads'\n              Effect: 'Deny'\n              Principal: '*'\n              Action: 's3:PutObject'\n              Resource: !Join\n                - ''\n                - - !GetAtt 'S3Bucket.Arn'\n                  - '/*'\n              Condition:\n                StringNotEquals:\n                  's3:x-amz-server-side-encryption': 'aws:kms'\n            - Sid: 'DenyInsecureConnections'\n              Effect: 'Deny'\n              Principal: '*'\n              Action: 's3:*'\n              Resource: !Join\n                - ''\n                - - !GetAtt 'S3Bucket.Arn'\n                  - '/*'\n              Condition:\n                Bool:\n                  'aws:SecureTransport': 'false'\n      # Logs de acesso\n      AccessControl: LogDeliveryWrite\n      # Lifecycle policy para otimizar custos\n      LifecycleConfiguration:\n        Rules:\n          - Id: MoveToInfrequentAccessStorage\n            Status: Enabled\n            Transitions:\n              - StorageClass: Glacier\n                TransitionInDays: 90\n          - Id: DeleteObjectsOlderThanXYears\n            Status: Enabled\n            ExpirationInDays: 3650\n\n    # Tags\n    Metadata:\n      'aws:cdk:path': ${EnvironmentName}/s3/S3Bucket\n    DeletionPolicy: Retain\n    UpdateReplacePolicy: Retain\n    Metadata:\n      'aws:asset:path': /asset.789abcdefedcba/S3Bucket\n      'aws:asset:artifact': '050909090909090909090'\n    Tags:\n      - Key: 'ManagedBy'\n        Value: 'IAL'\n      - Key: 'CreatedAt'\n        Value: '2025-12-01T14:40:25.552295'\n\nOutputs:\n\n  # Export S3 Bucket Name\n  S3BucketName:\n    Value: !Ref 'S3Bucket'\n    Export:\n      Name: !Sub '${EnvironmentName}-s3-bucket-name'\n```",
  "dependencies": [],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T14:40:36.945607"
}