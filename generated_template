{
  "phase_number": 50,
  "phase_name": "storage",
  "yaml_content": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: Simple S3 bucket with encryption, logging, and lifecycle policies.\n\nParameters:\n  Environment:\n    Type: String\n    Default: dev\n    AllowedValues:\n      - dev\n      - staging\n      - prod\n    Description: Environment name\n\nResources:\n\n  # KMS Key for encryption\n  EncryptionKey:\n    Type: AWS::KMS::Key\n    Properties:\n      Description: KMS Key for S3 bucket encryption\n      KeyPolicy:\n        Version: '2012-10-17'\n        Id: key-default-1\n        Statement:\n          - Sid: Enable IAM User Permissions\n            Effect: Allow\n            Principal:\n              AWS: !Join\n                - ''\n                - - 'arn:aws:iam::'\n                  - !Ref 'AWS::AccountId'\n                  - ':root'\n            Action: 'kms:*'\n            Resource: '*'\n\n  # S3 Bucket\n  S3Bucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub 's3-bucket-${Environment}-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: 'aws:kms'\n              KMSMasterKeyID: !Ref EncryptionKey\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      LoggingConfiguration:\n        DestinationBucketName: !Sub 's3-access-logs-${Environment}-${AWS::AccountId}'\n        LogFilePrefix: 's3-bucket-logs/'\n      LifecycleConfiguration:\n        Rules:\n          - Id: ExpirationRule\n            Status: Enabled\n            Transitions:\n              - StorageClass: Glacier\n                TransitionInDays: 365\n            ExpirationInDays: 730\n\n  # S3 Access Logs bucket\n  S3AccessLogsBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub 's3-access-logs-${Environment}-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: 'aws:kms'\n              KMSMasterKeyID: !Ref EncryptionKey\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n\nOutputs:\n\n  S3BucketName:\n    Description: Name of the S3 bucket\n    Value: !Ref S3Bucket\n    Export:\n      Name: !Sub '${AWS::StackName}-S3BucketName'\n\n  S3BucketArn:\n    Description: ARN of the S3 bucket\n    Value: !GetAtt S3Bucket.Arn\n    Export:\n      Name: !Sub '${AWS::StackName}-S3BucketArn'\n\nMetadata:\n  AWS::CloudFormation::Interface:\n    ParameterGroups:\n      - Label:\n          default: Environment Configuration\n        Parameters:\n          - Environment\n\nConditions:\n  IsProd: !Equals [ !Ref Environment, prod ]\n\nMetadata:\n  ManagedBy: IAL\n  CreatedAt: '2025-11-18T19:38:49.523044'",
  "dependencies": [],
  "estimated_cost": 0.0,
  "created_at": "2025-11-18T19:39:05.827519"
}