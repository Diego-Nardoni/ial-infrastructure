{
  "phase_number": 99,
  "phase_name": "custom",
  "yaml_content": "---\n# --------------------------------------------------\n# Parameters\n# --------------------------------------------------\nParameters:\n\n  EnvironmentName:\n    Description: An environment name that will be prefixed to resource names\n    Type: String\n    Default: production\n\n  VPC_CIDR:\n    Description: Please enter the IP range (CIDR notation) for this VPC\n    Type: String\n    Default: 10.0.0.0/16\n\n  PublicSubnet1CIDR:\n    Description: Please enter the IP range (CIDR notation) for the public subnet in the first Availability Zone\n    Type: String\n    Default: 10.0.0.0/24\n\n  PublicSubnet2CIDR:\n    Description: Please enter the IP range (CIDR notation) for the public subnet in the second Availability Zone\n    Type: String\n    Default: 10.0.1.0/24\n\n  PrivateSubnet1CIDR:\n    Description: Please enter the IP range (CIDR notation) for the private subnet in the first Availability Zone\n    Type: String\n    Default: 10.0.2.0/24\n\n  PrivateSubnet2CIDR:\n    Description: Please enter the IP range (CIDR notation) for the private subnet in the second Availability Zone\n    Type: String\n    Default: 10.0.3.0/24\n\n# --------------------------------------------------\n# Resources\n# --------------------------------------------------\nResources:\n\n  # VPC\n  VPC:\n    Type: AWS::EC2::VPC\n    Properties:\n      CidrBlock: !Ref VPC_CIDR\n      EnableDnsHostnames: true\n      EnableDnsSupport: true\n      InstanceTenancy: default\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-VPC\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Internet Gateway\n  InternetGateway:\n    Type: AWS::EC2::InternetGateway\n    Properties:\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-IGW\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Attach Internet Gateway to VPC\n  InternetGatewayAttachment:\n    Type: AWS::EC2::VPCGatewayAttachment\n    Properties:\n      InternetGatewayId: !Ref InternetGateway\n      VpcId: !Ref VPC\n\n  # EIP for NAT Gateway\n  NatGatewayEIP:\n    Type: AWS::EC2::EIP\n    Properties:\n      Domain: vpc\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-NatGatewayEIP\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # NAT Gateway\n  NatGateway:\n    Type: AWS::EC2::NatGateway\n    Properties:\n      AllocationId: !GetAtt NatGatewayEIP.AllocationId\n      SubnetId: !Ref PublicSubnet1\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-NatGateway\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Public Subnet 1\n  PublicSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet1CIDR\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PublicSubnet1\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Public Subnet 2\n  PublicSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet2CIDR\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PublicSubnet2\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Private Subnet 1\n  PrivateSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet1CIDR\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PrivateSubnet1\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Private Subnet 2\n  PrivateSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet2CIDR\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PrivateSubnet2\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Security Group for Public Resources\n  PublicSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Allow HTTP and SSH inbound traffic\n      SecurityGroupIngress:\n        - IpProtocol: tcp\n          FromPort: 80\n          ToPort: 80\n          CidrIp: 0.0.0.0/0\n        - IpProtocol: tcp\n          FromPort: 22\n          ToPort: 22\n          CidrIp: 0.0.0.0/0\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PublicSecurityGroup\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Security Group for Private Resources\n  PrivateSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Allow inbound traffic from public security group\n      SecurityGroupIngress:\n        - IpProtocol: -1\n          SourceSecurityGroupId: !Ref PublicSecurityGroup\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PrivateSecurityGroup\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Route Table for Public Subnets\n  PublicRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PublicRouteTable\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Route for Internet Gateway\n  PublicRoute:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PublicRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      GatewayId: !Ref InternetGateway\n\n  # Associate Public Subnet 1 with Public Route Table\n  PublicSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet1\n      RouteTableId: !Ref PublicRouteTable\n\n  # Associate Public Subnet 2 with Public Route Table\n  PublicSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet2\n      RouteTableId: !Ref PublicRouteTable\n\n  # Route Table for Private Subnets\n  PrivateRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-PrivateRouteTable\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n  # Route for NAT Gateway\n  PrivateRoute:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PrivateRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      NatGatewayId: !Ref NatGateway\n\n  # Associate Private Subnet 1 with Private Route Table\n  PrivateSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet1\n      RouteTableId: !Ref PrivateRouteTable\n\n  # Associate Private Subnet 2 with Private Route Table\n  PrivateSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet2\n      RouteTableId: !Ref PrivateRouteTable\n\n  # KMS Key for Encryption\n  KMSKey:\n    Type: AWS::KMS::Key\n    Properties:\n      Description: KMS Key for Encryption\n      EnableKeyRotation: true\n      KeyPolicy:\n        Version: '2012-10-17'\n        Id: key-default-policy\n        Statement:\n          - Sid: Enable IAM User Permissions\n            Effect: Allow\n            Principal:\n              AWS: !Sub 'arn:aws:iam::${AWS::AccountId}:root'\n            Action: 'kms:*'\n            Resource: '*'\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-KMSKey\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:35:33.862113\n\n# --------------------------------------------------\n# Outputs\n# --------------------------------------------------\nOutputs:\n\n  VPC:\n    Description: A reference to the created VPC\n    Value: !Ref VPC\n    Export:\n      Name: !Sub ${EnvironmentName}-VPCID\n\n  PublicSubnets:\n    Description: A list of the public subnets\n    Value:\n      !Join [\n        \",\",\n        [!Ref PublicSubnet1, !Ref PublicSubnet2]\n      ]\n    Export:\n      Name: !Sub ${EnvironmentName}-PublicSubnets\n\n  PrivateSubnets:\n    Description: A list of the private subnets\n    Value:\n      !Join [\n        \",\",\n        [!Ref PrivateSubnet1, !Ref PrivateSubnet2]\n      ]\n    Export:\n      Name: !Sub ${EnvironmentName}-PrivateSubnets\n\n  PublicSecurityGroup:\n    Description: A reference to the public security group\n    Value: !Ref PublicSecurityGroup\n    Export:\n      Name: !Sub ${EnvironmentName}-PublicSecurityGroup\n\n  PrivateSecurityGroup:\n    Description: A reference to the private security group\n    Value: !Ref PrivateSecurityGroup\n    Export:\n      Name: !Sub ${EnvironmentName}-PrivateSecurityGroup\n\n  KMSKey:\n    Description: A reference to the KMS Key for encryption\n    Value: !Ref KMSKey\n    Export:\n      Name: !Sub ${EnvironmentName}-KMSKey",
  "dependencies": [
    "20-network"
  ],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T16:39:17.626919"
}