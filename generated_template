{
  "phase_number": 50,
  "phase_name": "storage",
  "yaml_content": "```yaml\nAWSTemplateFormatVersion: '2010-09-09'\nDescription: 'AWS CloudFormation Template for creating an S3 Bucket with KMS encryption, logging, and lifecycle policies.'\n\nParameters:\n  BucketName:\n    Type: String\n    Description: Name of the S3 bucket to create\n    AllowedPattern: ^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$\n    ConstraintDescription: Bucket name must be a valid DNS name.\n\nResources:\n\n  # KMS Key for S3 Bucket Encryption\n  S3BucketKey:\n    Type: AWS::KMS::Key\n    Properties:\n      Description: KMS key to encrypt S3 bucket objects\n      EnableKeyRotation: true\n      KeyPolicy:\n        Version: '2012-10-17'\n        Id: key-default-1\n        Statement:\n          - Sid: Enable IAM policies\n            Effect: Allow\n            Principal:\n              AWS: !Join ['', ['arn:aws:iam::', !Ref 'AWS::AccountId', ':root']]\n            Action: 'kms:*'\n            Resource: '*'\n\n  # S3 Bucket\n  S3Bucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Ref BucketName\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: 'aws:kms'\n              KMSMasterKeyID: !GetAtt S3BucketKey.Arn\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      VersioningConfiguration:\n        Status: Enabled\n      LoggingConfiguration:\n        DestinationBucketName: !Ref LogBucket\n        LogFilePrefix: 's3-access-logs/'\n      LifecycleConfiguration:\n        Rules:\n          - Id: DeleteOldObjectsRule\n            Status: Enabled\n            NoncurrentVersionExpirationInDays: 365\n            AbortIncompleteMultipartUploadDays: 7\n            Transitions:\n              - StorageClass: GLACIER\n                TransitionInDays: 180\n      Tags:\n        - Key: ManagedBy\n          Value: IAC\n        - Key: CreatedAt\n          Value: '2025-12-01T14:15:14.355176'\n\n  # S3 Bucket for Storing Access Logs\n  LogBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${AWS::StackName}-logs'\n      AccessControl: LogDeliveryWrite\n      VersioningConfiguration:\n        Status: Enabled\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: 'aws:kms'\n              KMSMasterKeyID: !GetAtt S3BucketKey.Arn\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      Tags:\n        - Key: ManagedBy\n          Value: IAC\n        - Key: CreatedAt\n          Value: '2025-12-01T14:15:14.355176'\n\nOutputs:\n\n  S3BucketName:\n    Description: Name of the newly created S3 bucket\n    Value: !Ref S3Bucket\n    Export:\n      Name: !Sub '${AWS::StackName}-S3BucketName'\n\n  S3BucketArn:\n    Description: ARN of the newly created S3 bucket\n    Value: !GetAtt S3Bucket.Arn\n    Export:\n      Name: !Sub '${AWS::StackName}-S3BucketArn'\n\n  S3BucketKMSKeyArn:\n    Description: ARN of the KMS key used for encrypting S3 bucket objects\n    Value: !GetAtt S3BucketKey.Arn\n    Export:\n      Name: !Sub '${AWS::StackName}-S3BucketKMSKeyArn'\n```",
  "dependencies": [],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T14:15:33.611877"
}