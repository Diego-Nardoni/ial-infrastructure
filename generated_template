{
  "phase_number": 99,
  "phase_name": "custom",
  "yaml_content": "---\nAWSTemplateFormatVersion: '2010-09-09'\nDescription: Infrastructure Foundation\n\nParameters:\n\n  EnvironmentName:\n    Description: An environment name that will be prefixed to resource names\n    Type: String\n    Default: production\n\n  VpcCIDR:\n    Description: CIDR block for the VPC\n    Type: String\n    Default: 10.0.0.0/16\n\n  PublicSubnet1CIDR:\n    Description: CIDR block for public subnet 1\n    Type: String\n    Default: 10.0.0.0/24\n\n  PublicSubnet2CIDR:\n    Description: CIDR block for public subnet 2\n    Type: String\n    Default: 10.0.1.0/24\n\n  PrivateSubnet1CIDR:\n    Description: CIDR block for private subnet 1\n    Type: String\n    Default: 10.0.2.0/24\n\n  PrivateSubnet2CIDR:\n    Description: CIDR block for private subnet 2\n    Type: String\n    Default: 10.0.3.0/24\n\nResources:\n\n  VPC:\n    Type: AWS::EC2::VPC\n    Properties:\n      CidrBlock: !Ref VpcCIDR\n      EnableDnsHostnames: true\n      EnableDnsSupport: true\n      InstanceTenancy: default\n      Tags:\n        - Key: Name\n          Value: !Ref EnvironmentName\n\n  InternetGateway:\n    Type: AWS::EC2::InternetGateway\n    Properties:\n      Tags:\n        - Key: Name\n          Value: !Ref EnvironmentName\n\n  InternetGatewayAttachment:\n    Type: AWS::EC2::VPCGatewayAttachment\n    Properties:\n      InternetGatewayId: !Ref InternetGateway\n      VpcId: !Ref VPC\n\n  PublicSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet1CIDR\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-public-subnet-1\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:30:32.423233\n\n  PublicSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet2CIDR\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-public-subnet-2\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:30:32.423233\n\n  PrivateSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet1CIDR\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-private-subnet-1\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:30:32.423233\n\n  PrivateSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet2CIDR\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-private-subnet-2\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: 2025-12-01T16:30:32.423233\n\n  NatGatewayEIP:\n    Type: AWS::EC2::EIP\n    DependsOn: InternetGatewayAttachment\n    Properties:\n      Domain: vpc\n\n  NatGateway:\n    Type: AWS::EC2::NatGateway\n    Properties:\n      AllocationId: !GetAtt NatGatewayEIP.AllocationId\n      SubnetId: !Ref PublicSubnet1\n\n  PublicRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-public-route-table\n\n  DefaultPublicRoute:\n    Type: AWS::EC2::Route\n    DependsOn: InternetGatewayAttachment\n    Properties:\n      RouteTableId: !Ref PublicRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      GatewayId: !Ref InternetGateway\n\n  PublicSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet1\n      RouteTableId: !Ref PublicRouteTable\n\n  PublicSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet2\n      RouteTableId: !Ref PublicRouteTable\n\n  PrivateRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${EnvironmentName}-private-route-table\n\n  DefaultPrivateRoute:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PrivateRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      NatGatewayId: !Ref NatGateway\n\n  PrivateSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet1\n      RouteTableId: !Ref PrivateRouteTable\n\n  PrivateSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet2\n      RouteTableId: !Ref PrivateRouteTable\n\n  KmsKey:\n    Type: AWS::KMS::Key\n    Properties:\n      Description: KMS key for encryption at rest\n      EnableKeyRotation: true\n      Enabled: true\n      KeyPolicy:\n        Version: '2012-10-17'\n        Id: key-policy-id\n        Statement:\n          - Sid: Enable IAM User Permissions\n            Effect: Allow\n            Principal:\n              AWS: !Join [\n                '',\n                [\n                  'arn:aws:iam::',\n                  !Ref 'AWS::AccountId',\n                  ':root',\n                ],\n              ]\n            Action:\n              - 'kms:*'\n            Resource: '*'\n\n  CloudWatchLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '/${EnvironmentName}/foundation'\n      RetentionInDays: 14\n\nOutputs:\n\n  VPC:\n    Description: A reference to the created VPC\n    Value: !Ref VPC\n    Export:\n      Name: !Sub '${EnvironmentName}-VPC'\n\n  PublicSubnets:\n    Description: A list of the public subnets\n    Value:\n      !Join [\n        ',',\n        [!Ref PublicSubnet1, !Ref PublicSubnet2],\n      ]\n    Export:\n      Name: !Sub '${EnvironmentName}-PublicSubnets'\n\n  PrivateSubnets:\n    Description: A list of the private subnets\n    Value:\n      !Join [\n        ',',\n        [!Ref PrivateSubnet1, !Ref PrivateSubnet2],\n      ]\n    Export:\n      Name: !Sub '${EnvironmentName}-PrivateSubnets'\n\n  KmsKeyArn:\n    Description: KMS key ARN for encryption\n    Value: !GetAtt KmsKey.Arn\n    Export:\n      Name: !Sub '${EnvironmentName}-KmsKeyArn'",
  "dependencies": [
    "20-network"
  ],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T16:31:00.253560"
}