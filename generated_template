{
  "phase_number": 50,
  "phase_name": "storage",
  "yaml_content": "```yaml\nAWSTemplateFormatVersion: '2010-09-09'\nDescription: Lista todos os buckets S3 existentes\nParameters: {}\n\nOutputs:\n  S3BucketList:\n    Description: Lista de buckets S3\n    Value: !Join [', ', !Ref AWS::AccountId]\n\nResources:\n  CloudWatchLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '/${AWS::StackName}/S3BucketList'\n      RetentionInDays: 7\n\n  ListS3BucketsPolicy:\n    Type: AWS::IAM::ManagedPolicy\n    Properties:\n      Description: Pol\u00edtica para listar buckets S3\n      PolicyDocument:\n        Version: 2012-10-17\n        Statement:\n          - Effect: Allow\n            Action: s3:ListAllMyBuckets\n            Resource: '*'\n      ManagedPolicyName: !Sub '${AWS::StackName}-ListS3BucketsPolicy'\n\n  ListS3BucketsRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: 2012-10-17\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - !Ref ListS3BucketsPolicy\n      Path: /\n      RoleName: !Sub '${AWS::StackName}-ListS3BucketsRole'\n\n  ListS3Buckets:\n    Type: AWS::Lambda::Function\n    Properties:\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          def lambda_handler(event, context):\n              s3 = boto3.client('s3')\n              response = s3.list_buckets()\n              buckets = [bucket['Name'] for bucket in response['Buckets']]\n              print(f'Buckets: {\", \".join(buckets)}')\n              return {\n                  'statusCode': 200,\n                  'body': json.dumps(f'Buckets: {\", \".join(buckets)}')\n              }\n      Description: Lista todos os buckets S3\n      FunctionName: !Sub '${AWS::StackName}-ListS3Buckets'\n      Handler: index.lambda_handler\n      LogGroupName: !Ref CloudWatchLogGroup\n      MemorySize: 128\n      Role: !GetAtt ListS3BucketsRole.Arn\n      Runtime: python3.9\n      Timeout: 10\n\n  LambdaPermission:\n    Type: AWS::Lambda::Permission\n    Properties:\n      Action: lambda:InvokeFunction\n      FunctionName: !Ref ListS3Buckets\n      Principal: cloudformation.amazonaws.com\n\nMetadata:\n  AWS::CloudFormation::Interface:\n    ParameterGroups:\n      - Label:\n          default: Resource Tags\n        Parameters: []\n    ParameterLabels: {}\n\n  CreatedAt: 2025-12-01T20:32:48.904Z\n  ManagedBy: IAL\n```",
  "dependencies": [],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T20:32:58.901750"
}