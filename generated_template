{
  "phase_number": 99,
  "phase_name": "custom",
  "yaml_content": "```yaml\n# ---------------------------------------------------------------------------------------------------------------------\n# Parameters\n# ---------------------------------------------------------------------------------------------------------------------\n\nParameters:\n\n  Environment:\n    Description: Environment name\n    Type: String\n    AllowedValues:\n      - prod\n      - staging\n      - dev\n    Default: dev\n\n  VpcCidrBlock:\n    Description: VPC CIDR block\n    Type: String\n    Default: 10.0.0.0/16\n\n  PublicSubnet1CidrBlock:\n    Description: Public subnet 1 CIDR block\n    Type: String\n    Default: 10.0.0.0/24\n\n  PublicSubnet2CidrBlock:\n    Description: Public subnet 2 CIDR block\n    Type: String\n    Default: 10.0.1.0/24\n\n  PrivateSubnet1CidrBlock:\n    Description: Private subnet 1 CIDR block\n    Type: String\n    Default: 10.0.2.0/24\n\n  PrivateSubnet2CidrBlock:\n    Description: Private subnet 2 CIDR block\n    Type: String\n    Default: 10.0.3.0/24\n\n# ---------------------------------------------------------------------------------------------------------------------\n# Resources\n# ---------------------------------------------------------------------------------------------------------------------\n\nResources:\n\n  # VPC\n  VPC:\n    Type: AWS::EC2::VPC\n    Properties:\n      CidrBlock: !Ref VpcCidrBlock\n      EnableDnsHostnames: true\n      EnableDnsSupport: true\n      InstanceTenancy: default\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-vpc\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # Internet Gateway\n  InternetGateway:\n    Type: AWS::EC2::InternetGateway\n    Properties:\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-igw\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # Attach Internet Gateway to VPC\n  VPCGatewayAttachment:\n    Type: AWS::EC2::VPCGatewayAttachment\n    Properties:\n      VpcId: !Ref VPC\n      InternetGatewayId: !Ref InternetGateway\n\n  # Elastic IP for NAT Gateway\n  NatGatewayEIP:\n    Type: AWS::EC2::EIP\n    Properties:\n      Domain: vpc\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-nat-gw-eip\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # NAT Gateway\n  NatGateway:\n    Type: AWS::EC2::NatGateway\n    Properties:\n      AllocationId: !GetAtt NatGatewayEIP.AllocationId\n      SubnetId: !Ref PublicSubnet1\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-nat-gw\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # Public Subnets\n  PublicSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet1CidrBlock\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-public-subnet-1\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  PublicSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet2CidrBlock\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-public-subnet-2\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # Private Subnets\n  PrivateSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet1CidrBlock\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-private-subnet-1\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  PrivateSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet2CidrBlock\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-private-subnet-2\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # Route Tables\n  PublicRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-public-rt\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  PrivateRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-private-rt\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # Route Table Associations\n  PublicSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet1\n      RouteTableId: !Ref PublicRouteTable\n\n  PublicSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet2\n      RouteTableId: !Ref PublicRouteTable\n\n  PrivateSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet1\n      RouteTableId: !Ref PrivateRouteTable\n\n  PrivateSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet2\n      RouteTableId: !Ref PrivateRouteTable\n\n  # Routes\n  PublicRouteTableIGWRoute:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PublicRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      GatewayId: !Ref InternetGateway\n\n  PrivateRouteTableNATGWRoute:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PrivateRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      NatGatewayId: !Ref NatGateway\n\n  # Security Groups\n  SSHSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Allow SSH access from trusted networks\n      VpcId: !Ref VPC\n      SecurityGroupIngress:\n        - CidrIp: 10.0.0.0/16  # Replace with trusted CIDR ranges\n          FromPort: 22\n          ToPort: 22\n          IpProtocol: tcp\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-ssh-sg\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  HTTPSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Allow HTTP access from load balancer\n      VpcId: !Ref VPC\n      SecurityGroupIngress:\n        - SourceSecurityGroupId: !Ref LoadBalancerSecurityGroup\n          FromPort: 80\n          ToPort: 80\n          IpProtocol: tcp\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-http-sg\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  LoadBalancerSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Allow HTTP traffic from internet\n      VpcId: !Ref VPC\n      SecurityGroupIngress:\n        - CidrIp: 0.0.0.0/0\n          FromPort: 80\n          ToPort: 80\n          IpProtocol: tcp\n      Tags:\n        - Key: Name\n          Value: !Sub ${Environment}-lb-sg\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: \"2025-12-01T17:41:21.814681\"\n\n  # IAM Roles\n  InstanceRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: ec2.amazonaws.com\n            Action: 'sts:AssumeRole'\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/CloudWatchLogsFullAccess\n      Path: /\n\n  # Instance Profile\n  InstanceProfile:\n    Type: AWS::IAM::InstanceProfile\n    Properties:\n      Path: /\n      Roles:\n        - !Ref InstanceRole\n\n  # KMS Key\n  KmsKey:\n    Type: AWS::KMS::Key\n    Properties:\n      Description: KMS key for encryption\n      EnableKeyRotation: true\n      KeyPolicy:\n        Version: '2012-10-17'\n        Id: key-policy\n        Statement:\n          - Sid: Allow root user\n            Effect: Allow\n            Principal:\n              AWS: !Sub 'arn:aws:iam::${AWS::AccountId}:root'\n            Action: 'kms:*'\n            Resource: '*'\n    DeletionPolicy: Retain\n\n# ---------------------------------------------------------------------------------------------------------------------\n# Outputs\n# ---------------------------------------------------------------------------------------------------------------------\n\nOutputs:\n\n  VPC:\n    Description: VPC ID\n    Value: !Ref VPC\n    Export:\n      Name: !Sub ${Environment}-vpc-id\n\n  PublicSubnet1:\n    Description: Public subnet 1 ID\n    Value: !Ref PublicSubnet1\n    Export:\n      Name: !Sub ${Environment}-public-subnet-1-id\n\n  PublicSubnet2:\n    Description: Public subnet 2 ID\n    Value: !Ref PublicSubnet2\n    Export:\n      Name: !Sub ${Environment}-public-subnet-2-id\n\n  PrivateSubnet1:\n    Description: Private subnet 1 ID\n    Value: !Ref PrivateSubnet1\n    Export:\n      Name: !Sub ${Environment}-private-subnet-1-id\n\n  PrivateSubnet2:\n    Description: Private subnet 2 ID\n    Value: !Ref PrivateSubnet2\n    Export:\n      Name: !Sub ${Environment}-private-subnet-2-id\n\n  SSHSecurityGroup:\n    Description: SSH security group ID\n    Value: !Ref SSHSecurityGroup\n    Export:\n      Name: !Sub ${Environment}-ssh-sg-id\n\n  HTTPSecurityGroup:\n    Description: HTTP security group ID\n    Value: !Ref HTTPSecurityGroup\n    Export:\n      Name: !Sub ${Environment}-http-sg-id\n\n  LoadBalancerSecurityGroup:\n    Description: Load balancer security group ID\n    Value: !Ref LoadBalancerSecurityGroup\n    Export:\n      Name: !Sub ${Environment}-lb-sg-id\n\n  InstanceRole:\n    Description: Instance role name\n    Value: !Ref InstanceRole\n    Export:\n      Name: !Sub ${Environment}-instance-role-name\n\n  InstanceProfile:\n    Description: Instance profile name\n    Value: !Ref InstanceProfile\n    Export:\n      Name: !Sub ${Environment}-instance-profile-name\n\n  KmsKey:\n    Description: KMS key ARN\n    Value: !GetAtt KmsKey.Arn\n    Export:\n      Name: !Sub ${Environment}-kms-key-arn\n```",
  "dependencies": [
    "20-network"
  ],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T17:42:05.520524"
}