{
  "phase_number": 99,
  "phase_name": "custom",
  "yaml_content": "```yaml\n# --------------------------------------------------\n# Parameters\n# --------------------------------------------------\n\nParameters:\n\n  EnvironmentName:\n    Description: An environment name that will be prefixed to resource names\n    Type: String\n    Default: production\n\n  VpcCIDR:\n    Description: Please enter the IP range (CIDR notation) for this VPC\n    Type: String\n    Default: 10.0.0.0/16\n\n  PublicSubnet1CIDR:\n    Description: Please enter the IP range (CIDR notation) for the public subnet in the first Availability Zone\n    Type: String\n    Default: 10.0.0.0/24\n\n  PublicSubnet2CIDR:\n    Description: Please enter the IP range (CIDR notation) for the public subnet in the second Availability Zone\n    Type: String\n    Default: 10.0.1.0/24\n\n  PrivateSubnet1CIDR:\n    Description: Please enter the IP range (CIDR notation) for the private subnet in the first Availability Zone\n    Type: String\n    Default: 10.0.2.0/24\n\n  PrivateSubnet2CIDR:\n    Description: Please enter the IP range (CIDR notation) for the private subnet in the second Availability Zone\n    Type: String\n    Default: 10.0.3.0/24\n\n# --------------------------------------------------\n# Resources\n# --------------------------------------------------\n\nResources:\n\n  # VPC\n  VPC:\n    Type: AWS::EC2::VPC\n    Properties:\n      CidrBlock: !Ref VpcCIDR\n      EnableDnsHostnames: true\n      EnableDnsSupport: true\n      InstanceTenancy: default\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-VPC'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # Internet Gateway\n  InternetGateway:\n    Type: AWS::EC2::InternetGateway\n    Properties:\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-IGW'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # Attach Internet Gateway to VPC\n  InternetGatewayAttachment:\n    Type: AWS::EC2::VPCGatewayAttachment\n    Properties:\n      InternetGatewayId: !Ref InternetGateway\n      VpcId: !Ref VPC\n\n  # Public Subnets\n  PublicSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet1CIDR\n      MapPublicIpOnLaunch: true\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Public-Subnet-1'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  PublicSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PublicSubnet2CIDR\n      MapPublicIpOnLaunch: true\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Public-Subnet-2'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # Private Subnets\n  PrivateSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      AvailabilityZone: !Select [0, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet1CIDR\n      MapPublicIpOnLaunch: false\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Private-Subnet-1'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  PrivateSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      AvailabilityZone: !Select [1, !GetAZs '']\n      CidrBlock: !Ref PrivateSubnet2CIDR\n      MapPublicIpOnLaunch: false\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Private-Subnet-2'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # NAT Gateways\n  NatGateway1EIP:\n    Type: AWS::EC2::EIP\n    DependsOn: InternetGatewayAttachment\n    Properties:\n      Domain: vpc\n\n  NatGateway2EIP:\n    Type: AWS::EC2::EIP\n    DependsOn: InternetGatewayAttachment\n    Properties:\n      Domain: vpc\n\n  NatGateway1:\n    Type: AWS::EC2::NatGateway\n    Properties:\n      AllocationId: !GetAtt NatGateway1EIP.AllocationId\n      SubnetId: !Ref PublicSubnet1\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-NatGateway-1'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  NatGateway2:\n    Type: AWS::EC2::NatGateway\n    Properties:\n      AllocationId: !GetAtt NatGateway2EIP.AllocationId\n      SubnetId: !Ref PublicSubnet2\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-NatGateway-2'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # Route Tables\n  PublicRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Public-RouteTable'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # Public Route\n  PublicRoute:\n    Type: AWS::EC2::Route\n    DependsOn: InternetGatewayAttachment\n    Properties:\n      RouteTableId: !Ref PublicRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      GatewayId: !Ref InternetGateway\n\n  # Associate public subnets with the public route table\n  PublicSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet1\n      RouteTableId: !Ref PublicRouteTable\n\n  PublicSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet2\n      RouteTableId: !Ref PublicRouteTable\n\n  # Private Route Tables\n  PrivateRouteTable1:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Private-RouteTable-1'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  PrivateRouteTable2:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Private-RouteTable-2'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # Private Routes\n  PrivateRoute1:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PrivateRouteTable1\n      DestinationCidrBlock: 0.0.0.0/0\n      NatGatewayId: !Ref NatGateway1\n\n  PrivateRoute2:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PrivateRouteTable2\n      DestinationCidrBlock: 0.0.0.0/0\n      NatGatewayId: !Ref NatGateway2\n\n  # Associate private subnets with the private route tables\n  PrivateSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet1\n      RouteTableId: !Ref PrivateRouteTable1\n\n  PrivateSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet2\n      RouteTableId: !Ref PrivateRouteTable2\n\n  # VPC Endpoint for S3\n  S3VPCEndpoint:\n    Type: AWS::EC2::VPCEndpoint\n    Properties:\n      RouteTableIds:\n        - !Ref PrivateRouteTable1\n        - !Ref PrivateRouteTable2\n      ServiceName: !Join ['', ['com.amazonaws.', !Ref 'AWS::Region', '.s3']]\n      VpcId: !Ref VPC\n\n  # Security Groups\n  PrivateSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Security group for private instances\n      SecurityGroupIngress:\n        - IpProtocol: tcp\n          FromPort: 22\n          ToPort: 22\n          SourceSecurityGroupId: !Ref PublicSecurityGroup\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Private-SecurityGroup'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  PublicSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Security group for public instances\n      SecurityGroupIngress:\n        - IpProtocol: tcp\n          FromPort: 22\n          ToPort: 22\n          CidrIp: 0.0.0.0/0\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-Public-SecurityGroup'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # KMS Key for Encryption\n  KMSKey:\n    Type: AWS::KMS::Key\n    Properties:\n      Description: KMS key for encryption\n      KeyPolicy:\n        Version: '2012-10-17'\n        Id: key-policy\n        Statement:\n          - Sid: Enable IAM User Permissions\n            Effect: Allow\n            Principal:\n              AWS: !Join [':', ['arn:aws:iam:', !Ref 'AWS::AccountId', 'root']]\n            Action: kms:*\n            Resource: '*'\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-KMSKey'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n  # S3 Bucket with Encryption and Lifecycle Policy\n  S3Bucket:\n    Type: AWS::S3::Bucket\n    DeletionPolicy: Retain\n    Properties:\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: aws:kms\n              KMSMasterKeyID: !Ref KMSKey\n      LifecycleConfiguration:\n        Rules:\n          - Id: DeleteOldObjects\n            Status: Enabled\n            Transitions:\n              - StorageClass: Glacier\n                TransitionInDays: 30\n            ExpirationInDays: 365\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-S3Bucket'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T17:04:34.263094'\n\n# --------------------------------------------------\n# Outputs\n# --------------------------------------------------\n\nOutputs:\n\n  VPC:\n    Description: A reference to the created VPC\n    Value: !Ref VPC\n    Export:\n      Name: !Sub '${EnvironmentName}-VPCID'\n\n  PublicSubnets:\n    Description: A list of the public subnets\n    Value: !Join [',', [!Ref PublicSubnet1, !Ref PublicSubnet2]]\n    Export:\n      Name: !Sub '${EnvironmentName}-PublicSubnets'\n\n  PrivateSubnets:\n    Description: A list of the private subnets\n    Value: !Join [',', [!Ref PrivateSubnet1, !Ref PrivateSubnet2]]\n    Export:\n      Name: !Sub '${EnvironmentName}-PrivateSubnets'\n\n  PublicSecurityGroup:\n    Description: A reference to the public security group\n    Value: !Ref PublicSecurityGroup\n    Export:\n      Name: !Sub '${EnvironmentName}-PublicSecurityGroup'\n\n  PrivateSecurityGroup:\n    Description: A reference to the private security group\n    Value: !Ref PrivateSecurityGroup\n    Export:\n      Name: !Sub '${EnvironmentName}-PrivateSecurityGroup'\n\n  S3BucketName:\n    Description: Name of the S3 bucket\n    Value: !Ref S3Bucket\n    Export:\n      Name: !Sub '${EnvironmentName}-S3BucketName'\n\n  KMSKeyArn:\n    Description: ARN of the KMS key\n    Value: !GetAtt KMSKey.Arn\n    Export:\n      Name: !Sub '${EnvironmentName}-KMSKeyArn'\n```",
  "dependencies": [
    "20-network"
  ],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T17:05:30.137723"
}