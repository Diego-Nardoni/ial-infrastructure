{
  "phase_number": 99,
  "phase_name": "custom",
  "yaml_content": "```yaml\nAWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Highly Available, Secure, and Cost-Optimized AWS Infrastructure'\n\nParameters:\n\n  EnvironmentName:\n    Description: 'An environment name that will be prefixed to resource names'\n    Type: String\n    Default: prod\n\n  VpcCIDR:\n    Description: 'Please enter the IP range (CIDR notation) for this VPC'\n    Type: String\n    Default: 10.0.0.0/16\n\n  PublicSubnet1CIDR:\n    Description: 'Please enter the IP range (CIDR notation) for the public subnet in the first Availability Zone'\n    Type: String\n    Default: 10.0.0.0/24\n\n  PublicSubnet2CIDR:\n    Description: 'Please enter the IP range (CIDR notation) for the public subnet in the second Availability Zone'\n    Type: String\n    Default: 10.0.1.0/24\n\n  PrivateSubnet1CIDR:\n    Description: 'Please enter the IP range (CIDR notation) for the private subnet in the first Availability Zone'\n    Type: String\n    Default: 10.0.2.0/24\n\n  PrivateSubnet2CIDR:\n    Description: 'Please enter the IP range (CIDR notation) for the private subnet in the second Availability Zone'\n    Type: String\n    Default: 10.0.3.0/24\n\n  InstanceType:\n    Description: 'EC2 instance type for the application tier'\n    Type: String\n    Default: t3.micro\n    AllowedValues:\n      - t3.micro\n      - t3.small\n      - t3.medium\n\nResources:\n\n  # VPC\n  VPC:\n    Type: AWS::EC2::VPC\n    Properties:\n      CidrBlock: !Ref VpcCIDR\n      EnableDnsHostnames: true\n      EnableDnsSupport: true\n      InstanceTenancy: default\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-VPC'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Internet Gateway\n  InternetGateway:\n    Type: AWS::EC2::InternetGateway\n    Properties:\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-IGW'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Attach Internet Gateway to VPC\n  InternetGatewayAttachment:\n    Type: AWS::EC2::VPCGatewayAttachment\n    Properties:\n      InternetGatewayId: !Ref InternetGateway\n      VpcId: !Ref VPC\n\n  # NAT Gateway Elastic IP\n  NatGatewayEIP:\n    Type: AWS::EC2::EIP\n    Properties:\n      Domain: vpc\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-NatGatewayEIP'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # NAT Gateway\n  NatGateway:\n    Type: AWS::EC2::NatGateway\n    Properties:\n      AllocationId: !GetAtt NatGatewayEIP.AllocationId\n      SubnetId: !Ref PublicSubnet1\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-NatGateway'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Public Subnets\n  PublicSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [ 0, !GetAZs '' ]\n      CidrBlock: !Ref PublicSubnet1CIDR\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-PublicSubnet1'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  PublicSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [ 1, !GetAZs '' ]\n      CidrBlock: !Ref PublicSubnet2CIDR\n      MapPublicIpOnLaunch: true\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-PublicSubnet2'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Private Subnets\n  PrivateSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [ 0, !GetAZs '' ]\n      CidrBlock: !Ref PrivateSubnet1CIDR\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-PrivateSubnet1'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  PrivateSubnet2:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref VPC\n      AvailabilityZone: !Select [ 1, !GetAZs '' ]\n      CidrBlock: !Ref PrivateSubnet2CIDR\n      MapPublicIpOnLaunch: false\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-PrivateSubnet2'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Public Route Table\n  PublicRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-PublicRouteTable'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Private Route Table\n  PrivateRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-PrivateRouteTable'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Internet Route\n  PublicRoute:\n    Type: AWS::EC2::Route\n    DependsOn: InternetGatewayAttachment\n    Properties:\n      RouteTableId: !Ref PublicRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      GatewayId: !Ref InternetGateway\n\n  # NAT Route\n  PrivateRoute:\n    Type: AWS::EC2::Route\n    Properties:\n      RouteTableId: !Ref PrivateRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      NatGatewayId: !Ref NatGateway\n\n  # Public Subnet Route Table Association\n  PublicSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet1\n      RouteTableId: !Ref PublicRouteTable\n\n  PublicSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet2\n      RouteTableId: !Ref PublicRouteTable\n\n  # Private Subnet Route Table Association\n  PrivateSubnet1RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet1\n      RouteTableId: !Ref PrivateRouteTable\n\n  PrivateSubnet2RouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet2\n      RouteTableId: !Ref PrivateRouteTable\n\n  # Security Groups\n  WebServerSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Allow HTTP/HTTPS from anywhere\n      SecurityGroupIngress:\n        - IpProtocol: tcp\n          FromPort: 80\n          ToPort: 80\n          CidrIp: 0.0.0.0/0\n        - IpProtocol: tcp\n          FromPort: 443\n          ToPort: 443\n          CidrIp: 0.0.0.0/0\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-WebServerSG'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Application Load Balancer\n  ApplicationLoadBalancer:\n    Type: AWS::ElasticLoadBalancingV2::LoadBalancer\n    Properties:\n      Scheme: internet-facing\n      SecurityGroups:\n        - !Ref WebServerSecurityGroup\n      Subnets:\n        - !Ref PublicSubnet1\n        - !Ref PublicSubnet2\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-ALB'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Target Group\n  TargetGroup:\n    Type: AWS::ElasticLoadBalancingV2::TargetGroup\n    Properties:\n      HealthCheckPath: /\n      Name: !Sub '${EnvironmentName}-TargetGroup'\n      Port: 80\n      Protocol: HTTP\n      TargetType: ip\n      VpcId: !Ref VPC\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-TargetGroup'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Listener\n  Listener:\n    Type: AWS::ElasticLoadBalancingV2::Listener\n    Properties:\n      DefaultActions:\n        - Type: forward\n          TargetGroupArn: !Ref TargetGroup\n      LoadBalancerArn: !Ref ApplicationLoadBalancer\n      Port: 80\n      Protocol: HTTP\n\n  # Auto Scaling Group\n  AutoScalingGroup:\n    Type: AWS::AutoScaling::AutoScalingGroup\n    Properties:\n      VPCZoneIdentifier:\n        - !Ref PrivateSubnet1\n        - !Ref PrivateSubnet2\n      LaunchConfigurationName: !Ref LaunchConfiguration\n      MinSize: '2'\n      MaxSize: '4'\n      HealthCheckGracePeriod: 300\n      HealthCheckType: ELB\n      TargetGroupARNs:\n        - !Ref TargetGroup\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-WebServer'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # Launch Configuration\n  LaunchConfiguration:\n    Type: AWS::AutoScaling::LaunchConfiguration\n    Properties:\n      ImageId: ami-0cff7528ff583bf9a # Amazon Linux 2 AMI\n      InstanceType: !Ref InstanceType\n      SecurityGroups:\n        - !Ref WebServerSecurityGroup\n      UserData:\n        Fn::Base64:\n          !Sub |\n            #!/bin/bash\n            yum update -y\n            yum install -y httpd\n            systemctl start httpd\n            systemctl enable httpd\n\n  # S3 Bucket for CloudWatch Logs\n  S3BucketForCloudWatchLogs:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${EnvironmentName}-cloudwatch-logs'\n      AccessControl: LogDeliveryWrite\n      LifecycleConfiguration:\n        Rules:\n          - Id: DeleteOldLogFiles\n            Status: Enabled\n            ExpirationInDays: 30\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-CloudWatchLogsBucket'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\n  # CloudWatch Logs\n  CloudWatchLogsGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '${EnvironmentName}-webserver-logs'\n      RetentionInDays: 14\n\n  # KMS Key for Encryption\n  KmsKey:\n    Type: AWS::KMS::Key\n    Properties:\n      Description: KMS Key for Encryption\n      KeyPolicy:\n        Version: '2012-10-17'\n        Id: key-default-1\n        Statement:\n          - Sid: Enable IAM User Permissions\n            Effect: Allow\n            Principal:\n              AWS: !Join ['', ['arn:aws:iam::', !Ref 'AWS::AccountId', ':root']]\n            Action: 'kms:*'\n            Resource: '*'\n      Tags:\n        - Key: Name\n          Value: !Sub '${EnvironmentName}-KmsKey'\n        - Key: ManagedBy\n          Value: IAL\n        - Key: CreatedAt\n          Value: '2025-12-01T14:31:16.069982'\n\nOutputs:\n\n  VPC:\n    Description: 'A reference to the created VPC'\n    Value: !Ref VPC\n    Export:\n      Name: !Sub '${EnvironmentName}-VPC'\n\n  PublicSubnets:\n    Description: 'A list of the public subnets'\n    Value: !Join [',', [!Ref PublicSubnet1, !Ref PublicSubnet2]]\n    Export:\n      Name: !Sub '${EnvironmentName}-PublicSubnets'\n\n  PrivateSubnets:\n    Description: 'A list of the private subnets'\n    Value: !Join [',', [!Ref PrivateSubnet1, !Ref PrivateSubnet2]]\n    Export:\n      Name: !Sub '${EnvironmentName}-PrivateSubnets'\n\n  LoadBalancerEndpoint:\n    Description: 'The public DNS name of the load balancer'\n    Value: !GetAtt ApplicationLoadBalancer.DNSName\n    Export:\n      Name: !Sub '${EnvironmentName}-LoadBalancerEndpoint'",
  "dependencies": [
    "20-network"
  ],
  "estimated_cost": 0.0,
  "created_at": "2025-12-01T14:33:14.276071"
}