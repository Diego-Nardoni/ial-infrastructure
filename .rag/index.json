{
  "metas": [
    {
      "source": "docs/INSTALL.md",
      "text": "# \ud83d\udce6 ialctl Installation Guide\n\nInfrastructure as Language CLI - Natural language AWS infrastructure management\n\n## \ud83d\ude80 Quick Install\n\n### Linux (Ubuntu/Debian/RHEL/Amazon Linux)\n\n```bash\n# One-line installer\ncurl -s https://raw.githubusercontent.com/your-org/ial/main/scripts/install.sh | bash\n\n# Or download and run manually\nwget https://raw.githubusercontent.com/your-org/ial/main/scripts/install.sh\nchmod +x install.sh\n./install.sh\n```\n\n### Windows (PowerShell)\n\n```powershell\n# One-line installer (run as Administrator)\niex ((New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/your-org/ial/main/scripts/install.ps1'))\n\n# Or with custom install directory\niex ((New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/your-org/ial/main/scripts/install.ps1')) -InstallDir \"C:\\Tools\\ialctl\"\n```\n\n## \ud83d\udccb Manual Installation\n\n### Linux Package Managers\n\n#### Debian/Ubuntu (.deb)\n```bash\n# Download latest .deb package\nwget https://github.com/your-org/ial/releases/latest/download/ialctl_VERSION_amd64.deb\n\n# Install\nsudo dpkg -i ialctl_VERSION_amd64.deb\nsudo apt-get install -f  # Fix dependencies if needed\n```\n\n#### RHEL/CentOS/Fedora (.rpm)\n```bash\n# Download latest .rpm package\nwget https://github.com/your-org/ial/releases/latest/download/ialctl-VERSION-1.x86_64.rpm\n\n# Install with dnf (Fedora)\nsudo dnf install ialctl-VERSION-1.x86_64.rpm\n\n# Install with yum (RHEL/CentOS)\nsudo yum install ialctl-VERSION-1.x86_64.rpm\n```\n\n#### AppImage (Universal Linux)\n```bash\n# Download AppImage\nwget https://github.com/your-org/ial/releases/latest/download/ialctl-VERSION-x86_64.AppImage\n\n# Make executable and run\nchmod +x ialctl-VERSION-x86_64.AppImage\n./ialctl-VERSION-x86_64.AppImage\n\n# Optional: Install to system\nsudo mv ialctl-VERSION-x86_64.AppImage /usr/local/bin/ialctl\n```\n\n### Windows Installers\n\n#### MSI Installer\n```powershell\n# Download and run MSI installer\nInvoke-WebRequest -Uri \"https://github.com/your-org/ial/releases/latest/dow"
    },
    {
      "source": "docs/INSTALL.md",
      "text": "nload/ialctl-VERSION.msi\" -OutFile \"ialctl.msi\"\nStart-Process msiexec.exe -ArgumentList \"/i ialctl.msi /quiet\" -Wait -Verb RunAs\n```\n\n#### Standalone Executable\n```powershell\n# Download standalone executable\nInvoke-WebRequest -Uri \"https://github.com/your-org/ial/releases/latest/download/ialctl.exe\" -OutFile \"ialctl.exe\"\n\n# Move to desired location (e.g., C:\\Tools)\nNew-Item -ItemType Directory -Force -Path \"C:\\Tools\"\nMove-Item ialctl.exe \"C:\\Tools\\ialctl.exe\"\n\n# Add to PATH (optional)\n$env:PATH += \";C:\\Tools\"\n```\n\n## \ud83d\udd10 Verification\n\n### Verify Installation\n```bash\n# Check version\nialctl --version\n\n# Check help\nialctl --help\n\n# Test interactive mode\nialctl interactive\n```\n\n### Verify Signatures (Recommended)\n\n```bash\n# Import GPG public key\ncurl -s https://raw.githubusercontent.com/your-org/ial/main/GPG-KEY | gpg --import\n\n# Download checksums and signature\nwget https://github.com/your-org/ial/releases/latest/download/checksums.txt\nwget https://github.com/your-org/ial/releases/latest/download/checksums.txt.asc\n\n# Verify signature\ngpg --verify checksums.txt.asc checksums.txt\n\n# Verify file integrity\nsha256sum -c checksums.txt\n```\n\n## \u2699\ufe0f Configuration\n\n### AWS Credentials\n```bash\n# Configure AWS credentials (required)\naws configure\n\n# Or set environment variables\nexport AWS_ACCESS_KEY_ID=your-access-key\nexport AWS_SECRET_ACCESS_KEY=your-secret-key\nexport AWS_DEFAULT_REGION=us-east-1\n```\n\n### Bedrock Setup (Optional)\n```bash\n# Enable Bedrock models in your AWS region\n# Visit AWS Console > Bedrock > Model Access\n# Request access to Claude models\n\n# Test Bedrock connectivity\nialctl status\n```\n\n## \ud83d\ude80 Getting Started\n\n### Basic Usage\n```bash\n# Interactive mode (recommended for beginners)\nialctl interactive\n\n# Direct commands\nialctl deploy security\nialctl status\nialctl rollback compute\n```\n\n### Example Commands\n```bash\n# Deploy complete infrastructure\nialctl \"Deploy a secure web application with database\"\n\n# Check infrastructure status\nialctl \"Show me the status of all my res"
    },
    {
      "source": "docs/INSTALL.md",
      "text": "ources\"\n\n# Cost optimization\nialctl \"Analyze my AWS costs and suggest optimizations\"\n\n# Rollback changes\nialctl \"Rollback the last deployment\"\n```\n\n## \ud83d\udd27 Troubleshooting\n\n### Common Issues\n\n#### Command not found\n```bash\n# Add to PATH manually\nexport PATH=$PATH:/usr/local/bin\n\n# Or create symlink\nsudo ln -s /usr/local/bin/ialctl /usr/bin/ialctl\n```\n\n#### Permission denied\n```bash\n# Make executable\nchmod +x /usr/local/bin/ialctl\n\n# Or reinstall with proper permissions\nsudo ./install.sh\n```\n\n#### AWS credentials not configured\n```bash\n# Configure AWS CLI\naws configure\n\n# Or use IAM roles (recommended for EC2)\n# Attach appropriate IAM role to your EC2 instance\n```\n\n#### Bedrock access denied\n```bash\n# Request model access in AWS Console\n# Bedrock > Model Access > Request Access\n\n# Ensure IAM permissions include:\n# - bedrock:InvokeModel\n# - bedrock:ListFoundationModels\n```\n\n### Getting Help\n\n- \ud83d\udcda Documentation: [https://github.com/your-org/ial/docs](https://github.com/your-org/ial/docs)\n- \ud83d\udc1b Issues: [https://github.com/your-org/ial/issues](https://github.com/your-org/ial/issues)\n- \ud83d\udcac Discussions: [https://github.com/your-org/ial/discussions](https://github.com/your-org/ial/discussions)\n\n## \ud83d\udd04 Updating\n\n### Automatic Update\n```bash\n# Re-run installer to get latest version\ncurl -s https://raw.githubusercontent.com/your-org/ial/main/scripts/install.sh | bash\n```\n\n### Manual Update\n```bash\n# Check current version\nialctl --version\n\n# Download and install latest release manually\n# Follow installation instructions above\n```\n\n## \ud83d\uddd1\ufe0f Uninstallation\n\n### Package Manager\n```bash\n# Debian/Ubuntu\nsudo apt remove ialctl\n\n# RHEL/CentOS/Fedora\nsudo dnf remove ialctl  # or yum remove ialctl\n```\n\n### Manual Removal\n```bash\n# Remove binary\nsudo rm -f /usr/local/bin/ialctl /usr/bin/ialctl\n\n# Remove bash completion\nsudo rm -f /etc/bash_completion.d/ialctl\n\n# Remove configuration (optional)\nrm -rf ~/.ial\n```\n\n### Windows\n```powershell\n# If installed via MSI\nStart-Process msiexec.exe -ArgumentList "
    },
    {
      "source": "docs/INSTALL.md",
      "text": "\"/x ialctl.msi /quiet\" -Wait -Verb RunAs\n\n# If installed manually\nRemove-Item \"C:\\Tools\\ialctl.exe\"\n# Remove from PATH manually via System Properties\n```\n"
    },
    {
      "source": "docs/github-integration/OIDC-SETUP.md",
      "text": "# GitHub OIDC Integration Setup\n\n## Overview\n\nThis document explains how IAL integrates with GitHub Actions using OpenID Connect (OIDC) for secure, keyless authentication to AWS.\n\n## Architecture\n\n```\nGitHub Actions \u2192 OIDC Token \u2192 AWS STS \u2192 Assume Role \u2192 Deploy Infrastructure\n```\n\n## Components\n\n### 1. OIDC Identity Provider\n- **URL**: `https://token.actions.githubusercontent.com`\n- **Audiences**: `sts.amazonaws.com`\n- **Thumbprints**: GitHub's certificate thumbprints (auto-updated)\n\n### 2. IAM Role\n- **Name**: `ial-github-actions-role`\n- **Trust Policy**: Allows specific GitHub repositories\n- **Permissions**: Limited by permissions boundary\n- **Conditions**: Validates repo, branch, and environment\n\n### 3. Security Features\n- **Permissions Boundary**: Limits maximum permissions\n- **Repository Validation**: Only authorized repos can assume role\n- **Branch Restrictions**: Only specific branches allowed\n- **Environment Controls**: Production environment validation\n\n## Setup Process\n\n### Automatic Setup (Recommended)\n```bash\n# IAL automatically configures OIDC during Control Plane deployment\nialctl init\n# > \u2705 OIDC Provider created\n# > \u2705 GitHub repo registered\n# > \u2705 Trust policy configured\n```\n\n### Manual Verification\n```bash\n# Check OIDC Provider\naws iam list-open-id-connect-providers\n\n# Check IAM Role\naws iam get-role --role-name ial-github-actions-role\n\n# Test assume role (from GitHub Actions)\naws sts assume-role-with-web-identity \\\n  --role-arn arn:aws:iam::ACCOUNT:role/ial-github-actions-role \\\n  --role-session-name test-session \\\n  --web-identity-token $ACTIONS_ID_TOKEN\n```\n\n## GitHub Actions Configuration\n\n### Required Permissions\n```yaml\npermissions:\n  id-token: write    # Required for OIDC\n  contents: read     # Required for checkout\n  pull-requests: write  # Optional for PR comments\n```\n\n### AWS Credentials Step\n```yaml\n- name: Configure AWS credentials\n  uses: aws-actions/configure-aws-credentials@v4\n  with:\n    role-to-assume: ${{ secrets.AWS_ROLE_ARN }}\n    "
    },
    {
      "source": "docs/github-integration/OIDC-SETUP.md",
      "text": "aws-region: us-east-1\n    role-session-name: GitHubActions-${{ github.run_id }}\n```\n\n### Repository Secrets\n- `AWS_ROLE_ARN`: ARN of the IAL GitHub Actions role\n\n## Security Conditions\n\n### Repository Validation\n```json\n{\n  \"StringLike\": {\n    \"token.actions.githubusercontent.com:sub\": [\n      \"repo:USER/ial-infrastructure:ref:refs/heads/main\",\n      \"repo:USER/ial-infrastructure:environment:production\"\n    ]\n  }\n}\n```\n\n### Supported Patterns\n- `repo:owner/repo:ref:refs/heads/main` - Specific branch\n- `repo:owner/repo:environment:prod` - Specific environment\n- `repo:owner/*:ref:refs/heads/main` - All repos from owner\n\n## Multi-Repository Support\n\n### Adding New Repository\n```bash\n# Via IAL CLI\nialctl github add-repo owner/new-repo\n\n# Via AWS CLI\naws ssm put-parameter \\\n  --name \"/ial/github/allowed_repos\" \\\n  --value \"repo:owner/repo1:*,repo:owner/repo2:*\" \\\n  --type StringList \\\n  --overwrite\n```\n\n### Repository Patterns\n- **Single Repo**: `repo:owner/ial-infrastructure:*`\n- **All User Repos**: `repo:owner/*:*`\n- **Specific Branch**: `repo:owner/repo:ref:refs/heads/main`\n- **Environment**: `repo:owner/repo:environment:production`\n\n## Troubleshooting\n\n### Common Issues\n\n#### 1. \"No permission to assume role\"\n```bash\n# Check trust policy\naws iam get-role --role-name ial-github-actions-role \\\n  --query 'Role.AssumeRolePolicyDocument'\n\n# Verify repository is in allowed list\naws ssm get-parameter --name \"/ial/github/allowed_repos\"\n```\n\n#### 2. \"Invalid identity token\"\n```yaml\n# Ensure correct permissions in workflow\npermissions:\n  id-token: write\n  contents: read\n```\n\n#### 3. \"Token audience validation failed\"\n```yaml\n# Verify audience in configure-aws-credentials\nwith:\n  role-to-assume: ${{ secrets.AWS_ROLE_ARN }}\n  # audience defaults to 'sts.amazonaws.com' - usually correct\n```\n\n### Debug Commands\n\n#### Check OIDC Provider\n```bash\naws iam get-open-id-connect-provider \\\n  --open-id-connect-provider-arn arn:aws:iam::ACCOUNT:oidc-provider/token.actions.githubusercontent"
    },
    {
      "source": "docs/github-integration/OIDC-SETUP.md",
      "text": ".com\n```\n\n#### Validate Role Trust Policy\n```bash\naws iam get-role --role-name ial-github-actions-role \\\n  --query 'Role.AssumeRolePolicyDocument' \\\n  --output json | jq '.'\n```\n\n#### Test Token Claims (from GitHub Actions)\n```bash\n# Decode JWT token (for debugging)\necho $ACTIONS_ID_TOKEN | cut -d. -f2 | base64 -d | jq '.'\n```\n\n### CloudTrail Events\nMonitor these events for OIDC activity:\n- `AssumeRoleWithWebIdentity` - Role assumption attempts\n- `GetOpenIDConnectProvider` - OIDC provider access\n- `UpdateAssumeRolePolicy` - Trust policy changes\n\n## Best Practices\n\n### Security\n1. **Least Privilege**: Use permissions boundary to limit maximum access\n2. **Specific Conditions**: Avoid wildcard patterns in trust policy\n3. **Environment Separation**: Use different roles for prod/dev\n4. **Regular Rotation**: Update thumbprints when GitHub rotates certificates\n\n### Operational\n1. **Monitoring**: Set up CloudWatch alarms for failed assumptions\n2. **Logging**: Enable CloudTrail for all IAM events\n3. **Testing**: Validate OIDC integration in CI/CD pipeline\n4. **Documentation**: Keep repository patterns updated\n\n## Advanced Configuration\n\n### Custom Trust Policy\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::ACCOUNT:oidc-provider/token.actions.githubusercontent.com\"\n      },\n      \"Action\": \"sts:AssumeRole\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"token.actions.githubusercontent.com:aud\": \"sts.amazonaws.com\"\n        },\n        \"StringLike\": {\n          \"token.actions.githubusercontent.com:sub\": \"repo:owner/repo:*\"\n        },\n        \"StringEquals\": {\n          \"token.actions.githubusercontent.com:actor\": \"trusted-user\"\n        }\n      }\n    }\n  ]\n}\n```\n\n### Cross-Account Access\n```yaml\n# For deploying to different AWS accounts\n- name: Configure AWS credentials for target account\n  uses: aws-actions/configure-aws-credentials@v4\n  with:\n    role-to-assume: arn:aws:iam:"
    },
    {
      "source": "docs/github-integration/OIDC-SETUP.md",
      "text": ":TARGET-ACCOUNT:role/ial-cross-account-role\n    aws-region: us-east-1\n    role-chaining: true\n```\n\n## References\n- [GitHub OIDC Documentation](https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect)\n- [AWS IAM OIDC Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html)\n- [configure-aws-credentials Action](https://github.com/aws-actions/configure-aws-credentials)\n"
    },
    {
      "source": "docs/github-mcp-integration.md",
      "text": "# GitHub MCP Server Integration\n\n## Vis\u00e3o Geral\n\nO GitHub MCP Server foi integrado ao sistema IAL para fornecer capacidades completas de integra\u00e7\u00e3o com GitHub, incluindo gerenciamento de reposit\u00f3rios, issues, pull requests e workflows.\n\n## Configura\u00e7\u00e3o\n\n### 1. Vari\u00e1veis de Ambiente\n\n```bash\nexport GITHUB_TOKEN=\"your_github_personal_access_token\"\n```\n\n### 2. Instala\u00e7\u00e3o\n\nO GitHub MCP Server \u00e9 instalado automaticamente via npm:\n\n```bash\nnpx -y @modelcontextprotocol/server-github\n```\n\n### 3. Configura\u00e7\u00e3o no IAL\n\nO servidor est\u00e1 configurado em:\n- `/home/ial/config/mcp-mesh.yaml` - Dom\u00ednio DevOps\n- `/home/ial/mcp-server-config.json` - Configura\u00e7\u00e3o do servidor\n- `/home/ial/config/github_mcp.yaml` - Configura\u00e7\u00e3o espec\u00edfica\n\n## Capacidades\n\n### Reposit\u00f3rios\n- `create_repository` - Criar novos reposit\u00f3rios\n- `search_repositories` - Buscar reposit\u00f3rios\n- `fork_repository` - Fazer fork de reposit\u00f3rios\n- `get_repository_info` - Obter informa\u00e7\u00f5es do reposit\u00f3rio\n\n### Issues\n- `create_issue` - Criar issues\n- `list_issues` - Listar issues\n- `update_issue` - Atualizar issues\n- `close_issue` - Fechar issues\n\n### Pull Requests\n- `create_pull_request` - Criar PRs\n- `list_pull_requests` - Listar PRs\n- `merge_pull_request` - Fazer merge de PRs\n- `review_pull_request` - Revisar PRs\n\n### Arquivos\n- `get_file` - Obter conte\u00fado de arquivos\n- `create_or_update_file` - Criar/atualizar arquivos\n- `push_files` - Push de m\u00faltiplos arquivos\n- `delete_file` - Deletar arquivos\n\n### Busca\n- `search_code` - Buscar c\u00f3digo\n- `search_issues` - Buscar issues\n- `search_repositories` - Buscar reposit\u00f3rios\n- `search_users` - Buscar usu\u00e1rios\n\n### Workflows\n- `list_workflows` - Listar workflows\n- `trigger_workflow` - Disparar workflows\n- `get_workflow_runs` - Obter execu\u00e7\u00f5es de workflows\n\n## Integra\u00e7\u00e3o Autom\u00e1tica com IAL\n\n### Triggers Autom\u00e1ticos\n\n1. **Mudan\u00e7as de Infraestrutura**\n   - Evento: `infrastructure_change`\n   - A\u00e7\u00e3o: Criar PR automaticamente\n   - Template: `infrastructure_update`\n\n2. **Detec\u00e7\u00e3o de Dr"
    },
    {
      "source": "docs/github-mcp-integration.md",
      "text": "ift**\n   - Evento: `drift_detected`\n   - A\u00e7\u00e3o: Criar issue automaticamente\n   - Template: `drift_alert`\n\n3. **Deploy Completo**\n   - Evento: `deployment_complete`\n   - A\u00e7\u00e3o: Atualizar issue existente\n   - Template: `deployment_status`\n\n### Palavras-chave de Ativa\u00e7\u00e3o\n\nO GitHub MCP \u00e9 ativado automaticamente quando detectadas as seguintes palavras-chave:\n\n- `github`, `git`, `repository`, `repo`\n- `pull request`, `pr`, `commit`, `branch`, `merge`\n- `issue`, `workflow`, `action`\n- `ci/cd`, `pipeline`, `deployment`, `release`\n\n## Exemplos de Uso\n\n### Criar Reposit\u00f3rio\n```python\nresult = await github_mcp.create_repository(\n    name=\"my-new-repo\",\n    description=\"Repository created by IAL\",\n    private=False\n)\n```\n\n### Criar Issue para Drift\n```python\nresult = await github_mcp.create_issue(\n    owner=\"myorg\",\n    repo=\"infrastructure\",\n    title=\"Infrastructure Drift Detected - S3 Bucket\",\n    body=\"Drift detected in S3 bucket configuration...\"\n)\n```\n\n### Criar PR para Mudan\u00e7as\n```python\nresult = await github_mcp.create_pull_request(\n    owner=\"myorg\",\n    repo=\"infrastructure\",\n    title=\"Infrastructure Update - 2025-11-05\",\n    body=\"Automated infrastructure changes...\",\n    head=\"feature/auto-update\",\n    base=\"main\"\n)\n```\n\n## Monitoramento\n\n### M\u00e9tricas Coletadas\n- `api_calls_total` - Total de chamadas \u00e0 API\n- `api_errors_total` - Total de erros\n- `response_time` - Tempo de resposta\n- `rate_limit_remaining` - Rate limit restante\n\n### Alertas Configurados\n- Rate limit baixo (< 100 requests)\n- Muitos erros (> 10 erros)\n\n## Seguran\u00e7a\n\n### Configura\u00e7\u00f5es de Seguran\u00e7a\n- Valida\u00e7\u00e3o de token obrigat\u00f3ria\n- Rate limiting habilitado\n- Opera\u00e7\u00f5es permitidas: read, write, admin (reposit\u00f3rios espec\u00edficos)\n\n### Boas Pr\u00e1ticas\n1. Use Personal Access Tokens com escopo m\u00ednimo necess\u00e1rio\n2. Configure webhooks para eventos importantes\n3. Monitore uso de rate limits\n4. Revise permiss\u00f5es regularmente\n\n## Troubleshooting\n\n### Problemas Comuns\n\n1. **Token inv\u00e1lido**\n   - Verifique se `GITHUB_TOK"
    },
    {
      "source": "docs/github-mcp-integration.md",
      "text": "EN` est\u00e1 configurado\n   - Confirme se o token tem as permiss\u00f5es necess\u00e1rias\n\n2. **Rate limit excedido**\n   - Aguarde reset do rate limit\n   - Configure throttling autom\u00e1tico\n\n3. **Timeout de conex\u00e3o**\n   - Verifique conectividade de rede\n   - Aumente timeout se necess\u00e1rio\n\n### Logs\n```bash\n# Visualizar logs do GitHub MCP\ntail -f /home/ial/logs/github_mcp.log\n\n# Filtrar erros\ngrep \"ERROR\" /home/ial/logs/github_mcp.log\n```\n\n## Pr\u00f3ximos Passos\n\n1. Configurar webhooks para eventos GitHub\n2. Implementar sincroniza\u00e7\u00e3o bidirecional\n3. Adicionar suporte para GitHub Actions\n4. Integrar com sistema de notifica\u00e7\u00f5es IAL\n"
    },
    {
      "source": "phases/00-foundation/01-dynamodb-state.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - DynamoDB State Tables'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Main state table\n  StateTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-state'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: id\n          KeyType: HASH\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: StateTracking\n\n  # MCP provisioning checklist table\n  MCPProvisioningTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: mcp-provisioning-checklist\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: resource_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: resource_id\n          KeyType: HASH\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: MCPProvisioning\n\nOutputs:\n  StateTableName:\n    Description: Name of the state table\n    Value: !Ref StateTable\n    Export:\n      Name: !Sub '${ProjectName}-StateTableName'\n  \n  StateTableArn:\n    Description: ARN of the state table\n    Value: !GetAtt StateTable.Arn\n    Export:\n      Name: !Sub '${ProjectName}-StateTableArn'\n"
    },
    {
      "source": "phases/00-foundation/02-kms-keys.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: IAL Generated Template - 02-kms-keys\nOutputs:\n  TemplateGenerated:\n    Description: Template generated by IAL\n    Value: 02-kms-keys - Generated automatically\nParameters:\n  ProjectName:\n    Default: 'test-project'\n    Description: Project name for resource naming\n    Type: String\nResources:\n  PlaceholderResource:\n    Properties: {}\n    Type: AWS::CloudFormation::WaitConditionHandle\n"
    },
    {
      "source": "phases/00-foundation/03-reconciliation-engine.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Reconciliation Engine Lambda'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # IAM Role for Reconciliation Lambda\n  ReconciliationRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-reconciliation-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: ReconciliationPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:UpdateItem\n                  - dynamodb:Query\n                  - dynamodb:Scan\n                Resource: !Sub 'arn:aws:dynamodb:*:*:table/${ProjectName}-*'\n              - Effect: Allow\n                Action:\n                  - logs:CreateLogGroup\n                  - logs:CreateLogStream\n                  - logs:PutLogEvents\n                Resource: '*'\n\n  # Reconciliation Lambda Function\n  ReconciliationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-reconciliation-engine'\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt ReconciliationRole.Arn\n      Timeout: 300\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          import logging\n          \n          logger = logging.getLogger()\n          logger.setLevel(logging.INFO)\n          \n          def lambda_handler(event, context):\n              \"\"\"\n              IAL Reconciliation Engine - Drift Detection"
    },
    {
      "source": "phases/00-foundation/03-reconciliation-engine.yaml",
      "text": " and State Reconciliation\n              \"\"\"\n              logger.info(f\"Reconciliation event: {event}\")\n              \n              try:\n                  # Extract resource information\n                  resource_type = event.get('resource_type', 'unknown')\n                  resource_id = event.get('resource_id', 'unknown')\n                  desired_state = event.get('desired_state', {})\n                  \n                  # Perform reconciliation logic\n                  result = perform_reconciliation(resource_type, resource_id, desired_state)\n                  \n                  return {\n                      'statusCode': 200,\n                      'body': json.dumps({\n                          'message': 'Reconciliation completed',\n                          'resource_type': resource_type,\n                          'resource_id': resource_id,\n                          'drift_detected': result.get('drift_detected', False),\n                          'actions_taken': result.get('actions_taken', []),\n                          'timestamp': context.aws_request_id\n                      })\n                  }\n                  \n              except Exception as e:\n                  logger.error(f\"Reconciliation error: {str(e)}\")\n                  return {\n                      'statusCode': 500,\n                      'body': json.dumps({\n                          'error': str(e),\n                          'resource_type': resource_type,\n                          'resource_id': resource_id\n                      })\n                  }\n          \n          def perform_reconciliation(resource_type, resource_id, desired_state):\n              \"\"\"Perform actual reconciliation logic\"\"\"\n              # This would contain the actual reconciliation logic\n              # For now, return a basic response\n              return {\n                  'drift_detected': False,\n                  'actions_taken': ['state_verified'],\n                  'reconciliation_status': 'completed'\n    "
    },
    {
      "source": "phases/00-foundation/03-reconciliation-engine.yaml",
      "text": "          }\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: Reconciliation\n\nOutputs:\n  ReconciliationFunctionArn:\n    Description: ARN of the reconciliation function\n    Value: !GetAtt ReconciliationFunction.Arn\n    Export:\n      Name: !Sub '${ProjectName}-ReconciliationFunctionArn'\n  \n  ReconciliationFunctionName:\n    Description: Name of the reconciliation function\n    Value: !Ref ReconciliationFunction\n    Export:\n      Name: !Sub '${ProjectName}-ReconciliationFunctionName'\n"
    },
    {
      "source": "phases/00-foundation/04-iam-roles.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: IAL Generated Template - 04-iam-roles\nOutputs:\n  TemplateGenerated:\n    Description: Template generated by IAL\n    Value: 04-iam-roles - Generated automatically\nParameters:\n  ProjectName:\n    Default: 'test-project'\n    Description: Project name for resource naming\n    Type: String\nResources:\n  PlaceholderResource:\n    Properties: {}\n    Type: AWS::CloudFormation::WaitConditionHandle\n"
    },
    {
      "source": "phases/00-foundation/05-chaos-engineering.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IaL Phase 00e - Chaos Engineering with AWS FIS'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: 'ial'\n  Environment:\n    Type: String\n    Default: 'dev'\n  ChaosEnabled:\n    Type: String\n    Default: 'false'\n    Description: 'Enable chaos engineering experiments (disabled by default for safety)'\n    AllowedValues: ['true', 'false']\n\nConditions:\n  IsChaosEnabled: !Equals [!Ref ChaosEnabled, 'true']\n\nResources:\n  # IAM Role for FIS Experiments\n  FISExecutionRole:\n    Type: AWS::IAM::Role\n    Condition: IsChaosEnabled\n    Properties:\n      RoleName: !Sub '${ProjectName}-fis-execution-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: fis.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSFaultInjectionSimulatorNetworkAccess\n        - arn:aws:iam::aws:policy/service-role/AWSFaultInjectionSimulatorECSAccess\n        - arn:aws:iam::aws:policy/service-role/AWSFaultInjectionSimulatorEC2Access\n      Policies:\n        - PolicyName: FISChaosPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - ec2:DescribeInstances\n                  - ec2:StopInstances\n                  - ec2:RebootInstances\n                  - ecs:DescribeServices\n                  - ecs:UpdateService\n                  - ecs:DescribeTasks\n                  - ecs:StopTask\n                  - logs:CreateLogGroup\n                  - logs:CreateLogStream\n                  - logs:PutLogEvents\n                  - cloudwatch:PutMetricData\n                Resource: '*'\n\n  # Network Latency Experiment\n  NetworkLatencyExperiment:\n    Type: AWS::FIS::ExperimentTemplate\n    Condition: IsChaosEnabled\n    Properties:\n      Description: 'Network latency injection for resilience "
    },
    {
      "source": "phases/00-foundation/05-chaos-engineering.yaml",
      "text": "testing'\n      RoleArn: !GetAtt FISExecutionRole.Arn\n      Actions:\n        NetworkLatency:\n          ActionId: aws:network:latency-sources\n          Parameters:\n            duration: PT5M\n            latencyMs: '100'\n            jitterMs: '50'\n          Targets:\n            Subnets: NetworkTargets\n      Targets:\n        NetworkTargets:\n          ResourceType: aws:ec2:subnet\n          ResourceTags:\n            Environment: !Ref Environment\n          SelectionMode: PERCENT(50)\n      StopConditions:\n        - Source: aws:cloudwatch:alarm\n          Value: !Ref ChaosStopCondition\n      Tags:\n        Name: !Sub '${ProjectName}-network-latency'\n        Environment: !Ref Environment\n        Type: 'chaos-engineering'\n\n  # Instance Termination Experiment\n  InstanceTerminationExperiment:\n    Type: AWS::FIS::ExperimentTemplate\n    Condition: IsChaosEnabled\n    Properties:\n      Description: 'Random instance termination for auto-recovery testing'\n      RoleArn: !GetAtt FISExecutionRole.Arn\n      Actions:\n        StopInstances:\n          ActionId: aws:ec2:stop-instances\n          Parameters:\n            startInstancesAfterDuration: PT10M\n          Targets:\n            Instances: InstanceTargets\n      Targets:\n        InstanceTargets:\n          ResourceType: aws:ec2:instance\n          ResourceTags:\n            Environment: !Ref Environment\n            ChaosEnabled: 'true'\n          SelectionMode: COUNT(1)\n      StopConditions:\n        - Source: aws:cloudwatch:alarm\n          Value: !Ref ChaosStopCondition\n      Tags:\n        Name: !Sub '${ProjectName}-instance-termination'\n        Environment: !Ref Environment\n        Type: 'chaos-engineering'\n\n  # ECS Task Termination Experiment\n  ECSTaskTerminationExperiment:\n    Type: AWS::FIS::ExperimentTemplate\n    Condition: IsChaosEnabled\n    Properties:\n      Description: 'ECS task termination for service resilience testing'\n      RoleArn: !GetAtt FISExecutionRole.Arn\n      Actions:\n        StopTasks:\n          ActionId: aws:ecs:stop-task"
    },
    {
      "source": "phases/00-foundation/05-chaos-engineering.yaml",
      "text": "\n          Parameters:\n            reason: 'Chaos engineering test'\n          Targets:\n            Tasks: ECSTaskTargets\n      Targets:\n        ECSTaskTargets:\n          ResourceType: aws:ecs:task\n          ResourceTags:\n            Environment: !Ref Environment\n          SelectionMode: PERCENT(25)\n      StopConditions:\n        - Source: aws:cloudwatch:alarm\n          Value: !Ref ChaosStopCondition\n      Tags:\n        Name: !Sub '${ProjectName}-ecs-task-termination'\n        Environment: !Ref Environment\n        Type: 'chaos-engineering'\n\n  # CloudWatch Alarm for Stop Condition\n  ChaosStopCondition:\n    Type: AWS::CloudWatch::Alarm\n    Condition: IsChaosEnabled\n    Properties:\n      AlarmName: !Sub '${ProjectName}-chaos-stop-condition'\n      AlarmDescription: 'Stop chaos experiments if system becomes unhealthy'\n      MetricName: HealthyHostCount\n      Namespace: AWS/ApplicationELB\n      Statistic: Average\n      Period: 60\n      EvaluationPeriods: 2\n      Threshold: 1\n      ComparisonOperator: LessThanThreshold\n      TreatMissingData: breaching\n\n  # SNS Topic for Chaos Notifications\n  ChaosNotificationTopic:\n    Type: AWS::SNS::Topic\n    Condition: IsChaosEnabled\n    Properties:\n      TopicName: !Sub '${ProjectName}-chaos-notifications'\n      DisplayName: 'IaL Chaos Engineering Notifications'\n\n  # CloudWatch Log Group for Chaos Events\n  ChaosLogGroup:\n    Type: AWS::Logs::LogGroup\n    Condition: IsChaosEnabled\n    Properties:\n      LogGroupName: !Sub '/aws/fis/${ProjectName}-chaos'\n      RetentionInDays: 30\n\n  # Custom Metrics for Chaos Engineering\n  ChaosMetricsNamespace:\n    Type: AWS::CloudWatch::CompositeAlarm\n    Condition: IsChaosEnabled\n    Properties:\n      AlarmName: !Sub '${ProjectName}-chaos-health-composite'\n      AlarmDescription: 'Composite alarm for chaos engineering health'\n      AlarmRule: !Sub |\n        ALARM(\"${ChaosStopCondition}\") OR\n        ALARM(\"${ProjectName}-high-error-rate\") OR\n        ALARM(\"${ProjectName}-high-latency\")\n\nOutputs:\n  FISExec"
    },
    {
      "source": "phases/00-foundation/05-chaos-engineering.yaml",
      "text": "utionRoleArn:\n    Description: 'ARN of the FIS execution role'\n    Value: !GetAtt FISExecutionRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-fis-execution-role-arn'\n    Condition: IsChaosEnabled\n\n  NetworkLatencyExperimentId:\n    Description: 'ID of the network latency experiment template'\n    Value: !Ref NetworkLatencyExperiment\n    Export:\n      Name: !Sub '${ProjectName}-network-latency-experiment'\n    Condition: IsChaosEnabled\n\n  InstanceTerminationExperimentId:\n    Description: 'ID of the instance termination experiment template'\n    Value: !Ref InstanceTerminationExperiment\n    Export:\n      Name: !Sub '${ProjectName}-instance-termination-experiment'\n    Condition: IsChaosEnabled\n\n  ECSTaskTerminationExperimentId:\n    Description: 'ID of the ECS task termination experiment template'\n    Value: !Ref ECSTaskTerminationExperiment\n    Export:\n      Name: !Sub '${ProjectName}-ecs-task-termination-experiment'\n    Condition: IsChaosEnabled\n\n  ChaosNotificationTopicArn:\n    Description: 'ARN of the chaos notification topic'\n    Value: !Ref ChaosNotificationTopic\n    Export:\n      Name: !Sub '${ProjectName}-chaos-notification-topic'\n    Condition: IsChaosEnabled\n\n  ChaosLogGroupName:\n    Description: 'Name of the chaos log group'\n    Value: !Ref ChaosLogGroup\n    Export:\n      Name: !Sub '${ProjectName}-chaos-log-group'\n    Condition: IsChaosEnabled\n"
    },
    {
      "source": "phases/00-foundation/06-memory-s3.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Memory - S3 Bucket for Conversation Archive'\n\nResources:\n  # Bucket para arquivamento de conversas\n  MemoryBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub \"ial-memory-${AWS::AccountId}-${AWS::Region}\"\n      VersioningConfiguration:\n        Status: Enabled\n      LifecycleConfiguration:\n        Rules:\n          - Id: ArchiveOldConversations\n            Status: Enabled\n            Transitions:\n              - TransitionInDays: 30\n                StorageClass: STANDARD_IA\n              - TransitionInDays: 90\n                StorageClass: GLACIER\n              - TransitionInDays: 365\n                StorageClass: DEEP_ARCHIVE\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      Tags:\n        - Key: Component\n          Value: IAL-Memory\n        - Key: Purpose\n          Value: Conversation-Archive\n\nOutputs:\n  MemoryBucketName:\n    Description: 'Nome do bucket de mem\u00f3ria'\n    Value: !Ref MemoryBucket\n    Export:\n      Name: !Sub \"${AWS::StackName}-memory-bucket\"\n\n  MemoryBucketArn:\n    Description: 'ARN do bucket de mem\u00f3ria'\n    Value: !GetAtt MemoryBucket.Arn\n    Export:\n      Name: !Sub \"${AWS::StackName}-memory-bucket-arn\"\n"
    },
    {
      "source": "phases/00-foundation/07-conversation-memory.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IaL Conversation Memory System - DynamoDB tables for Bedrock conversations'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: 'ial'\n  Environment:\n    Type: String\n    Default: 'prod'\n\nResources:\n  # Conversation History Table\n  ConversationHistoryTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-conversation-history'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: sort_key\n          AttributeType: S\n      KeySchema:\n        - AttributeName: user_id\n          KeyType: HASH\n        - AttributeName: sort_key\n          KeyType: RANGE\n      TimeToLiveSpecification:\n        AttributeName: ttl\n        Enabled: true\n      StreamSpecification:\n        StreamViewType: NEW_AND_OLD_IMAGES\n      PointInTimeRecoverySpecification:\n        PointInTimeRecoveryEnabled: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Environment\n          Value: !Ref Environment\n        - Key: Purpose\n          Value: ConversationHistory\n        - Key: ManagedBy\n          Value: IaL-Framework\n\n  # User Sessions Table\n  UserSessionsTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-user-sessions'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: session_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: user_id\n          KeyType: HASH\n        - AttributeName: session_id\n          KeyType: RANGE\n      TimeToLiveSpecification:\n        AttributeName: ttl\n        Enabled: true\n      PointInTimeRecoverySpecification:\n        PointInTimeRecoveryEnabled: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Environment\n          Value: !Ref Environment\n        - Key: Purpose\n  "
    },
    {
      "source": "phases/00-foundation/07-conversation-memory.yaml",
      "text": "        Value: UserSessions\n        - Key: ManagedBy\n          Value: IaL-Framework\n\n  # Context Windows Table (for conversation summarization)\n  ContextWindowsTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-context-windows'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: window_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: user_id\n          KeyType: HASH\n        - AttributeName: window_id\n          KeyType: RANGE\n      TimeToLiveSpecification:\n        AttributeName: ttl\n        Enabled: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Environment\n          Value: !Ref Environment\n        - Key: Purpose\n          Value: ContextWindows\n        - Key: ManagedBy\n          Value: IaL-Framework\n\n  # Token Usage Tracking Table\n  TokenUsageTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-token-usage'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: date_hour\n          AttributeType: S\n      KeySchema:\n        - AttributeName: user_id\n          KeyType: HASH\n        - AttributeName: date_hour\n          KeyType: RANGE\n      TimeToLiveSpecification:\n        AttributeName: ttl\n        Enabled: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Environment\n          Value: !Ref Environment\n        - Key: Purpose\n          Value: TokenUsageTracking\n        - Key: ManagedBy\n          Value: IaL-Framework\n\n  # Conversation Cache Table (for response optimization)\n  ConversationCacheTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-conversation-cache'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: cache_key\n          A"
    },
    {
      "source": "phases/00-foundation/07-conversation-memory.yaml",
      "text": "ttributeType: S\n      KeySchema:\n        - AttributeName: cache_key\n          KeyType: HASH\n      TimeToLiveSpecification:\n        AttributeName: ttl\n        Enabled: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Environment\n          Value: !Ref Environment\n        - Key: Purpose\n          Value: ConversationCache\n        - Key: ManagedBy\n          Value: IaL-Framework\n\n  # IAM Role for Bedrock Conversation Engine\n  BedrockConversationRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-bedrock-conversation-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: \n                - lambda.amazonaws.com\n                - ecs-tasks.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: BedrockConversationPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - bedrock:InvokeModel\n                  - bedrock:InvokeModelWithResponseStream\n                Resource:\n                  - !Sub 'arn:aws:bedrock:${AWS::Region}::foundation-model/anthropic.claude-3-5-sonnet-20241022-v2:0'\n                  - !Sub 'arn:aws:bedrock:${AWS::Region}::foundation-model/anthropic.claude-3-haiku-20240307-v1:0'\n              - Effect: Allow\n                Action:\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:UpdateItem\n                  - dynamodb:DeleteItem\n                  - dynamodb:Query\n                  - dynamodb:Scan\n                Resource:\n                  - !GetAtt ConversationHistoryTable.Arn\n                  - !GetAtt UserSessionsTable.Arn\n                  - !GetAtt ContextWindowsTable.Arn\n                "
    },
    {
      "source": "phases/00-foundation/07-conversation-memory.yaml",
      "text": "  - !GetAtt TokenUsageTable.Arn\n                  - !GetAtt ConversationCacheTable.Arn\n              - Effect: Allow\n                Action:\n                  - logs:CreateLogGroup\n                  - logs:CreateLogStream\n                  - logs:PutLogEvents\n                Resource: '*'\n\n  # CloudWatch Dashboard for Conversation Monitoring\n  ConversationDashboard:\n    Type: AWS::CloudWatch::Dashboard\n    Properties:\n      DashboardName: !Sub '${ProjectName}-conversation-monitoring'\n      DashboardBody: !Sub |\n        {\n          \"widgets\": [\n            {\n              \"type\": \"text\",\n              \"x\": 0,\n              \"y\": 0,\n              \"width\": 24,\n              \"height\": 2,\n              \"properties\": {\n                \"markdown\": \"# \ud83e\udde0 IaL Conversation Monitoring Dashboard\\n**Real-time Bedrock conversation analytics and cost tracking**\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 0,\n              \"y\": 2,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"AWS/DynamoDB\", \"ConsumedReadCapacityUnits\", \"TableName\", \"${ProjectName}-conversation-history\"],\n                  [\".\", \"ConsumedWriteCapacityUnits\", \".\", \".\"],\n                  [\".\", \"ConsumedReadCapacityUnits\", \"TableName\", \"${ProjectName}-user-sessions\"],\n                  [\".\", \"ConsumedWriteCapacityUnits\", \".\", \".\"]\n                ],\n                \"view\": \"timeSeries\",\n                \"stacked\": false,\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\ud83d\udcca DynamoDB Usage\",\n                \"period\": 300,\n                \"stat\": \"Sum\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 12,\n              \"y\": 2,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"IaL/Conversations\", \"TokensUsed\", \"Model\", \"sonnet\"],\n             "
    },
    {
      "source": "phases/00-foundation/07-conversation-memory.yaml",
      "text": "     [\".\", \".\", \".\", \"haiku\"],\n                  [\".\", \"ConversationCount\"],\n                  [\".\", \"AverageResponseTime\"]\n                ],\n                \"view\": \"timeSeries\",\n                \"stacked\": false,\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\ud83e\udd16 Bedrock Usage\",\n                \"period\": 300,\n                \"stat\": \"Sum\"\n              }\n            }\n          ]\n        }\n\nOutputs:\n  ConversationHistoryTableName:\n    Description: 'Name of the conversation history table'\n    Value: !Ref ConversationHistoryTable\n    Export:\n      Name: !Sub '${ProjectName}-conversation-history-table'\n\n  UserSessionsTableName:\n    Description: 'Name of the user sessions table'\n    Value: !Ref UserSessionsTable\n    Export:\n      Name: !Sub '${ProjectName}-user-sessions-table'\n\n  BedrockConversationRoleArn:\n    Description: 'ARN of the Bedrock conversation role'\n    Value: !GetAtt BedrockConversationRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-bedrock-conversation-role-arn'\n\n  ConversationDashboardURL:\n    Description: 'URL to the conversation monitoring dashboard'\n    Value: !Sub 'https://console.aws.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=${ProjectName}-conversation-monitoring'\n    Export:\n      Name: !Sub '${ProjectName}-conversation-dashboard-url'\n"
    },
    {
      "source": "phases/00-foundation/08-rag-vector-store.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IaL RAG Vector Store - DynamoDB tables for vector embeddings and S3 bucket for knowledge storage'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: 'ial'\n    Description: 'Project name for resource naming'\n\nResources:\n  # S3 Bucket for Knowledge Base Storage\n  IaLKnowledgeBaseBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${ProjectName}-knowledge-base-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      LifecycleConfiguration:\n        Rules:\n          - Id: DeleteOldConversations\n            Status: Enabled\n            ExpirationInDays: 90  # Keep conversations for 90 days\n            Prefix: conversations/\n      NotificationConfiguration:\n        CloudWatchConfigurations:\n          - Event: s3:ObjectCreated:*\n            CloudWatchConfiguration:\n              LogGroupName: !Ref KnowledgeBaseLogGroup\n\n  # DynamoDB Table for Vector Embeddings\n  IaLVectorEmbeddingsTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-vector-embeddings'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: vector_id\n          AttributeType: S\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: timestamp\n          AttributeType: S\n      KeySchema:\n        - AttributeName: vector_id\n          KeyType: HASH\n      GlobalSecondaryIndexes:\n        - IndexName: UserIndex\n          KeySchema:\n            - AttributeName: user_id\n              KeyType: HASH\n            - AttributeName: timestamp\n              KeyType: RANGE\n          Projection:\n            ProjectionType: ALL\n      TimeToLiveSpecification:\n        AttributeNa"
    },
    {
      "source": "phases/00-foundation/08-rag-vector-store.yaml",
      "text": "me: ttl\n        Enabled: true\n      StreamSpecification:\n        StreamViewType: NEW_AND_OLD_IMAGES\n      PointInTimeRecoverySpecification:\n        PointInTimeRecoveryEnabled: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: RAG-VectorStore\n        - Key: Environment\n          Value: production\n\n  # DynamoDB Table for Knowledge Base Metadata\n  IaLKnowledgeBaseTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-knowledge-base'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: knowledge_id\n          AttributeType: S\n        - AttributeName: category\n          AttributeType: S\n        - AttributeName: created_at\n          AttributeType: S\n      KeySchema:\n        - AttributeName: knowledge_id\n          KeyType: HASH\n      GlobalSecondaryIndexes:\n        - IndexName: CategoryIndex\n          KeySchema:\n            - AttributeName: category\n              KeyType: HASH\n            - AttributeName: created_at\n              KeyType: RANGE\n          Projection:\n            ProjectionType: ALL\n      TimeToLiveSpecification:\n        AttributeName: ttl\n        Enabled: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: RAG-KnowledgeBase\n        - Key: Environment\n          Value: production\n\n  # CloudWatch Log Group for Knowledge Base\n  KnowledgeBaseLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '/aws/ial/${ProjectName}/knowledge-base'\n      RetentionInDays: 30\n\n  # IAM Role for RAG Operations\n  IaLRAGExecutionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-rag-execution-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service:\n                - lambda.amazonaws.com\n                - ecs-tasks.amazonaws.c"
    },
    {
      "source": "phases/00-foundation/08-rag-vector-store.yaml",
      "text": "om\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: RAGOperationsPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:UpdateItem\n                  - dynamodb:DeleteItem\n                  - dynamodb:Query\n                  - dynamodb:Scan\n                Resource:\n                  - !GetAtt IaLVectorEmbeddingsTable.Arn\n                  - !Sub '${IaLVectorEmbeddingsTable.Arn}/index/*'\n                  - !GetAtt IaLKnowledgeBaseTable.Arn\n                  - !Sub '${IaLKnowledgeBaseTable.Arn}/index/*'\n              - Effect: Allow\n                Action:\n                  - s3:GetObject\n                  - s3:PutObject\n                  - s3:DeleteObject\n                  - s3:ListBucket\n                Resource:\n                  - !GetAtt IaLKnowledgeBaseBucket.Arn\n                  - !Sub '${IaLKnowledgeBaseBucket.Arn}/*'\n              - Effect: Allow\n                Action:\n                  - bedrock:InvokeModel\n                Resource:\n                  - arn:aws:bedrock:*::foundation-model/amazon.titan-embed-text-v1\n                  - arn:aws:bedrock:*::foundation-model/anthropic.claude-3-haiku-20240307-v1:0\n              - Effect: Allow\n                Action:\n                  - logs:CreateLogGroup\n                  - logs:CreateLogStream\n                  - logs:PutLogEvents\n                Resource: !Sub 'arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/ial/${ProjectName}/*'\n\n  # Lambda Function for RAG Processing (Optional)\n  RAGProcessorFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-rag-processor'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt"
    },
    {
      "source": "phases/00-foundation/08-rag-vector-store.yaml",
      "text": " IaLRAGExecutionRole.Arn\n      Timeout: 300\n      MemorySize: 512\n      Environment:\n        Variables:\n          KNOWLEDGE_BUCKET: !Ref IaLKnowledgeBaseBucket\n          VECTOR_TABLE: !Ref IaLVectorEmbeddingsTable\n          KNOWLEDGE_TABLE: !Ref IaLKnowledgeBaseTable\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          import os\n          \n          def lambda_handler(event, context):\n              \"\"\"Process RAG operations via Lambda\"\"\"\n              \n              try:\n                  # Initialize clients\n                  s3 = boto3.client('s3')\n                  dynamodb = boto3.client('dynamodb')\n                  \n                  # Get environment variables\n                  knowledge_bucket = os.environ['KNOWLEDGE_BUCKET']\n                  vector_table = os.environ['VECTOR_TABLE']\n                  \n                  # Process the event\n                  operation = event.get('operation', 'process_conversation')\n                  \n                  if operation == 'process_conversation':\n                      # Process conversation for RAG storage\n                      conversation_data = event.get('conversation_data', {})\n                      \n                      # Store conversation in S3\n                      s3_key = f\"conversations/{conversation_data.get('user_id', 'unknown')}/{conversation_data.get('timestamp', '')}.json\"\n                      \n                      s3.put_object(\n                          Bucket=knowledge_bucket,\n                          Key=s3_key,\n                          Body=json.dumps(conversation_data),\n                          ContentType='application/json'\n                      )\n                      \n                      return {\n                          'statusCode': 200,\n                          'body': json.dumps({\n                              'message': 'Conversation processed successfully',\n                              's3_key': s3_key\n                          })\n        "
    },
    {
      "source": "phases/00-foundation/08-rag-vector-store.yaml",
      "text": "              }\n                  \n                  else:\n                      return {\n                          'statusCode': 400,\n                          'body': json.dumps({'error': f'Unknown operation: {operation}'})\n                      }\n              \n              except Exception as e:\n                  return {\n                      'statusCode': 500,\n                      'body': json.dumps({'error': str(e)})\n                  }\n\nOutputs:\n  KnowledgeBaseBucket:\n    Description: 'S3 Bucket for knowledge base storage'\n    Value: !Ref IaLKnowledgeBaseBucket\n    Export:\n      Name: !Sub '${ProjectName}-knowledge-base-bucket'\n\n  VectorEmbeddingsTable:\n    Description: 'DynamoDB table for vector embeddings'\n    Value: !Ref IaLVectorEmbeddingsTable\n    Export:\n      Name: !Sub '${ProjectName}-vector-embeddings-table'\n\n  KnowledgeBaseTable:\n    Description: 'DynamoDB table for knowledge base metadata'\n    Value: !Ref IaLKnowledgeBaseTable\n    Export:\n      Name: !Sub '${ProjectName}-knowledge-base-table'\n\n  RAGExecutionRole:\n    Description: 'IAM role for RAG operations'\n    Value: !GetAtt IaLRAGExecutionRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-rag-execution-role-arn'\n\n  RAGProcessorFunction:\n    Description: 'Lambda function for RAG processing'\n    Value: !Ref RAGProcessorFunction\n    Export:\n      Name: !Sub '${ProjectName}-rag-processor-function'\n"
    },
    {
      "source": "phases/00-foundation/09-stepfunctions-orchestrator.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Step Functions Orchestrator'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # IAM Role for Step Functions\n  StepFunctionsRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-stepfunctions-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: states.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/AWSXrayWriteOnlyAccess\n      Policies:\n        - PolicyName: StepFunctionsExecutionPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - lambda:InvokeFunction\n                Resource: !Sub 'arn:aws:lambda:*:*:function:${ProjectName}-*'\n              - Effect: Allow\n                Action:\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:UpdateItem\n                  - dynamodb:Query\n                Resource: !Sub 'arn:aws:dynamodb:*:*:table/${ProjectName}-*'\n              - Effect: Allow\n                Action:\n                  - logs:CreateLogGroup\n                  - logs:CreateLogStream\n                  - logs:PutLogEvents\n                Resource: '*'\n\n  # Main orchestrator state machine\n  OrchestratorStateMachine:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: !Sub '${ProjectName}-orchestrator'\n      RoleArn: !GetAtt StepFunctionsRole.Arn\n      StateMachineType: STANDARD\n      DefinitionString: !Sub |\n        {\n          \"Comment\": \"IAL Foundation Orchestrator\",\n          \"StartAt\": \"InitializeOrchestration\",\n          \"States\": {\n            \"InitializeOrchestration\": {\n              \"Type\": \"Pass\",\n              \"Parameters\": "
    },
    {
      "source": "phases/00-foundation/09-stepfunctions-orchestrator.yaml",
      "text": "{\n                \"project_name\": \"${ProjectName}\",\n                \"timestamp.$\": \"$$.State.EnteredTime\",\n                \"execution_id.$\": \"$$.Execution.Name\"\n              },\n              \"Next\": \"ProcessRequest\"\n            },\n            \"ProcessRequest\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${ProjectName}-processor\",\n                \"Payload.$\": \"$\"\n              },\n              \"Next\": \"CheckResult\"\n            },\n            \"CheckResult\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [\n                {\n                  \"Variable\": \"$.Payload.success\",\n                  \"BooleanEquals\": true,\n                  \"Next\": \"Success\"\n                }\n              ],\n              \"Default\": \"Failure\"\n            },\n            \"Success\": {\n              \"Type\": \"Succeed\",\n              \"OutputPath\": \"$.Payload\"\n            },\n            \"Failure\": {\n              \"Type\": \"Fail\",\n              \"Cause\": \"Processing failed\"\n            }\n          }\n        }\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: Orchestration\n\n  # Circuit breaker state machine\n  CircuitBreakerStateMachine:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: !Sub '${ProjectName}-circuit-breaker'\n      RoleArn: !GetAtt StepFunctionsRole.Arn\n      StateMachineType: EXPRESS\n      DefinitionString: !Sub |\n        {\n          \"Comment\": \"IAL Circuit Breaker Pattern\",\n          \"StartAt\": \"CheckCircuitState\",\n          \"States\": {\n            \"CheckCircuitState\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::dynamodb:getItem\",\n              \"Parameters\": {\n                \"TableName\": \"${ProjectName}-state\",\n                \"Key\": {\n                  \"id\": {\n                    \"S\": \"c"
    },
    {
      "source": "phases/00-foundation/09-stepfunctions-orchestrator.yaml",
      "text": "ircuit-breaker-state\"\n                  }\n                }\n              },\n              \"Next\": \"EvaluateCircuit\"\n            },\n            \"EvaluateCircuit\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [\n                {\n                  \"Variable\": \"$.Item.state.S\",\n                  \"StringEquals\": \"OPEN\",\n                  \"Next\": \"CircuitOpen\"\n                },\n                {\n                  \"Variable\": \"$.Item.state.S\",\n                  \"StringEquals\": \"HALF_OPEN\",\n                  \"Next\": \"CircuitHalfOpen\"\n                }\n              ],\n              \"Default\": \"CircuitClosed\"\n            },\n            \"CircuitClosed\": {\n              \"Type\": \"Succeed\"\n            },\n            \"CircuitHalfOpen\": {\n              \"Type\": \"Succeed\"\n            },\n            \"CircuitOpen\": {\n              \"Type\": \"Fail\",\n              \"Cause\": \"Circuit breaker is OPEN\"\n            }\n          }\n        }\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: CircuitBreaker\n\nOutputs:\n  OrchestratorStateMachineArn:\n    Description: ARN of the orchestrator state machine\n    Value: !Ref OrchestratorStateMachine\n    Export:\n      Name: !Sub '${ProjectName}-OrchestratorStateMachineArn'\n  \n  CircuitBreakerStateMachineArn:\n    Description: ARN of the circuit breaker state machine\n    Value: !Ref CircuitBreakerStateMachine\n    Export:\n      Name: !Sub '${ProjectName}-CircuitBreakerStateMachineArn'\n"
    },
    {
      "source": "phases/00-foundation/10-ial-dynamodb-tables.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Additional DynamoDB Tables'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Resource catalog table\n  ResourceCatalogTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-resource-catalog'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: resource_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: resource_id\n          KeyType: HASH\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: ResourceCatalog\n\n  # Deployment history table\n  DeploymentHistoryTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-deployment-history'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: deployment_id\n          AttributeType: S\n        - AttributeName: timestamp\n          AttributeType: S\n      KeySchema:\n        - AttributeName: deployment_id\n          KeyType: HASH\n        - AttributeName: timestamp\n          KeyType: RANGE\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: DeploymentHistory\n\nOutputs:\n  ResourceCatalogTableName:\n    Description: Name of the resource catalog table\n    Value: !Ref ResourceCatalogTable\n    Export:\n      Name: !Sub '${ProjectName}-ResourceCatalogTableName'\n  \n  DeploymentHistoryTableName:\n    Description: Name of the deployment history table\n    Value: !Ref DeploymentHistoryTable\n    Export:\n      Name: !Sub '${ProjectName}-DeploymentHistoryTableName'\n"
    },
    {
      "source": "phases/00-foundation/11-ial-s3-storage.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - S3 Storage Buckets'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Templates bucket\n  TemplatesBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${ProjectName}-templates-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      VersioningConfiguration:\n        Status: Enabled\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: Templates\n\n  # Artifacts bucket\n  ArtifactsBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${ProjectName}-artifacts-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: Artifacts\n\n  # State bucket\n  StateBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${ProjectName}-state-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: tru"
    },
    {
      "source": "phases/00-foundation/11-ial-s3-storage.yaml",
      "text": "e\n      VersioningConfiguration:\n        Status: Enabled\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: StateStorage\n\nOutputs:\n  TemplatesBucketName:\n    Description: Name of the templates bucket\n    Value: !Ref TemplatesBucket\n    Export:\n      Name: !Sub '${ProjectName}-TemplatesBucketName'\n  \n  ArtifactsBucketName:\n    Description: Name of the artifacts bucket\n    Value: !Ref ArtifactsBucket\n    Export:\n      Name: !Sub '${ProjectName}-ArtifactsBucketName'\n  \n  StateBucketName:\n    Description: Name of the state bucket\n    Value: !Ref StateBucket\n    Export:\n      Name: !Sub '${ProjectName}-StateBucketName'\n"
    },
    {
      "source": "phases/00-foundation/12-ial-rag-infrastructure.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 12 IAL rag infrastructure'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 12-ial-rag-infrastructure\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-12-ial-rag-infrastructure-Output'\n"
    },
    {
      "source": "phases/00-foundation/13-ial-drift-detection.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 13 IAL drift detection'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 13-ial-drift-detection\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-13-ial-drift-detection-Output'\n"
    },
    {
      "source": "phases/00-foundation/14-ial-lambda-functions.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 14 IAL lambda functions'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 14-ial-lambda-functions\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-14-ial-lambda-functions-Output'\n"
    },
    {
      "source": "phases/00-foundation/15-ial-bedrock-github-iam.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 15 IAL bedrock github iam'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 15-ial-bedrock-github-iam\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-15-ial-bedrock-github-iam-Output'\n"
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL GitOps Deployment Pipeline - Step Functions Orchestration'\n\nResources:\n  # IAM Role para Step Functions\n  GitOpsPipelineRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: IAL-GitOps-Pipeline-Role\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: states.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/CloudWatchLogsFullAccess\n      Policies:\n        - PolicyName: GitOpsPipelinePolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - lambda:InvokeFunction\n                  - cloudformation:*\n                  - dynamodb:PutItem\n                  - dynamodb:UpdateItem\n                  - s3:PutObject\n                  - s3:GetObject\n                Resource: '*'\n\n  # Lambda: Validate Phase (cfn-lint)\n  ValidatePhaseFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-gitops-validate-phase\n      Runtime: python3.11\n      Handler: index.handler\n      Role: !GetAtt ValidatePhaseFunctionRole.Arn\n      Timeout: 60\n      Code:\n        ZipFile: |\n          import json\n          import subprocess\n          def handler(event, context):\n              phase_file = event['phase_file']\n              # cfn-lint validation\n              result = subprocess.run(['cfn-lint', phase_file], capture_output=True)\n              return {\n                  'valid': result.returncode == 0,\n                  'errors': result.stderr.decode() if result.returncode != 0 else None\n              }\n\n  ValidatePhaseFunctionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n   "
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "         Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n\n  # Lambda: IAS Security Check\n  IASSecurityCheckFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-gitops-ias-check\n      Runtime: python3.11\n      Handler: index.handler\n      Role: !GetAtt IASSecurityCheckFunctionRole.Arn\n      Timeout: 120\n      Code:\n        ZipFile: |\n          import json\n          def handler(event, context):\n              # IAS validation logic\n              phase_content = event['phase_content']\n              risks = []\n              \n              # Check for public access\n              if 'PublicAccessBlockConfiguration' not in str(phase_content):\n                  risks.append({'severity': 'HIGH', 'message': 'Missing public access block'})\n              \n              return {\n                  'safe': len(risks) == 0,\n                  'risks': risks\n              }\n\n  IASSecurityCheckFunctionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n\n  # Lambda: Cost Estimation\n  CostEstimationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-gitops-cost-estimation\n      Runtime: python3.11\n      Handler: index.handler\n      Role: !GetAtt CostEstimationFunctionRole.Arn\n      Timeout: 60\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          def handler(event, context):\n              # Cost estimation via Pricing API\n              phase_content = event['phase_content']\n              \n              # Simplified cost estimation\n              estimated_cost = 0.0\n              \n              if 'AWS::EC2::Instance' in str(ph"
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "ase_content):\n                  estimated_cost += 50.0  # ~$50/month per instance\n              if 'AWS::RDS::DBInstance' in str(phase_content):\n                  estimated_cost += 100.0  # ~$100/month per RDS\n              \n              return {\n                  'estimated_monthly_cost': estimated_cost,\n                  'within_budget': estimated_cost < 500.0\n              }\n\n  CostEstimationFunctionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n        - arn:aws:iam::aws:policy/AWSPriceListServiceFullAccess\n\n  # Lambda: Create GitHub PR\n  CreateGitHubPRFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-gitops-create-pr\n      Runtime: python3.11\n      Handler: index.handler\n      Role: !GetAtt CreateGitHubPRFunctionRole.Arn\n      Timeout: 30\n      Environment:\n        Variables:\n          GITHUB_TOKEN: '{{resolve:secretsmanager:ial/github-token:SecretString:token}}'\n      Code:\n        ZipFile: |\n          import json\n          import os\n          import requests\n          def handler(event, context):\n              token = os.environ['GITHUB_TOKEN']\n              phase_name = event['phase_name']\n              \n              # Create PR via GitHub API\n              url = 'https://api.github.com/repos/diegonardoni/ial-infrastructure/pulls'\n              headers = {'Authorization': f'token {token}'}\n              data = {\n                  'title': f'Deploy: {phase_name}',\n                  'body': f'Automated deployment request for phase {phase_name}',\n                  'head': 'main',\n                  'base': 'main'\n              }\n              \n              response = requests.post(url, headers=headers, json=data)\n           "
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "   \n              return {\n                  'pr_number': response.json().get('number'),\n                  'pr_url': response.json().get('html_url')\n              }\n\n  CreateGitHubPRFunctionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n        - arn:aws:iam::aws:policy/SecretsManagerReadWrite\n\n  # Lambda: Deploy CloudFormation\n  DeployCloudFormationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-gitops-deploy-cfn\n      Runtime: python3.11\n      Handler: index.handler\n      Role: !GetAtt DeployCloudFormationFunctionRole.Arn\n      Timeout: 300\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          def handler(event, context):\n              cfn = boto3.client('cloudformation')\n              \n              stack_name = event['stack_name']\n              template_body = event['template_body']\n              \n              response = cfn.create_stack(\n                  StackName=stack_name,\n                  TemplateBody=template_body,\n                  Capabilities=['CAPABILITY_NAMED_IAM']\n              )\n              \n              return {\n                  'stack_id': response['StackId'],\n                  'status': 'CREATE_IN_PROGRESS'\n              }\n\n  DeployCloudFormationFunctionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n        - arn:aws:iam::aws:policy/AWSCloudFormationFullAccess\n\n  # Lam"
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "bda: Proof of Creation\n  ProofOfCreationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-gitops-proof-of-creation\n      Runtime: python3.11\n      Handler: index.handler\n      Role: !GetAtt ProofOfCreationFunctionRole.Arn\n      Timeout: 60\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          from datetime import datetime\n          def handler(event, context):\n              dynamodb = boto3.resource('dynamodb')\n              table = dynamodb.Table('ial-resource-catalog')\n              \n              stack_id = event['stack_id']\n              phase_name = event['phase_name']\n              \n              # Save proof\n              table.put_item(Item={\n                  'resource_id': stack_id,\n                  'phase': phase_name,\n                  'created_at': datetime.now().isoformat(),\n                  'proof_verified': True\n              })\n              \n              return {'proof_saved': True}\n\n  ProofOfCreationFunctionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n        - arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess\n\n  # Step Functions State Machine\n  GitOpsPipelineStateMachine:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: ial-gitops-deployment-pipeline\n      RoleArn: !GetAtt GitOpsPipelineRole.Arn\n      DefinitionString: !Sub |\n        {\n          \"Comment\": \"IAL GitOps Deployment Pipeline\",\n          \"StartAt\": \"ValidatePhase\",\n          \"States\": {\n            \"ValidatePhase\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${ValidatePhas"
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "eFunction}\",\n                \"Payload.$\": \"$\"\n              },\n              \"ResultPath\": \"$.validation\",\n              \"Next\": \"CheckValidation\"\n            },\n            \"CheckValidation\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [{\n                \"Variable\": \"$.validation.Payload.valid\",\n                \"BooleanEquals\": true,\n                \"Next\": \"IASSecurityCheck\"\n              }],\n              \"Default\": \"ValidationFailed\"\n            },\n            \"ValidationFailed\": {\n              \"Type\": \"Fail\",\n              \"Error\": \"ValidationError\",\n              \"Cause\": \"CloudFormation validation failed\"\n            },\n            \"IASSecurityCheck\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${IASSecurityCheckFunction}\",\n                \"Payload.$\": \"$\"\n              },\n              \"ResultPath\": \"$.ias\",\n              \"Next\": \"CheckIAS\"\n            },\n            \"CheckIAS\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [{\n                \"Variable\": \"$.ias.Payload.safe\",\n                \"BooleanEquals\": true,\n                \"Next\": \"CostEstimation\"\n              }],\n              \"Default\": \"SecurityRiskDetected\"\n            },\n            \"SecurityRiskDetected\": {\n              \"Type\": \"Fail\",\n              \"Error\": \"SecurityRisk\",\n              \"Cause\": \"IAS detected security risks\"\n            },\n            \"CostEstimation\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${CostEstimationFunction}\",\n                \"Payload.$\": \"$\"\n              },\n              \"ResultPath\": \"$.cost\",\n              \"Next\": \"CheckBudget\"\n            },\n            \"CheckBudget\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [{\n                \"Variable\": \"$.cost.Payload.within_budget\",\n                \"Boolean"
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "Equals\": true,\n                \"Next\": \"CreateGitHubPR\"\n              }],\n              \"Default\": \"BudgetExceeded\"\n            },\n            \"BudgetExceeded\": {\n              \"Type\": \"Fail\",\n              \"Error\": \"BudgetExceeded\",\n              \"Cause\": \"Estimated cost exceeds budget\"\n            },\n            \"CreateGitHubPR\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${CreateGitHubPRFunction}\",\n                \"Payload.$\": \"$\"\n              },\n              \"ResultPath\": \"$.pr\",\n              \"Next\": \"WaitForApproval\"\n            },\n            \"WaitForApproval\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke.waitForTaskToken\",\n              \"Parameters\": {\n                \"FunctionName\": \"${CreateGitHubPRFunction}\",\n                \"Payload\": {\n                  \"TaskToken.$\": \"$$.Task.Token\"\n                }\n              },\n              \"Next\": \"DeployCloudFormation\"\n            },\n            \"DeployCloudFormation\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${DeployCloudFormationFunction}\",\n                \"Payload.$\": \"$\"\n              },\n              \"ResultPath\": \"$.deployment\",\n              \"Next\": \"ProofOfCreation\"\n            },\n            \"ProofOfCreation\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${ProofOfCreationFunction}\",\n                \"Payload.$\": \"$\"\n              },\n              \"End\": true\n            }\n          }\n        }\n\nOutputs:\n  StateMachineArn:\n    Value: !GetAtt GitOpsPipelineStateMachine.Arn\n    Export:\n      Name: IAL-GitOps-Pipeline-Arn\n  \n  ValidatePhaseFunctionArn:\n    Value: !GetAtt ValidatePhaseFunction.Arn\n  \n  IASSecurityCheckFunctionArn:\n"
    },
    {
      "source": "phases/00-foundation/16-gitops-pipeline.yaml",
      "text": "    Value: !GetAtt IASSecurityCheckFunction.Arn\n  \n  CostEstimationFunctionArn:\n    Value: !GetAtt CostEstimationFunction.Arn\n"
    },
    {
      "source": "phases/00-foundation/16-ial-test-validation.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 16 IAL test validation'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 16-ial-test-validation\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-16-ial-test-validation-Output'\n"
    },
    {
      "source": "phases/00-foundation/17-ial-finops-budget-enforcement.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 17 IAL finops budget enforcement'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 17-ial-finops-budget-enforcement\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-17-ial-finops-budget-enforcement-Output'\n"
    },
    {
      "source": "phases/00-foundation/17-nl-intent-pipeline.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL NL Intent Pipeline - Complete Step Functions Orchestration'\n\nResources:\n  # Lambda Layer com depend\u00eancias\n  IALPipelineLayer:\n    Type: AWS::Lambda::LayerVersion\n    Properties:\n      LayerName: ial-pipeline-dependencies\n      Description: IAS, Cost Guardrails, Phase Builder\n      Content:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambda-layer/ial-pipeline-layer.zip\n      CompatibleRuntimes:\n        - python3.11\n\n  # IAM Role para Lambdas\n  IALPipelineLambdaRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: IAL-Pipeline-Lambda-Role\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: BedrockAccess\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - bedrock:InvokeModel\n                  - bedrock:Converse\n                Resource: '*'\n\n  # Lambda: IAS Validation\n  IASValidationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-ias-validation\n      Runtime: python3.11\n      Handler: ias_validation_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 60\n      Layers:\n        - !Ref IALPipelineLayer\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/ias_validation_handler.zip\n\n  # Lambda: Cost Estimation\n  CostEstimationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-cost-estimation\n      Runtime: python3.11\n      Handler: cost_estimation_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 60\n      Layers:\n        - !Ref IA"
    },
    {
      "source": "phases/00-foundation/17-nl-intent-pipeline.yaml",
      "text": "LPipelineLayer\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/cost_estimation_handler.zip\n\n  # Lambda: Phase Builder\n  PhaseBuilderFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-phase-builder\n      Runtime: python3.11\n      Handler: phase_builder_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 300\n      Layers:\n        - !Ref IALPipelineLayer\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/phase_builder_handler.zip\n\n  # Lambda: Git Commit & PR\n  GitCommitPRFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-git-commit-pr\n      Runtime: python3.11\n      Handler: git_commit_pr_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 120\n      Environment:\n        Variables:\n          REPO_URL: https://github.com/Diego-Nardoni/ial-infrastructure.git\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/git_commit_pr_handler.zip\n\n  # IAM Role para Step Functions\n  NLIntentPipelineRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: IAL-NL-Intent-Pipeline-Role\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: states.amazonaws.com\n            Action: sts:AssumeRole\n      Policies:\n        - PolicyName: InvokeLambdas\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - lambda:InvokeFunction\n                Resource:\n                  - !GetAtt IASValidationFunction.Arn\n                  - !GetAtt CostEstimationFunction.Arn\n                  - !GetAtt PhaseBuilderFunction.Arn\n                  - !GetAtt GitCommitPRFunction.Arn\n                  - !GetAtt WaitPRApprovalFunction.Arn\n                  - !GetAtt DeployClou"
    },
    {
      "source": "phases/00-foundation/17-nl-intent-pipeline.yaml",
      "text": "dFormationFunction.Arn\n                  - !GetAtt ProofOfCreationFunction.Arn\n                  - !GetAtt PostDeployAnalysisFunction.Arn\n                  - !GetAtt DriftDetectionFunction.Arn\n\n  # Lambda: Wait PR Approval\n  WaitPRApprovalFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-wait-pr-approval\n      Runtime: python3.11\n      Handler: wait_pr_approval_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 30\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/wait_pr_approval_handler.zip\n\n  # Lambda: Deploy CloudFormation\n  DeployCloudFormationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-deploy-cfn\n      Runtime: python3.11\n      Handler: deploy_cloudformation_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 300\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/deploy_cloudformation_handler.zip\n\n  # Lambda: Proof of Creation\n  ProofOfCreationFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-proof-of-creation\n      Runtime: python3.11\n      Handler: proof_of_creation_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 60\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/proof_of_creation_handler.zip\n\n  # Lambda: Post-Deploy Analysis\n  PostDeployAnalysisFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-post-deploy-analysis\n      Runtime: python3.11\n      Handler: post_deploy_analysis_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 120\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/post_deploy_analysis_handler.zip\n\n  # Lambda: Drift Detection\n  DriftDetectionFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-nl-drift-d"
    },
    {
      "source": "phases/00-foundation/17-nl-intent-pipeline.yaml",
      "text": "etection\n      Runtime: python3.11\n      Handler: drift_detection_handler.handler\n      Role: !GetAtt IALPipelineLambdaRole.Arn\n      Timeout: 120\n      Code:\n        S3Bucket: !Sub 'ial-artifacts-${AWS::AccountId}'\n        S3Key: lambdas/drift_detection_handler.zip\n\n  # Step Functions State Machine - FLUXO COMPLETO\n  NLIntentPipelineStateMachine:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: ial-nl-intent-pipeline\n      RoleArn: !GetAtt NLIntentPipelineRole.Arn\n      DefinitionString: !Sub |\n        {\n          \"Comment\": \"IAL NL Intent Pipeline - Complete Flow\",\n          \"StartAt\": \"IASValidation\",\n          \"States\": {\n            \"IASValidation\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${IASValidationFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.ias_result\",\n              \"Next\": \"CheckIASSafe\"\n            },\n            \"CheckIASSafe\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [{\"Variable\": \"$.ias_result.Payload.body.safe\", \"BooleanEquals\": true, \"Next\": \"CostEstimation\"}],\n              \"Default\": \"SecurityRiskDetected\"\n            },\n            \"SecurityRiskDetected\": {\"Type\": \"Fail\", \"Error\": \"SecurityRisk\"},\n            \"CostEstimation\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${CostEstimationFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.cost_result\",\n              \"Next\": \"CheckBudget\"\n            },\n            \"CheckBudget\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [{\"Variable\": \"$.cost_result.Payload.body.within_budget\", \"BooleanEquals\": true, \"Next\": \"PhaseBuilder\"}],\n              \"Default\": \"BudgetExceeded\"\n            },\n            \"BudgetExceeded\": {\"Type\": \"Fail\", \"Error\": \"BudgetExceeded\"},\n            \"PhaseBuilder\": {\n              \"Type\": \"Task\","
    },
    {
      "source": "phases/00-foundation/17-nl-intent-pipeline.yaml",
      "text": "\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${PhaseBuilderFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.phase_result\",\n              \"Next\": \"GitCommitPR\"\n            },\n            \"GitCommitPR\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${GitCommitPRFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.git_result\",\n              \"Next\": \"WaitForPRApproval\"\n            },\n            \"WaitForPRApproval\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${WaitPRApprovalFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.approval_result\",\n              \"Next\": \"DeployCloudFormation\"\n            },\n            \"DeployCloudFormation\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${DeployCloudFormationFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.deployment_result\",\n              \"Next\": \"ProofOfCreation\"\n            },\n            \"ProofOfCreation\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${ProofOfCreationFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.proof_result\",\n              \"Next\": \"PostDeployAnalysis\"\n            },\n            \"PostDeployAnalysis\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\"FunctionName\": \"${PostDeployAnalysisFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.analysis_result\",\n              \"Next\": \"DriftDetection\"\n            },\n            \"DriftDetection\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n            "
    },
    {
      "source": "phases/00-foundation/17-nl-intent-pipeline.yaml",
      "text": "  \"Parameters\": {\"FunctionName\": \"${DriftDetectionFunction}\", \"Payload.$\": \"$\"},\n              \"ResultPath\": \"$.drift_result\",\n              \"Next\": \"CheckDrift\"\n            },\n            \"CheckDrift\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [\n                {\"Variable\": \"$.drift_result.Payload.body.drift_detected\", \"BooleanEquals\": false, \"Next\": \"Success\"},\n                {\"Variable\": \"$.drift_result.Payload.body.drift_type\", \"StringEquals\": \"safe\", \"Next\": \"Success\"}\n              ],\n              \"Default\": \"DriftAlert\"\n            },\n            \"DriftAlert\": {\n              \"Type\": \"Pass\",\n              \"Result\": \"Risky drift detected - manual review required\",\n              \"Next\": \"Success\"\n            },\n            \"Success\": {\"Type\": \"Succeed\"}\n          }\n        }\n\nOutputs:\n  StateMachineArn:\n    Value: !GetAtt NLIntentPipelineStateMachine.Arn\n    Export:\n      Name: IAL-NL-Intent-Pipeline-Arn\n  \n  IASValidationFunctionArn:\n    Value: !GetAtt IASValidationFunction.Arn\n  \n  CostEstimationFunctionArn:\n    Value: !GetAtt CostEstimationFunction.Arn\n  \n  PhaseBuilderFunctionArn:\n    Value: !GetAtt PhaseBuilderFunction.Arn\n"
    },
    {
      "source": "phases/00-foundation/18-ial-feature-flags.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 18 IAL feature flags'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 18-ial-feature-flags\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-18-ial-feature-flags-Output'\n"
    },
    {
      "source": "phases/00-foundation/19-ial-enterprise-observability.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 19 IAL enterprise observability'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 19-ial-enterprise-observability\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-19-ial-enterprise-observability-Output'\n"
    },
    {
      "source": "phases/00-foundation/20-ial-github-oidc-provider.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - GitHub OIDC Provider'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # OIDC Identity Provider for GitHub Actions\n  GitHubOIDCProvider:\n    Type: AWS::IAM::OIDCProvider\n    Properties:\n      Url: https://token.actions.githubusercontent.com\n      ClientIdList:\n        - sts.amazonaws.com\n      ThumbprintList:\n        - 6938fd4d98bab03faadb97b34396831e3780aea1\n        - 1c58a3a8518e8759bf075b76b750d4f2df264fcd\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: GitHubActions\n\n  # GitHub Actions Role\n  GitHubActionsRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-github-actions-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Federated: !Ref GitHubOIDCProvider\n            Action: sts:AssumeRoleWithWebIdentity\n            Condition:\n              StringEquals:\n                'token.actions.githubusercontent.com:aud': sts.amazonaws.com\n              StringLike:\n                'token.actions.githubusercontent.com:sub': 'repo:Diego-Nardoni/ial-infrastructure:*'\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/PowerUserAccess\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: GitHubActions\n\nOutputs:\n  GitHubOIDCProviderArn:\n    Description: ARN of the GitHub OIDC Provider\n    Value: !Ref GitHubOIDCProvider\n    Export:\n      Name: !Sub '${ProjectName}-GitHubOIDCProviderArn'\n  \n  GitHubActionsRoleArn:\n    Description: ARN of the GitHub Actions Role\n    Value: !GetAtt GitHubActionsRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-GitHubActionsRoleArn'\n"
    },
    {
      "source": "phases/00-foundation/21-ial-stepfunctions-migration.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Step Functions Migration Infrastructure'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: 'ial'\n  Environment:\n    Type: String\n    Default: 'prod'\n\nResources:\n  # IAM Role for Step Functions Execution\n  StepFunctionsExecutionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-stepfunctions-execution-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: states.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaRole\n      Policies:\n        - PolicyName: StepFunctionsExecutionPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - lambda:InvokeFunction\n                  - logs:CreateLogGroup\n                  - logs:CreateLogStream\n                  - logs:PutLogEvents\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:Query\n                  - dynamodb:Scan\n                  - sns:Publish\n                Resource: '*'\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: stepfunctions-execution\n        - Key: Environment\n          Value: !Ref Environment\n\n  # Healing Orchestrator State Machine\n  HealingOrchestratorStateMachine:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: !Sub '${ProjectName}-healing-orchestrator'\n      RoleArn: !GetAtt StepFunctionsExecutionRole.Arn\n      StateMachineType: STANDARD\n      DefinitionString: !Sub |\n        {\n          \"Comment\": \"IAL Healing Orchestrator - Step Functions Implementation\",\n          \"StartAt\": \"InitializeHealing\",\n          \"States\": {\n            \"InitializeHealing\": {\n             "
    },
    {
      "source": "phases/00-foundation/21-ial-stepfunctions-migration.yaml",
      "text": " \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${ProjectName}-healing-initializer\",\n                \"Payload\": {\n                  \"failed_resources.$\": \"$.failed_resources\",\n                  \"region.$\": \"$.region\",\n                  \"correlation_id.$\": \"$.correlation_id\"\n                }\n              },\n              \"ResultPath\": \"$.healing_plan\",\n              \"Next\": \"CheckHealingPlan\",\n              \"Retry\": [\n                {\n                  \"ErrorEquals\": [\"States.TaskFailed\"],\n                  \"IntervalSeconds\": 2,\n                  \"MaxAttempts\": 3,\n                  \"BackoffRate\": 2.0\n                }\n              ]\n            },\n            \"CheckHealingPlan\": {\n              \"Type\": \"Choice\",\n              \"Choices\": [\n                {\n                  \"Variable\": \"$.healing_plan.Payload.has_resources\",\n                  \"BooleanEquals\": false,\n                  \"Next\": \"NoHealingNeeded\"\n                }\n              ],\n              \"Default\": \"ProcessHealingBatches\"\n            },\n            \"NoHealingNeeded\": {\n              \"Type\": \"Pass\",\n              \"Result\": {\n                \"status\": \"success\",\n                \"message\": \"No healing required\"\n              },\n              \"End\": true\n            },\n            \"ProcessHealingBatches\": {\n              \"Type\": \"Map\",\n              \"ItemsPath\": \"$.healing_plan.Payload.healing_batches\",\n              \"MaxConcurrency\": 3,\n              \"Iterator\": {\n                \"StartAt\": \"HealResourceBatch\",\n                \"States\": {\n                  \"HealResourceBatch\": {\n                    \"Type\": \"Task\",\n                    \"Resource\": \"arn:aws:states:::lambda:invoke\",\n                    \"Parameters\": {\n                      \"FunctionName\": \"${ProjectName}-resource-healer\",\n                      \"Payload\": {\n                        \"batch.$\": \"$\",\n                        \"correlation_id.$\": \"$.c"
    },
    {
      "source": "phases/00-foundation/21-ial-stepfunctions-migration.yaml",
      "text": "orrelation_id\"\n                      }\n                    },\n                    \"End\": true\n                  }\n                }\n              },\n              \"End\": true\n            }\n          }\n        }\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: healing-orchestration\n        - Key: Environment\n          Value: !Ref Environment\n\n  # Phase Manager State Machine\n  PhaseManagerStateMachine:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: !Sub '${ProjectName}-phase-manager'\n      RoleArn: !GetAtt StepFunctionsExecutionRole.Arn\n      StateMachineType: STANDARD\n      DefinitionString: !Sub |\n        {\n          \"Comment\": \"IAL Phase Manager - Step Functions Implementation\",\n          \"StartAt\": \"DiscoverPhases\",\n          \"States\": {\n            \"DiscoverPhases\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${ProjectName}-phase-discoverer\",\n                \"Payload\": {\n                  \"correlation_id.$\": \"$.correlation_id\"\n                }\n              },\n              \"ResultPath\": \"$.phases\",\n              \"Next\": \"ExecutePhases\"\n            },\n            \"ExecutePhases\": {\n              \"Type\": \"Map\",\n              \"ItemsPath\": \"$.phases.Payload.execution_order\",\n              \"MaxConcurrency\": 1,\n              \"Iterator\": {\n                \"StartAt\": \"ExecutePhase\",\n                \"States\": {\n                  \"ExecutePhase\": {\n                    \"Type\": \"Task\",\n                    \"Resource\": \"arn:aws:states:::lambda:invoke\",\n                    \"Parameters\": {\n                      \"FunctionName\": \"${ProjectName}-phase-executor\",\n                      \"Payload\": {\n                        \"phase.$\": \"$\",\n                        \"correlation_id.$\": \"$.correlation_id\"\n                      }\n                    },\n                    \"End\": true\n  "
    },
    {
      "source": "phases/00-foundation/21-ial-stepfunctions-migration.yaml",
      "text": "                }\n                }\n              },\n              \"End\": true\n            }\n          }\n        }\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: phase-management\n        - Key: Environment\n          Value: !Ref Environment\n\n  # Audit Validator State Machine\n  AuditValidatorStateMachine:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: !Sub '${ProjectName}-audit-validator'\n      RoleArn: !GetAtt StepFunctionsExecutionRole.Arn\n      StateMachineType: STANDARD\n      DefinitionString: !Sub |\n        {\n          \"Comment\": \"IAL Audit Validator - Step Functions Implementation\",\n          \"StartAt\": \"InitializeAudit\",\n          \"States\": {\n            \"InitializeAudit\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${ProjectName}-audit-initializer\",\n                \"Payload\": {\n                  \"desired_spec_path.$\": \"$.desired_spec_path\",\n                  \"correlation_id.$\": \"$.correlation_id\"\n                }\n              },\n              \"ResultPath\": \"$.audit_config\",\n              \"Next\": \"ParallelValidation\"\n            },\n            \"ParallelValidation\": {\n              \"Type\": \"Parallel\",\n              \"Branches\": [\n                {\n                  \"StartAt\": \"ValidateCloudFormation\",\n                  \"States\": {\n                    \"ValidateCloudFormation\": {\n                      \"Type\": \"Task\",\n                      \"Resource\": \"arn:aws:states:::lambda:invoke\",\n                      \"Parameters\": {\n                        \"FunctionName\": \"${ProjectName}-cf-validator\",\n                        \"Payload\": {\n                          \"audit_config.$\": \"$.audit_config.Payload\"\n                        }\n                      },\n                      \"End\": true\n                    }\n                  }\n                },\n                {\n  "
    },
    {
      "source": "phases/00-foundation/21-ial-stepfunctions-migration.yaml",
      "text": "                \"StartAt\": \"ValidateAWSReal\",\n                  \"States\": {\n                    \"ValidateAWSReal\": {\n                      \"Type\": \"Task\",\n                      \"Resource\": \"arn:aws:states:::lambda:invoke\",\n                      \"Parameters\": {\n                        \"FunctionName\": \"${ProjectName}-aws-validator\",\n                        \"Payload\": {\n                          \"audit_config.$\": \"$.audit_config.Payload\"\n                        }\n                      },\n                      \"End\": true\n                    }\n                  }\n                }\n              ],\n              \"ResultPath\": \"$.validation_results\",\n              \"Next\": \"AggregateResults\"\n            },\n            \"AggregateResults\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"arn:aws:states:::lambda:invoke\",\n              \"Parameters\": {\n                \"FunctionName\": \"${ProjectName}-audit-aggregator\",\n                \"Payload\": {\n                  \"validation_results.$\": \"$.validation_results\"\n                }\n              },\n              \"End\": true\n            }\n          }\n        }\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: audit-validation\n        - Key: Environment\n          Value: !Ref Environment\n\n  # SNS Topic for Step Functions Notifications\n  StepFunctionsNotificationTopic:\n    Type: AWS::SNS::Topic\n    Properties:\n      TopicName: !Sub '${ProjectName}-stepfunctions-notifications'\n      DisplayName: 'IAL Step Functions Notifications'\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: stepfunctions-notifications\n        - Key: Environment\n          Value: !Ref Environment\n\nOutputs:\n  StepFunctionsExecutionRoleArn:\n    Description: 'ARN of the Step Functions execution role'\n    Value: !GetAtt StepFunctionsExecutionRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-stepfunctions-execution-role-arn'\n\n  HealingOrchest"
    },
    {
      "source": "phases/00-foundation/21-ial-stepfunctions-migration.yaml",
      "text": "ratorStateMachineArn:\n    Description: 'ARN of the Healing Orchestrator State Machine'\n    Value: !Ref HealingOrchestratorStateMachine\n    Export:\n      Name: !Sub '${ProjectName}-healing-orchestrator-arn'\n\n  PhaseManagerStateMachineArn:\n    Description: 'ARN of the Phase Manager State Machine'\n    Value: !Ref PhaseManagerStateMachine\n    Export:\n      Name: !Sub '${ProjectName}-phase-manager-arn'\n\n  AuditValidatorStateMachineArn:\n    Description: 'ARN of the Audit Validator State Machine'\n    Value: !Ref AuditValidatorStateMachine\n    Export:\n      Name: !Sub '${ProjectName}-audit-validator-arn'\n\n  NotificationTopicArn:\n    Description: 'ARN of the SNS notification topic'\n    Value: !Ref StepFunctionsNotificationTopic\n    Export:\n      Name: !Sub '${ProjectName}-stepfunctions-notifications-arn'\n"
    },
    {
      "source": "phases/00-foundation/22-ial-stepfunctions-lambdas.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Step Functions Lambda Functions'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: 'ial'\n  Environment:\n    Type: String\n    Default: 'prod'\n\nResources:\n  # Lambda Execution Role\n  LambdaExecutionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-stepfunctions-lambda-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: StepFunctionsLambdaPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:Query\n                  - dynamodb:Scan\n                  - cloudformation:*\n                  - sns:Publish\n                  - bedrock-runtime:InvokeModel\n                Resource: '*'\n\n  # Healing Orchestrator Lambda Functions\n  HealingInitializerFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-healing-initializer'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 300\n      MemorySize: 512\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"has_resources\": False, \"healing_batches\": [], \"total_resources\": 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: healing-initialization\n\n  ResourceHealerFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-resource-healer'\n      Runtime: python3.11\n      Handler: index.lambd"
    },
    {
      "source": "phases/00-foundation/22-ial-stepfunctions-lambdas.yaml",
      "text": "a_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 600\n      MemorySize: 1024\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"batch_results\": []}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: resource-healing\n\n  HealingAggregatorFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-healing-aggregator'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 180\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"status\": \"completed\", \"total_resources\": 0, \"successful_healings\": 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: healing-aggregation\n\n  # Phase Manager Lambda Functions\n  PhaseDiscovererFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-phase-discoverer'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 120\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"discovered_phases\": {}, \"execution_order\": []}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: phase-discovery\n\n  DependencyInferrerFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-dependency-inferrer'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 300\n      MemorySize: 512\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"inferred_dependencies\": {}}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName"
    },
    {
      "source": "phases/00-foundation/22-ial-stepfunctions-lambdas.yaml",
      "text": "\n        - Key: Purpose\n          Value: dependency-inference\n\n  ExecutionPlannerFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-execution-planner'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 180\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"execution_order\": [], \"total_phases\": 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: execution-planning\n\n  PhaseExecutorFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-phase-executor'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 900\n      MemorySize: 1024\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"success\": True, \"message\": \"Phase executed\", \"phase_name\": \"test\"}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: phase-execution\n\n  # Audit Validator Lambda Functions\n  AuditInitializerFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-audit-initializer'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 120\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"desired_spec\": {}, \"resource_count\": 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: audit-initialization\n\n  CloudFormationValidatorFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-cf-validator'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt La"
    },
    {
      "source": "phases/00-foundation/22-ial-stepfunctions-lambdas.yaml",
      "text": "mbdaExecutionRole.Arn\n      Timeout: 300\n      MemorySize: 512\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"validation_type\": \"cloudformation\", \"resources_found\": 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: cf-validation\n\n  AWSValidatorFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-aws-validator'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 300\n      MemorySize: 512\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"validation_type\": \"aws_real\", \"resources_found\": 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: aws-validation\n\n  GraphValidatorFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-graph-validator'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 300\n      MemorySize: 512\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"validation_type\": \"knowledge_graph\", \"resources_found\": 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: graph-validation\n\n  AuditAggregatorFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-audit-aggregator'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 180\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"completeness_percentage\": 100, \"status\": \"completed\"}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          V"
    },
    {
      "source": "phases/00-foundation/22-ial-stepfunctions-lambdas.yaml",
      "text": "alue: audit-aggregation\n\n  ComplianceEnforcerFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-compliance-enforcer'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 120\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"enforcement_action\": \"notification_sent\", \"status\": \"enforced\"}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: compliance-enforcement\n\nOutputs:\n  LambdaExecutionRoleArn:\n    Description: 'ARN of the Lambda execution role'\n    Value: !GetAtt LambdaExecutionRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-stepfunctions-lambda-role-arn'\n\n  HealingInitializerFunctionArn:\n    Description: 'ARN of the Healing Initializer function'\n    Value: !GetAtt HealingInitializerFunction.Arn\n    Export:\n      Name: !Sub '${ProjectName}-healing-initializer-arn'\n\n  PhaseDiscovererFunctionArn:\n    Description: 'ARN of the Phase Discoverer function'\n    Value: !GetAtt PhaseDiscovererFunction.Arn\n    Export:\n      Name: !Sub '${ProjectName}-phase-discoverer-arn'\n\n  AuditInitializerFunctionArn:\n    Description: 'ARN of the Audit Initializer function'\n    Value: !GetAtt AuditInitializerFunction.Arn\n    Export:\n      Name: !Sub '${ProjectName}-audit-initializer-arn'\n"
    },
    {
      "source": "phases/00-foundation/23-ial-core-observability.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 23 IAL core observability'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 23-ial-core-observability\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-23-ial-core-observability-Output'\n"
    },
    {
      "source": "phases/00-foundation/24-ial-sns-topics.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - 24 IAL sns topics'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # Placeholder resource - will be implemented based on original requirements\n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for 24-ial-sns-topics\n    Value: !Ref PlaceholderResource\n    Export:\n      Name: !Sub '${ProjectName}-24-ial-sns-topics-Output'\n"
    },
    {
      "source": "phases/00-foundation/25-ial-resource-catalog-table.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Resource Catalog Table'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  ResourceCatalogTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: ial-resource-catalog\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: resource_type\n          AttributeType: S\n        - AttributeName: resource_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: resource_type\n          KeyType: HASH\n        - AttributeName: resource_id\n          KeyType: RANGE\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\nOutputs:\n  ResourceCatalogTableName:\n    Description: Resource catalog table name\n    Value: !Ref ResourceCatalogTable\n    Export:\n      Name: !Sub '${ProjectName}-ResourceCatalogTable'\n"
    },
    {
      "source": "phases/00-foundation/26-ial-rollback-checkpoints-table.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Rollback Checkpoints Table'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  RollbackCheckpointsTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: ial-rollback-checkpoints\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: deployment_id\n          AttributeType: S\n        - AttributeName: checkpoint_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: deployment_id\n          KeyType: HASH\n        - AttributeName: checkpoint_id\n          KeyType: RANGE\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\nOutputs:\n  RollbackCheckpointsTableName:\n    Description: Rollback checkpoints table name\n    Value: !Ref RollbackCheckpointsTable\n    Export:\n      Name: !Sub '${ProjectName}-RollbackCheckpointsTable'\n"
    },
    {
      "source": "phases/00-foundation/27-ial-token-usage-table.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Token Usage Table'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  TokenUsageTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-token-usage'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: date\n          AttributeType: S\n      KeySchema:\n        - AttributeName: user_id\n          KeyType: HASH\n        - AttributeName: date\n          KeyType: RANGE\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\nOutputs:\n  TokenUsageTableName:\n    Description: Token usage table name\n    Value: !Ref TokenUsageTable\n    Export:\n      Name: !Sub '${ProjectName}-TokenUsageTable'\n"
    },
    {
      "source": "phases/00-foundation/28-ial-knowledge-base-table.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Knowledge Base Table'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  KnowledgeBaseTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: ial-knowledge-base\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: topic\n          AttributeType: S\n        - AttributeName: document_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: topic\n          KeyType: HASH\n        - AttributeName: document_id\n          KeyType: RANGE\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\nOutputs:\n  KnowledgeBaseTableName:\n    Description: Knowledge base table name\n    Value: !Ref KnowledgeBaseTable\n    Export:\n      Name: !Sub '${ProjectName}-KnowledgeBaseTable'\n"
    },
    {
      "source": "phases/00-foundation/29-mcp-provisioning-checklist-table.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - MCP Provisioning Checklist Table'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  MCPProvisioningChecklistTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: mcp-provisioning-checklist\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: mcp_server\n          AttributeType: S\n        - AttributeName: check_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: mcp_server\n          KeyType: HASH\n        - AttributeName: check_id\n          KeyType: RANGE\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\nOutputs:\n  MCPProvisioningChecklistTableName:\n    Description: MCP provisioning checklist table name\n    Value: !Ref MCPProvisioningChecklistTable\n    Export:\n      Name: !Sub '${ProjectName}-MCPProvisioningChecklistTable'\n"
    },
    {
      "source": "phases/00-foundation/30-ial-pipeline-lambdas.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Pipeline Lambda Functions'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  PipelineLambdaRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-pipeline-lambda-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: PipelineLambdaPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - dynamodb:*\n                  - cloudformation:*\n                  - s3:*\n                  - bedrock-runtime:InvokeModel\n                Resource: '*'\n\n  CircuitGuardLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-circuit-guard-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt PipelineLambdaRole.Arn\n      Timeout: 60\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"circuit\": \"CLOSED\", \"status\": \"healthy\"}\n\n  PlanLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-plan-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt PipelineLambdaRole.Arn\n      Timeout: 300\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"plan\": {\"resources\": []}, \"status\": \"success\"}\n\n  ApplyLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-apply-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt PipelineLambdaRole.Arn\n      Timeout: 900\n      "
    },
    {
      "source": "phases/00-foundation/30-ial-pipeline-lambdas.yaml",
      "text": "Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"apply\": {\"deployed\": []}, \"status\": \"success\"}\n\n  AuditValidatorLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-audit-validator-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt PipelineLambdaRole.Arn\n      Timeout: 300\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"audit\": {\"completeness\": 100}, \"status\": \"passed\"}\n\nOutputs:\n  PipelineLambdaRoleArn:\n    Description: Pipeline Lambda role ARN\n    Value: !GetAtt PipelineLambdaRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-PipelineLambdaRole'\n"
    },
    {
      "source": "phases/00-foundation/31-ial-rollback-lambdas.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Rollback Lambda Functions'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  RollbackLambdaRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-rollback-lambda-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: RollbackLambdaPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - dynamodb:*\n                  - cloudformation:*\n                  - s3:*\n                Resource: '*'\n\n  RollbackLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-rollback-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt RollbackLambdaRole.Arn\n      Timeout: 900\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"rollback\": {\"reverted\": []}, \"status\": \"success\"}\n\n  ReverseSyncLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-reverse-sync-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt RollbackLambdaRole.Arn\n      Timeout: 600\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"sync\": {\"pr_url\": \"https://github.com/example/pr/123\"}, \"status\": \"success\"}\n\n  DriftDetectLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-drift-detect-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt RollbackLambdaRole.Arn\n      Timeout:"
    },
    {
      "source": "phases/00-foundation/31-ial-rollback-lambdas.yaml",
      "text": " 300\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"drift\": {\"detected\": False, \"safe\": True}, \"status\": \"success\"}\n\n  DriftReconcileLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: ial-drift-reconcile-lambda\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt RollbackLambdaRole.Arn\n      Timeout: 600\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\"reconcile\": {\"fixed\": []}, \"status\": \"success\"}\n\nOutputs:\n  RollbackLambdaRoleArn:\n    Description: Rollback Lambda role ARN\n    Value: !GetAtt RollbackLambdaRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-RollbackLambdaRole'\n"
    },
    {
      "source": "phases/00-foundation/32-ial-eventbridge-rules.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - EventBridge Rules'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  EventBridgeRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-eventbridge-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: events.amazonaws.com\n            Action: sts:AssumeRole\n      Policies:\n        - PolicyName: EventBridgePolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - states:StartExecution\n                  - lambda:InvokeFunction\n                Resource: '*'\n\n  ScheduledDriftCheckRule:\n    Type: AWS::Events::Rule\n    Properties:\n      Name: ial-scheduled-drift-check\n      Description: Scheduled drift detection check\n      ScheduleExpression: 'rate(1 hour)'\n      State: ENABLED\n      Targets:\n        - Arn: !Sub 'arn:aws:states:${AWS::Region}:${AWS::AccountId}:stateMachine:ial-drift-autoheal'\n          Id: DriftCheckTarget\n          RoleArn: !GetAtt EventBridgeRole.Arn\n\n  CostMonitoringRule:\n    Type: AWS::Events::Rule\n    Properties:\n      Name: ial-cost-monitoring\n      Description: Cost monitoring and alerting\n      ScheduleExpression: 'rate(6 hours)'\n      State: ENABLED\n      Targets:\n        - Arn: !Sub 'arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:ial-cost-monitor'\n          Id: CostMonitorTarget\n\n  HealthCheckRule:\n    Type: AWS::Events::Rule\n    Properties:\n      Name: ial-health-check\n      Description: System health check\n      ScheduleExpression: 'rate(30 minutes)'\n      State: ENABLED\n      Targets:\n        - Arn: !Sub 'arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:ial-health-monitor'\n          Id: HealthCheckTarget\n\nOutputs:\n  EventBridgeRoleArn:\n    Descri"
    },
    {
      "source": "phases/00-foundation/32-ial-eventbridge-rules.yaml",
      "text": "ption: EventBridge role ARN\n    Value: !GetAtt EventBridgeRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-EventBridgeRole'\n"
    },
    {
      "source": "phases/00-foundation/33-ial-cloudwatch-log-groups.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - CloudWatch Log Groups'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  StepFunctionsLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: /aws/stepfunctions/ial-state-machines\n      RetentionInDays: 30\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\n  LambdaLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: /aws/lambda/ial-functions\n      RetentionInDays: 30\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\n  IALMainLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: IaLLogGroup\n      RetentionInDays: 90\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\n  IALRollbackLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: IaLRollbackLogGroup\n      RetentionInDays: 90\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\n  ContainerInsightsLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: ContainerInsightsLogGroup\n      RetentionInDays: 14\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\nOutputs:\n  StepFunctionsLogGroupName:\n    Description: Step Functions log group name\n    Value: !Ref StepFunctionsLogGroup\n    Export:\n      Name: !Sub '${ProjectName}-StepFunctionsLogGroup'\n\n  LambdaLogGroupName:\n    Description: Lambda log group name\n    Value: !Ref LambdaLogGroup\n    Export:\n      Name: !Sub '${ProjectName}-LambdaLogGroup'\n"
    },
    {
      "source": "phases/00-foundation/34-ial-cloudwatch-dashboard.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - CloudWatch Dashboard'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  IALSystemDashboard:\n    Type: AWS::CloudWatch::Dashboard\n    Properties:\n      DashboardName: ial-system-dashboard\n      DashboardBody: !Sub |\n        {\n          \"widgets\": [\n            {\n              \"type\": \"metric\",\n              \"x\": 0,\n              \"y\": 0,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"AWS/States\", \"ExecutionsSucceeded\", \"StateMachineArn\", \"arn:aws:states:${AWS::Region}:${AWS::AccountId}:stateMachine:ial-phase-pipeline\"],\n                  [\".\", \"ExecutionsFailed\", \".\", \".\"],\n                  [\".\", \"ExecutionsSucceeded\", \".\", \"arn:aws:states:${AWS::Region}:${AWS::AccountId}:stateMachine:ial-drift-autoheal\"],\n                  [\".\", \"ExecutionsFailed\", \".\", \".\"]\n                ],\n                \"period\": 300,\n                \"stat\": \"Sum\",\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"Step Functions Executions\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 12,\n              \"y\": 0,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"AWS/Lambda\", \"Duration\", \"FunctionName\", \"ial-plan-lambda\"],\n                  [\".\", \"Errors\", \".\", \".\"],\n                  [\".\", \"Duration\", \".\", \"ial-apply-lambda\"],\n                  [\".\", \"Errors\", \".\", \".\"]\n                ],\n                \"period\": 300,\n                \"stat\": \"Average\",\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"Lambda Performance\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 0,\n              \"y\": 6,\n              \"width\": 24,\n              \"height\": 6,\n    "
    },
    {
      "source": "phases/00-foundation/34-ial-cloudwatch-dashboard.yaml",
      "text": "          \"properties\": {\n                \"metrics\": [\n                  [\"AWS/DynamoDB\", \"ConsumedReadCapacityUnits\", \"TableName\", \"ial-conversation-history\"],\n                  [\".\", \"ConsumedWriteCapacityUnits\", \".\", \".\"],\n                  [\".\", \"ConsumedReadCapacityUnits\", \".\", \"ial-resource-catalog\"],\n                  [\".\", \"ConsumedWriteCapacityUnits\", \".\", \".\"]\n                ],\n                \"period\": 300,\n                \"stat\": \"Sum\",\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"DynamoDB Usage\"\n              }\n            }\n          ]\n        }\n\nOutputs:\n  DashboardURL:\n    Description: CloudWatch Dashboard URL\n    Value: !Sub 'https://${AWS::Region}.console.aws.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=${IALSystemDashboard}'\n    Export:\n      Name: !Sub '${ProjectName}-DashboardURL'\n"
    },
    {
      "source": "phases/00-foundation/35-ial-state-table.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - System State Table'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial\n    Description: Project name for resource naming\n\nResources:\n  SystemStateTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: ial-state\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: system_id\n          AttributeType: S\n        - AttributeName: component\n          AttributeType: S\n      KeySchema:\n        - AttributeName: system_id\n          KeyType: HASH\n        - AttributeName: component\n          KeyType: RANGE\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n\nOutputs:\n  SystemStateTableName:\n    Description: System state table name\n    Value: !Ref SystemStateTable\n    Export:\n      Name: !Sub '${ProjectName}-SystemStateTable'\n"
    },
    {
      "source": "phases/00-foundation/36-logging-infrastructure.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Logging Infrastructure'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # CloudWatch Log Group for IAL operations\n  IALLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '${ProjectName}-infrastructure'\n      RetentionInDays: 30\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: Logging\n\n  # Lambda functions log group\n  LambdaLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '/aws/lambda/${ProjectName}'\n      RetentionInDays: 14\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: LambdaLogs\n\n  # Step Functions log group\n  StepFunctionsLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '/aws/stepfunctions/${ProjectName}'\n      RetentionInDays: 14\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: StepFunctionsLogs\n\nOutputs:\n  IALLogGroupName:\n    Description: Name of the IAL log group\n    Value: !Ref IALLogGroup\n    Export:\n      Name: !Sub '${ProjectName}-36-IALLogGroupName'\n  \n  IALLogGroupArn:\n    Description: ARN of the IAL log group\n    Value: !GetAtt IALLogGroup.Arn\n    Export:\n      Name: !Sub '${ProjectName}-36-IALLogGroupArn'\n"
    },
    {
      "source": "phases/00-foundation/37-backup-strategy.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Backup Strategy'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # S3 Bucket for configuration backups\n  ConfigurationBackupBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${ProjectName}-config-backups-${AWS::AccountId}'\n      VersioningConfiguration:\n        Status: Enabled\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      LifecycleConfiguration:\n        Rules:\n          - Id: DeleteOldVersions\n            Status: Enabled\n            NoncurrentVersionExpirationInDays: 30\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: ConfigBackups\n\n  # IAM Role for backup operations\n  BackupRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-backup-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: BackupPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - s3:GetObject\n                  - s3:PutObject\n                  - s3:DeleteObject\n                  - s3:ListBucket\n                Resource: \n                  - !Sub '${ConfigurationBackupBucket.Arn}/*'\n                  - !GetAtt Confi"
    },
    {
      "source": "phases/00-foundation/37-backup-strategy.yaml",
      "text": "gurationBackupBucket.Arn\n              - Effect: Allow\n                Action:\n                  - dynamodb:CreateBackup\n                  - dynamodb:DescribeBackup\n                  - dynamodb:ListBackups\n                  - dynamodb:RestoreTableFromBackup\n                Resource: !Sub 'arn:aws:dynamodb:*:*:table/${ProjectName}-*'\n\n  # Lambda function for automated backups\n  BackupFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-backup-manager'\n      Runtime: python3.12\n      Handler: index.lambda_handler\n      Role: !GetAtt BackupRole.Arn\n      Timeout: 300\n      MemorySize: 256\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          import logging\n          from datetime import datetime\n          \n          logger = logging.getLogger()\n          logger.setLevel(logging.INFO)\n          \n          def lambda_handler(event, context):\n              \"\"\"\n              IAL Backup Manager - Automated backup operations\n              \"\"\"\n              logger.info(f\"Backup event: {event}\")\n              \n              try:\n                  backup_type = event.get('backup_type', 'configuration')\n                  \n                  if backup_type == 'configuration':\n                      result = backup_configuration()\n                  elif backup_type == 'dynamodb':\n                      result = backup_dynamodb_tables()\n                  else:\n                      result = {'error': f'Unknown backup type: {backup_type}'}\n                  \n                  return {\n                      'statusCode': 200,\n                      'body': json.dumps({\n                          'message': 'Backup completed',\n                          'backup_type': backup_type,\n                          'result': result,\n                          'timestamp': datetime.utcnow().isoformat()\n                      })\n                  }\n                  \n              except Exception as e:\n                  logge"
    },
    {
      "source": "phases/00-foundation/37-backup-strategy.yaml",
      "text": "r.error(f\"Backup error: {str(e)}\")\n                  return {\n                      'statusCode': 500,\n                      'body': json.dumps({\n                          'error': str(e),\n                          'backup_type': backup_type\n                      })\n                  }\n          \n          def backup_configuration():\n              \"\"\"Backup configuration files to S3\"\"\"\n              return {'status': 'completed', 'files_backed_up': 0}\n          \n          def backup_dynamodb_tables():\n              \"\"\"Create DynamoDB table backups\"\"\"\n              return {'status': 'completed', 'tables_backed_up': 0}\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: BackupManager\n\n  # EventBridge rule for scheduled backups\n  BackupScheduleRule:\n    Type: AWS::Events::Rule\n    Properties:\n      Name: !Sub '${ProjectName}-backup-schedule'\n      Description: 'Daily backup schedule for IAL infrastructure'\n      ScheduleExpression: 'cron(0 2 * * ? *)'  # Daily at 2 AM UTC\n      State: ENABLED\n      Targets:\n        - Arn: !GetAtt BackupFunction.Arn\n          Id: BackupTarget\n          Input: '{\"backup_type\": \"configuration\"}'\n\n  # Permission for EventBridge to invoke Lambda\n  BackupLambdaPermission:\n    Type: AWS::Lambda::Permission\n    Properties:\n      FunctionName: !Ref BackupFunction\n      Action: lambda:InvokeFunction\n      Principal: events.amazonaws.com\n      SourceArn: !GetAtt BackupScheduleRule.Arn\n\nOutputs:\n  BackupBucketName:\n    Description: Name of the backup bucket\n    Value: !Ref ConfigurationBackupBucket\n    Export:\n      Name: !Sub '${ProjectName}-BackupBucketName'\n  \n  BackupFunctionArn:\n    Description: ARN of the backup function\n    Value: !GetAtt BackupFunction.Arn\n    Export:\n      Name: !Sub '${ProjectName}-BackupFunctionArn'\n"
    },
    {
      "source": "phases/00-foundation/38-memory-dynamodb.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Memory - DynamoDB Tables for Conversation Storage'\n\nResources:\n  # Tabela principal de conversas\n  ConversationsTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub \"${AWS::StackName}-conversations\"\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: timestamp\n          AttributeType: S\n        - AttributeName: session_id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: user_id\n          KeyType: HASH\n        - AttributeName: timestamp\n          KeyType: RANGE\n      GlobalSecondaryIndexes:\n        - IndexName: session-index\n          KeySchema:\n            - AttributeName: session_id\n              KeyType: HASH\n            - AttributeName: timestamp\n              KeyType: RANGE\n          Projection:\n            ProjectionType: ALL\n      StreamSpecification:\n        StreamViewType: NEW_AND_OLD_IMAGES\n      PointInTimeRecoverySpecification:\n        PointInTimeRecoveryEnabled: true\n      SSESpecification:\n        SSEEnabled: true\n      Tags:\n        - Key: Component\n          Value: IAL-Memory\n        - Key: Purpose\n          Value: Conversation-Storage\n\n  # Tabela de embeddings para busca sem\u00e2ntica\n  EmbeddingsTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub \"${AWS::StackName}-embeddings\"\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: user_id\n          AttributeType: S\n        - AttributeName: content_hash\n          AttributeType: S\n      KeySchema:\n        - AttributeName: user_id\n          KeyType: HASH\n        - AttributeName: content_hash\n          KeyType: RANGE\n      SSESpecification:\n        SSEEnabled: true\n      Tags:\n        - Key: Component\n          Value: IAL-Memory\n        - Key: Purpose\n          Value: Embeddings-Storage\n\nOutputs:\n  ConversationsTableName:\n    Description: 'Nome da tabela de c"
    },
    {
      "source": "phases/00-foundation/38-memory-dynamodb.yaml",
      "text": "onversas'\n    Value: !Ref ConversationsTable\n    Export:\n      Name: !Sub \"${AWS::StackName}-conversations-table\"\n\n  ConversationsTableArn:\n    Description: 'ARN da tabela de conversas'\n    Value: !GetAtt ConversationsTable.Arn\n    Export:\n      Name: !Sub \"${AWS::StackName}-conversations-arn\"\n\n  EmbeddingsTableName:\n    Description: 'Nome da tabela de embeddings'\n    Value: !Ref EmbeddingsTable\n    Export:\n      Name: !Sub \"${AWS::StackName}-embeddings-table\"\n"
    },
    {
      "source": "phases/00-foundation/39-reconciliation-wrapper.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Foundation - Reconciliation Wrapper'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # SNS Topic for reconciliation notifications\n  ReconciliationTopic:\n    Type: AWS::SNS::Topic\n    Properties:\n      TopicName: !Sub '${ProjectName}-reconciliation-notifications'\n      DisplayName: 'IAL Reconciliation Notifications'\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: ReconciliationNotifications\n\n  # EventBridge rule for drift detection\n  DriftDetectionRule:\n    Type: AWS::Events::Rule\n    Properties:\n      Name: !Sub '${ProjectName}-drift-detection'\n      Description: 'Periodic drift detection for IAL resources'\n      ScheduleExpression: 'rate(6 hours)'\n      State: ENABLED\n      Targets:\n        - Arn: !Ref ReconciliationTopic\n          Id: DriftDetectionTarget\n\nOutputs:\n  ReconciliationTopicArn:\n    Description: ARN of the reconciliation topic\n    Value: !Ref ReconciliationTopic\n    Export:\n      Name: !Sub '${ProjectName}-39-ReconciliationTopicArn'\n"
    },
    {
      "source": "phases/00-foundation/40-memory-iam.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Memory - IAM Roles and Policies'\n\nResources:\n  # Role para acesso aos recursos de mem\u00f3ria\n  MemoryAccessRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub \"${AWS::StackName}-memory-access-role\"\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n          - Effect: Allow\n            Principal:\n              AWS: !Sub \"arn:aws:iam::${AWS::AccountId}:root\"\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: MemoryAccess\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              # DynamoDB permissions\n              - Effect: Allow\n                Action:\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:Query\n                  - dynamodb:Scan\n                  - dynamodb:UpdateItem\n                  - dynamodb:DeleteItem\n                Resource: \n                  - !Sub \"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${AWS::StackName}-conversations\"\n                  - !Sub \"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${AWS::StackName}-conversations/index/*\"\n                  - !Sub \"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${AWS::StackName}-embeddings\"\n              # S3 permissions\n              - Effect: Allow\n                Action:\n                  - s3:GetObject\n                  - s3:PutObject\n                  - s3:DeleteObject\n                  - s3:ListBucket\n                Resource: \n                  - !Sub \"arn:aws:s3:::ial-memory-${AWS::AccountId}-${AWS::Region}\"\n                  - !Sub \"arn:aws:s3:::ial-memory-${AWS::AccountId}-${AWS::Region}/*\"\n              # Bedrock permission"
    },
    {
      "source": "phases/00-foundation/40-memory-iam.yaml",
      "text": "s\n              - Effect: Allow\n                Action:\n                  - bedrock:InvokeModel\n                Resource: \n                  - \"arn:aws:bedrock:*::foundation-model/amazon.titan-embed-text-v1\"\n                  - \"arn:aws:bedrock:*::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0\"\n\n  # Policy para usu\u00e1rios IAL\n  MemoryUserPolicy:\n    Type: AWS::IAM::ManagedPolicy\n    Properties:\n      ManagedPolicyName: !Sub \"${AWS::StackName}-memory-user-policy\"\n      Description: \"Policy para usu\u00e1rios acessarem recursos de mem\u00f3ria IAL\"\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Action:\n              - dynamodb:GetItem\n              - dynamodb:PutItem\n              - dynamodb:Query\n            Resource: \n              - !Sub \"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${AWS::StackName}-conversations\"\n              - !Sub \"arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${AWS::StackName}-embeddings\"\n          - Effect: Allow\n            Action:\n              - bedrock:InvokeModel\n            Resource: \n              - \"arn:aws:bedrock:*::foundation-model/amazon.titan-embed-text-v1\"\n          - Effect: Allow\n            Action:\n              - sts:AssumeRole\n            Resource: !GetAtt MemoryAccessRole.Arn\n\nOutputs:\n  MemoryAccessRoleArn:\n    Description: 'ARN da role de acesso \u00e0 mem\u00f3ria'\n    Value: !GetAtt MemoryAccessRole.Arn\n    Export:\n      Name: !Sub \"${AWS::StackName}-memory-role-arn\"\n\n  MemoryUserPolicyArn:\n    Description: 'ARN da policy de usu\u00e1rio'\n    Value: !Ref MemoryUserPolicy\n    Export:\n      Name: !Sub \"${AWS::StackName}-memory-user-policy-arn\"\n"
    },
    {
      "source": "phases/00-foundation/41-rag-storage.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL RAG Storage - S3 bucket for knowledge base and vector indices'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-fork\n    Description: Project name for resource naming\n\nResources:\n  # S3 Bucket for RAG Knowledge Base\n  RAGStorageBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${ProjectName}-rag-store-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      VersioningConfiguration:\n        Status: Enabled\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: RAGStorage\n\n  # S3 Bucket for vector indices\n  VectorIndicesBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: !Sub '${ProjectName}-vector-indices-${AWS::AccountId}'\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Component\n          Value: IAL-Foundation\n        - Key: Purpose\n          Value: VectorIndices\n\nOutputs:\n  RAGStorageBucketName:\n    Description: Name of the RAG storage bucket\n    Value: !Ref RAGStorageBucket\n    Export:\n      Name: !Sub '${ProjectName}-41-RAGStorageBucketName'\n  \n  VectorIndicesBucketName:\n    Description: Name of the vector indices bucket\n    Value: !Ref VectorIndicesBucket\n    Export:\n      Name: !Sub '${ProjectName}-41-VectorIndicesBucketName'\n"
    },
    {
      "source": "phases/00-foundation/domain-metadata.yaml",
      "text": "domain:\n  name: \"foundation\"\n  description: \"Core infrastructure foundation - state management, logging, reconciliation, orchestration\"\n  dependencies: []\n  parallel_safe: false\n  estimated_duration: \"45min\"\n  team_owner: \"platform-team\"\n  risk_level: \"low\"\n  phases:\n    - \"01-dynamodb-state.yaml\"\n    - \"02-kms-keys.yaml\"\n    - \"02-logging-infrastructure.yaml\"\n    - \"03-reconciliation-engine.yaml\"\n    - \"04-iam-roles.yaml\"\n    - \"04-backup-strategy.yaml\"\n    - \"05-chaos-engineering.yaml\"\n    - \"06-reconciliation-wrapper.yaml\"\n    - \"07-conversation-memory.yaml\"\n    - \"08-rag-storage.yaml\"\n    - \"08-rag-vector-store.yaml\"\n    - \"09-stepfunctions-orchestrator.yaml\"\n    - \"10-ial-dynamodb-tables.yaml\"\n    - \"11-ial-s3-storage.yaml\"\n    - \"12-ial-rag-infrastructure.yaml\"\n    - \"13-ial-drift-detection.yaml\"\n    - \"14-ial-lambda-functions.yaml\"\n    - \"15-ial-bedrock-github-iam.yaml\"\n    - \"16-ial-test-validation.yaml\"\n    - \"17-ial-finops-budget-enforcement.yaml\"\n    - \"18-ial-feature-flags.yaml\"\n    - \"19-ial-enterprise-observability.yaml\"\n    - \"20-ial-github-oidc-provider.yaml\"\n    - \"21-ial-stepfunctions-migration.yaml\"\n    - \"22-ial-stepfunctions-lambdas.yaml\"\n    - \"23-ial-core-observability.yaml\"\n    - \"24-ial-sns-topics.yaml\"\n  execution_order: \"sequential\"\n  priority: 1\n"
    },
    {
      "source": "phases/10-security/01-kms-security.yaml",
      "text": "# PHASE 01 - KMS ENCRYPTION KEY\n# Primeiro recurso - usado por todos os outros (CR\u00cdTICO)\n\nphase: \"01-kms-security\"\ndescription: \"KMS key for encryption at rest with automatic rotation\"\ndepends_on: [\"00-dynamodb-state\"]\nestimated_cost_monthly: 1\nresource_count: 1\n\nresources:\n  kms_key:\n    name: \"poc-encryption-key\"\n    resource_name: \"01-kms-key\"  # Para DynamoDB tracking\n    type: \"AWS::KMS::Key\"\n    priority: 1\n    \n    # STEP 1: Registrar Pending no DynamoDB\n    before_generate:\n      dynamodb_register_pending: |\n        aws dynamodb put-item \\\n          --table-name mcp-provisioning-checklist \\\n          --item '{\n            \"Project\": {\"S\": \"{{PROJECT_NAME}}\"},\n            \"ResourceName\": {\"S\": \"01-kms-key\"},\n            \"Status\": {\"S\": \"Pending\"},\n            \"Executor\": {\"S\": \"{{EXECUTOR_NAME}}\"},\n            \"LastUpdated\": {\"S\": \"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"},\n            \"Region\": {\"S\": \"{{AWS_REGION}}\"},\n            \"Phase\": {\"S\": \"01-kms-security\"},\n            \"Version\": {\"N\": \"1\"}\n          }'\n    \n    # STEP 2: Generate infrastructure code\n    mcp_workflow:\n      generate_code:\n        tool: \"generate_infrastructure_code\"\n        parameters:\n          resource_type: \"AWS::KMS::Key\"\n          region: \"{{AWS_REGION}}\"\n          properties:\n            Description: \"KMS key for POC encryption at rest\"\n            EnableKeyRotation: true\n            KeyPolicy:\n              Version: \"2012-10-17\"\n              Statement:\n                - Sid: \"Enable IAM User Permissions\"\n                  Effect: \"Allow\"\n                  Principal:\n                    AWS: \"arn:aws:iam::{{AWS_ACCOUNT_ID}}:root\"\n                  Action: \"kms:*\"\n                  Resource: \"*\"\n                - Sid: \"Allow CloudWatch Logs\"\n                  Effect: \"Allow\"\n                  Principal:\n                    Service: \"logs.{{AWS_REGION}}.amazonaws.com\"\n                  Action:\n                    - \"kms:Encrypt\"\n                    - \"kms:Decrypt\"\n                    -"
    },
    {
      "source": "phases/10-security/01-kms-security.yaml",
      "text": " \"kms:ReEncrypt*\"\n                    - \"kms:GenerateDataKey*\"\n                    - \"kms:DescribeKey\"\n                  Resource: \"*\"\n                - Sid: \"Allow EBS\"\n                  Effect: \"Allow\"\n                  Principal:\n                    Service: \"ec2.{{AWS_REGION}}.amazonaws.com\"\n                  Action:\n                    - \"kms:Encrypt\"\n                    - \"kms:Decrypt\"\n                    - \"kms:ReEncrypt*\"\n                    - \"kms:GenerateDataKey*\"\n                    - \"kms:CreateGrant\"\n                    - \"kms:DescribeKey\"\n                  Resource: \"*\"\n                - Sid: \"Allow Parameter Store\"\n                  Effect: \"Allow\"\n                  Principal:\n                    Service: \"ssm.{{AWS_REGION}}.amazonaws.com\"\n                  Action:\n                    - \"kms:Encrypt\"\n                    - \"kms:Decrypt\"\n                    - \"kms:ReEncrypt*\"\n                    - \"kms:GenerateDataKey*\"\n                    - \"kms:DescribeKey\"\n                  Resource: \"*\"\n            Tags:\n              - Key: \"Environment\"\n                Value: \"POC\"\n              - Key: \"Project\"\n                Value: \"{{PROJECT_NAME}}\"\n              - Key: \"ManagedBy\"\n                Value: \"MCP\"\n              - Key: \"Owner\"\n                Value: \"{{EXECUTOR_NAME}}\"\n      \n      # STEP 3: Explain (OBRIGAT\u00d3RIO mostrar ao usu\u00e1rio)\n      explain:\n        tool: \"explain\"\n        wait_for_user_confirmation: true\n      \n      # STEP 4: Create resource\n      create:\n        tool: \"create_resource\"\n        on_success: \"update_dynamodb_created\"\n        on_error: \"update_dynamodb_failed\"\n    \n    # STEP 5: Atualizar DynamoDB para Created\n    after_create:\n      dynamodb_update_created: |\n        aws dynamodb update-item \\\n          --table-name mcp-provisioning-checklist \\\n          --key '{\"Project\":{\"S\":\"{{PROJECT_NAME}}\"},\"ResourceName\":{\"S\":\"01-kms-key\"}}' \\\n          --update-expression \"SET #s=:status, #t=:time, #arn=:arn ADD Version :v\" \\\n         "
    },
    {
      "source": "phases/10-security/01-kms-security.yaml",
      "text": " --expression-attribute-names '{\"#s\":\"Status\",\"#t\":\"LastUpdated\",\"#arn\":\"ARN\"}' \\\n          --expression-attribute-values '{\n            \":status\":{\"S\":\"Created\"},\n            \":time\":{\"S\":\"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"},\n            \":arn\":{\"S\":\"[DYNAMIC_KMS_KEY_ARN]\"},\n            \":v\":{\"N\":\"1\"}\n          }'\n    \n    # STEP 6: Verificar com AWS CLI\n    verification:\n      command: |\n        aws kms describe-key --key-id [DYNAMIC_KMS_KEY_ID] \\\n          --query 'KeyMetadata.{KeyId:KeyId,KeyRotationStatus:KeyRotationStatus,KeyState:KeyState}'\n      \n      expected:\n        KeyState: \"Enabled\"\n        KeyRotationStatus: true\n      \n      on_success: \"update_dynamodb_verified\"\n    \n    # STEP 7: Atualizar DynamoDB para Verified\n    after_verification:\n      dynamodb_update_verified: |\n        aws dynamodb update-item \\\n          --table-name mcp-provisioning-checklist \\\n          --key '{\"Project\":{\"S\":\"{{PROJECT_NAME}}\"},\"ResourceName\":{\"S\":\"01-kms-key\"}}' \\\n          --update-expression \"SET #s=:status, #t=:time ADD Version :v\" \\\n          --expression-attribute-names '{\"#s\":\"Status\",\"#t\":\"LastUpdated\"}' \\\n          --expression-attribute-values '{\n            \":status\":{\"S\":\"Verified\"},\n            \":time\":{\"S\":\"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"},\n            \":v\":{\"N\":\"1\"}\n          }'\n      \n      mark_checklist: \"\u2705 1. KMS Key (poc-encryption-key)\"\n    \n    # STEP 8: Em caso de erro\n    on_error:\n      dynamodb_update_failed: |\n        aws dynamodb update-item \\\n          --table-name mcp-provisioning-checklist \\\n          --key '{\"Project\":{\"S\":\"{{PROJECT_NAME}}\"},\"ResourceName\":{\"S\":\"01-kms-key\"}}' \\\n          --update-expression \"SET #s=:status, #t=:time, #err=:error ADD Version :v\" \\\n          --expression-attribute-names '{\"#s\":\"Status\",\"#t\":\"LastUpdated\",\"#err\":\"ErrorMessage\"}' \\\n          --expression-attribute-values '{\n            \":status\":{\"S\":\"Failed\"},\n            \":time\":{\"S\":\"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"},\n            \":error\":{\"S\":\"[ERROR"
    },
    {
      "source": "phases/10-security/01-kms-security.yaml",
      "text": "_DESCRIPTION]\"},\n            \":v\":{\"N\":\"1\"}\n          }'\n\noutputs:\n  kms_key_id: \"[DYNAMIC_KMS_KEY_ID]\"\n  kms_key_arn: \"arn:aws:kms:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:key/[DYNAMIC_KMS_KEY_ID]\"\n\nrollback:\n  command: |\n    aws kms schedule-key-deletion --key-id [DYNAMIC_KMS_KEY_ID] --pending-window-in-days 7\n  \n  dynamodb_update: |\n    aws dynamodb update-item \\\n      --table-name mcp-provisioning-checklist \\\n      --key '{\"Project\":{\"S\":\"{{PROJECT_NAME}}\"},\"ResourceName\":{\"S\":\"01-kms-key\"}}' \\\n      --update-expression \"SET #s=:status\" \\\n      --expression-attribute-names '{\"#s\":\"Status\"}' \\\n      --expression-attribute-values '{\":status\":{\"S\":\"RolledBack\"}}'\n"
    },
    {
      "source": "phases/10-security/02-security-services.yaml",
      "text": "phase: \"02-security-services\"\ndescription: \"Inspector, GuardDuty, Security Hub, Access Analyzer, Macie, EBS Encryption\"\ndepends_on: [\"01-kms-security\"]\nestimated_cost_monthly: 24\nresource_count: 6\n\nresources:\n  - name: \"amazon-inspector\"\n    resource_name: \"02-inspector\"\n    type: \"AWS::Inspector::Assessment\"\n    dynamodb_tracking: true\n    mcp_workflow:\n      generate: {resource_type: \"AWS::Inspector::Assessment\"}\n      explain: {wait_confirmation: true}\n      create: {tool: \"create_resource\"}\n    verification: \"aws inspector2 batch-get-account-status --query 'accounts[0].resourceState.ecr.status'\"\n    expected: \"ENABLED\"\n\n  - name: \"amazon-guardduty\"\n    resource_name: \"02-guardduty\"\n    type: \"AWS::GuardDuty::Detector\"\n    dynamodb_tracking: true\n    mcp_workflow:\n      generate: {resource_type: \"AWS::GuardDuty::Detector\", properties: {Enable: true, Features: [{Name: \"RUNTIME_MONITORING\", Status: \"ENABLED\"}]}}\n      explain: {wait_confirmation: true}\n      create: {tool: \"create_resource\"}\n    verification: \"aws guardduty list-detectors --query 'DetectorIds[0]'\"\n\n  - name: \"security-hub\"\n    resource_name: \"02-securityhub\"\n    type: \"AWS::SecurityHub::Hub\"\n    dynamodb_tracking: true\n    mcp_workflow:\n      generate: {resource_type: \"AWS::SecurityHub::Hub\", properties: {EnableDefaultStandards: true}}\n      explain: {wait_confirmation: true}\n      create: {tool: \"create_resource\"}\n    verification: \"aws securityhub describe-hub --query 'HubArn'\"\n\n  - name: \"access-analyzer\"\n    resource_name: \"02-accessanalyzer\"\n    type: \"AWS::AccessAnalyzer::Analyzer\"\n    dynamodb_tracking: true\n    mcp_workflow:\n      generate: {resource_type: \"AWS::AccessAnalyzer::Analyzer\", properties: {AnalyzerName: \"account-security-analyzer\", Type: \"ACCOUNT\"}}\n      explain: {wait_confirmation: true}\n      create: {tool: \"create_resource\"}\n    verification: \"aws accessanalyzer list-analyzers --query 'analyzers[0].status'\"\n    expected: \"ACTIVE\"\n\n  - name: \"amazon-macie\"\n    resource_name: "
    },
    {
      "source": "phases/10-security/02-security-services.yaml",
      "text": "\"02-macie\"\n    type: \"AWS::Macie::Session\"\n    dynamodb_tracking: true\n    mcp_workflow:\n      generate: {resource_type: \"AWS::Macie::Session\", properties: {Status: \"ENABLED\", FindingPublishingFrequency: \"FIFTEEN_MINUTES\"}}\n      explain: {wait_confirmation: true}\n      create: {tool: \"create_resource\"}\n    verification: \"aws macie2 get-macie-session --query 'status'\"\n    expected: \"ENABLED\"\n\n  - name: \"ebs-encryption\"\n    resource_name: \"02-ebs-encryption\"\n    type: \"AWS::EC2::EBSEncryption\"\n    dynamodb_tracking: true\n    aws_cli_command: \"aws ec2 enable-ebs-encryption-by-default\"\n    verification: \"aws ec2 get-ebs-encryption-by-default --query 'EbsEncryptionByDefault'\"\n    expected: true\n\noutputs:\n  inspector_enabled: true\n  guardduty_detector_id: \"[DYNAMIC]\"\n  security_hub_arn: \"[DYNAMIC]\"\n  access_analyzer_arn: \"[DYNAMIC]\"\n  macie_enabled: true\n  ebs_encryption_enabled: true\n"
    },
    {
      "source": "phases/10-security/03-secrets-manager.yaml",
      "text": "phase_name: \"Secrets Manager - Secure Credential Management\"\ndescription: \"AWS Secrets Manager for RDS passwords with automatic rotation and proper IAM roles\"\nresource_count: 6\n\nResources:\n  # Aurora PostgreSQL Master Secret\n  AuroraSecret:\n    Type: AWS::SecretsManager::Secret\n    Properties:\n      Name: !Sub '${ProjectName}-aurora-master-secret'\n      Description: 'Aurora PostgreSQL master credentials with automatic rotation'\n      GenerateSecretString:\n        SecretStringTemplate: '{\"username\": \"postgres\"}'\n        GenerateStringKey: 'password'\n        PasswordLength: 32\n        ExcludeCharacters: '\"@/\\\\'\n        RequireEachIncludedType: true\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: DatabaseCredentials\n        - Key: Environment\n          Value: !Ref Environment\n\n  # IAM Role for Aurora to access Secrets Manager\n  AuroraSecretsManagerRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-aurora-secrets-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: rds.amazonaws.com\n            Action: sts:AssumeRole\n      Policies:\n        - PolicyName: AuroraSecretsManagerAccess\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - secretsmanager:GetSecretValue\n                  - secretsmanager:DescribeSecret\n                Resource: !Ref AuroraSecret\n              - Effect: Allow\n                Action:\n                  - kms:Decrypt\n                Resource: \n                  - !Sub 'arn:aws:kms:${AWS::Region}:${AWS::AccountId}:key/*'\n                Condition:\n                  StringEquals:\n                    'kms:ViaService': !Sub 'secretsmanager.${AWS::Region}.amazonaws.com'\n\n  # Lambda Function for Secret Rotation\n  SecretRotationLambda:\n    Type: AWS::Lambda"
    },
    {
      "source": "phases/10-security/03-secrets-manager.yaml",
      "text": "::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-aurora-secret-rotation'\n      Runtime: python3.11\n      Handler: lambda_function.lambda_handler\n      Role: !GetAtt SecretRotationRole.Arn\n      Timeout: 300\n      Environment:\n        Variables:\n          SECRETS_MANAGER_ENDPOINT: !Sub 'https://secretsmanager.${AWS::Region}.amazonaws.com'\n      Code:\n        ZipFile: |\n          import boto3\n          import json\n          import logging\n          import os\n          import psycopg2\n          \n          logger = logging.getLogger()\n          logger.setLevel(logging.INFO)\n          \n          def lambda_handler(event, context):\n              \"\"\"Aurora PostgreSQL secret rotation handler\"\"\"\n              \n              service = boto3.client('secretsmanager')\n              \n              arn = event['Step1']['SecretId']\n              token = event['Step1']['ClientRequestToken']\n              step = event['Step1']['Step']\n              \n              logger.info(f\"Rotating secret {arn} step {step}\")\n              \n              if step == \"createSecret\":\n                  create_secret(service, arn, token)\n              elif step == \"setSecret\":\n                  set_secret(service, arn, token)\n              elif step == \"testSecret\":\n                  test_secret(service, arn, token)\n              elif step == \"finishSecret\":\n                  finish_secret(service, arn, token)\n              else:\n                  raise ValueError(f\"Invalid step parameter: {step}\")\n              \n              return {\"message\": f\"Secret rotation step {step} completed\"}\n          \n          def create_secret(service, arn, token):\n              \"\"\"Create new secret version\"\"\"\n              try:\n                  service.get_secret_value(SecretId=arn, VersionId=token, VersionStage=\"AWSPENDING\")\n                  logger.info(\"Secret already exists for this rotation\")\n              except service.exceptions.ResourceNotFoundException:\n                  # Generate new pass"
    },
    {
      "source": "phases/10-security/03-secrets-manager.yaml",
      "text": "word\n                  service.update_secret_version_stage(\n                      SecretId=arn,\n                      VersionStage=\"AWSPENDING\",\n                      ClientRequestToken=token\n                  )\n                  logger.info(\"Created new secret version\")\n          \n          def set_secret(service, arn, token):\n              \"\"\"Set secret in database\"\"\"\n              logger.info(\"Setting secret in database\")\n              # Get new secret\n              new_secret = service.get_secret_value(SecretId=arn, VersionId=token, VersionStage=\"AWSPENDING\")\n              new_creds = json.loads(new_secret['SecretString'])\n              \n              # Get current secret for connection\n              current_secret = service.get_secret_value(SecretId=arn, VersionStage=\"AWSCURRENT\")\n              current_creds = json.loads(current_secret['SecretString'])\n              \n              # Update password in Aurora\n              try:\n                  conn = psycopg2.connect(\n                      host=current_creds['host'],\n                      port=current_creds['port'],\n                      database=current_creds['dbname'],\n                      user=current_creds['username'],\n                      password=current_creds['password'],\n                      sslmode='require'\n                  )\n                  \n                  cursor = conn.cursor()\n                  cursor.execute(f\"ALTER USER {new_creds['username']} PASSWORD %s\", (new_creds['password'],))\n                  conn.commit()\n                  cursor.close()\n                  conn.close()\n                  \n                  logger.info(\"Password updated in database\")\n              except Exception as e:\n                  logger.error(f\"Failed to update password: {e}\")\n                  raise\n              \n          def test_secret(service, arn, token):\n              \"\"\"Test new secret\"\"\"\n              logger.info(\"Testing new secret\")\n              new_secret = service.get_secret_value(SecretId=a"
    },
    {
      "source": "phases/10-security/03-secrets-manager.yaml",
      "text": "rn, VersionId=token, VersionStage=\"AWSPENDING\")\n              new_creds = json.loads(new_secret['SecretString'])\n              \n              try:\n                  conn = psycopg2.connect(\n                      host=new_creds['host'],\n                      port=new_creds['port'],\n                      database=new_creds['dbname'],\n                      user=new_creds['username'],\n                      password=new_creds['password'],\n                      sslmode='require'\n                  )\n                  conn.close()\n                  logger.info(\"New secret test successful\")\n              except Exception as e:\n                  logger.error(f\"New secret test failed: {e}\")\n                  raise\n              \n          def finish_secret(service, arn, token):\n              \"\"\"Finish rotation\"\"\"\n              service.update_secret_version_stage(\n                  SecretId=arn,\n                  VersionStage=\"AWSCURRENT\",\n                  MoveToVersionId=token\n              )\n              logger.info(\"Finished secret rotation\")\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n\n  # IAM Role for Secret Rotation Lambda\n  SecretRotationRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-secret-rotation-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: SecretsManagerRotationPolicy\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - secretsmanager:DescribeSecret\n                  - secretsmanager:GetSecretValue\n                  - secretsmanager:PutSecretValue\n                  - secretsmanager:UpdateSecretVersio"
    },
    {
      "source": "phases/10-security/03-secrets-manager.yaml",
      "text": "nStage\n                Resource: !Ref AuroraSecret\n              - Effect: Allow\n                Action:\n                  - rds:DescribeDBClusters\n                  - rds:DescribeDBInstances\n                  - rds:ModifyDBCluster\n                  - rds:ModifyDBInstance\n                Resource: '*'\n              - Effect: Allow\n                Action:\n                  - ec2:CreateNetworkInterface\n                  - ec2:DeleteNetworkInterface\n                  - ec2:DescribeNetworkInterfaces\n                  - ec2:DetachNetworkInterface\n                Resource: '*'\n              - Effect: Allow\n                Action:\n                  - kms:Decrypt\n                Resource: \n                  - !Sub 'arn:aws:kms:${AWS::Region}:${AWS::AccountId}:key/*'\n                Condition:\n                  StringEquals:\n                    'kms:ViaService': !Sub 'secretsmanager.${AWS::Region}.amazonaws.com'\n\n  # IAM Role for Lambda functions to access Secrets Manager\n  LambdaSecretsAccessRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-lambda-secrets-access-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole\n      Policies:\n        - PolicyName: SecretsManagerReadAccess\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - secretsmanager:GetSecretValue\n                  - secretsmanager:DescribeSecret\n                Resource: !Ref AuroraSecret\n              - Effect: Allow\n                Action:\n                  - kms:Decrypt\n                Resource: \n                  - !Sub 'arn:aws:kms:${AWS:"
    },
    {
      "source": "phases/10-security/03-secrets-manager.yaml",
      "text": ":Region}:${AWS::AccountId}:key/*'\n                Condition:\n                  StringEquals:\n                    'kms:ViaService': !Sub 'secretsmanager.${AWS::Region}.amazonaws.com'\n\n  # Automatic Secret Rotation Schedule\n  SecretRotationSchedule:\n    Type: AWS::SecretsManager::RotationSchedule\n    Properties:\n      SecretId: !Ref AuroraSecret\n      RotationLambdaArn: !GetAtt SecretRotationLambda.Arn\n      RotationInterval: 30  # Rotate every 30 days\n      RotationImmediate: false\n\n# Outputs for other phases to reference\nOutputs:\n  AuroraSecretArn:\n    Description: 'ARN of the Aurora master secret'\n    Value: !Ref AuroraSecret\n    Export:\n      Name: !Sub '${ProjectName}-aurora-secret-arn'\n\n  AuroraSecretName:\n    Description: 'Name of the Aurora master secret'\n    Value: !Sub '${ProjectName}-aurora-master-secret'\n    Export:\n      Name: !Sub '${ProjectName}-aurora-secret-name'\n\n  AuroraSecretsManagerRoleArn:\n    Description: 'ARN of the Aurora Secrets Manager role'\n    Value: !GetAtt AuroraSecretsManagerRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-aurora-secrets-role-arn'\n\n  LambdaSecretsAccessRoleArn:\n    Description: 'ARN of the Lambda Secrets access role'\n    Value: !GetAtt LambdaSecretsAccessRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-lambda-secrets-role-arn'\n\n  RotationLambdaArn:\n    Description: 'ARN of the secret rotation Lambda'\n    Value: !GetAtt SecretRotationLambda.Arn\n    Export:\n      Name: !Sub '${ProjectName}-rotation-lambda-arn'\n\n# Cost estimation\nmetadata:\n  estimated_monthly_cost: '$0.46'\n  cost_breakdown:\n    secret_storage: '$0.40'\n    api_calls: '$0.01'\n    rotation: '$0.05'\n  \n# Parameters expected from main template\nparameters:\n  ProjectName:\n    Type: String\n    Default: ial\n  Environment:\n    Type: String\n    Default: production\n"
    },
    {
      "source": "phases/10-security/04-iam-roles.yaml",
      "text": "# PHASE 05: IAM ROLES (3 recursos)\n# Depend\u00eancias: KMS key (Phase 01)\n# Custo: $0/m\u00eas\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"05-iam-roles\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 3\n\n# RECURSO 1: ECS Task Execution Role\necs_task_execution_role:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-ecsTaskExecutionRole\"\n        Status: \"Pending\"\n        Phase: \"05-iam-roles\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::IAM::Role\"\n      properties:\n        RoleName: \"{{PROJECT_NAME}}-ecsTaskExecutionRole\"\n        AssumeRolePolicyDocument:\n          Version: \"2012-10-17\"\n          Statement:\n            - Effect: \"Allow\"\n              Principal:\n                Service: \"ecs-tasks.amazonaws.com\"\n              Action: \"sts:AssumeRole\"\n        ManagedPolicyArns:\n          - \"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy\"\n        Policies:\n          - PolicyName: \"KMSDecryptPolicy\"\n            PolicyDocument:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"kms:Decrypt\"\n                    - \"kms:DescribeKey\"\n                  Resource: \"arn:aws:kms:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:key/*\"\n          - PolicyName: \"ECRPullPolicy\"\n            PolicyDocument:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"ecr:GetAuthorizationToken\"\n                    - \"ecr:BatchCheckLayerAvailability\"\n                    - \"ecr:GetDownloadUrlForLayer\"\n                    - \"ecr:BatchGetImage\"\n                  Resource: \"*\"\n          - PolicyName: \"CloudWatchLogsPolicy\"\n            Policy"
    },
    {
      "source": "phases/10-security/04-iam-roles.yaml",
      "text": "Document:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"logs:CreateLogStream\"\n                    - \"logs:PutLogEvents\"\n                  Resource: \"arn:aws:logs:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:log-group:/ecs/{{PROJECT_NAME}}-task:*\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n      note: \"MANDATORY - User must confirm before proceeding\"\n    \n    step_4_create:\n      action: \"create_resource\"\n      note: \"Execute only after user confirmation\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{role_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws iam get-role --role-name {{PROJECT_NAME}}-ecsTaskExecutionRole --region {{AWS_REGION}}\"\n      validation:\n        - \"Role.RoleName == '{{PROJECT_NAME}}-ecsTaskExecutionRole'\"\n        - \"Role.AssumeRolePolicyDocument contains 'ecs-tasks.amazonaws.com'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n      error_message: \"{{error_details}}\"\n\n# RECURSO 2: ECS Task Role\necs_task_role:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-ecsTaskRole\"\n        Status: \"Pending\"\n        Phase: \"05-iam-roles\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::IAM::Role\"\n      properties:\n        RoleName: \"{{PROJECT_NAME}}-ecsTaskRole\"\n        AssumeRolePolicyDocument:\n          Version: \"2012-10-17\"\n          Statement:\n          "
    },
    {
      "source": "phases/10-security/04-iam-roles.yaml",
      "text": "  - Effect: \"Allow\"\n              Principal:\n                Service: \"ecs-tasks.amazonaws.com\"\n              Action: \"sts:AssumeRole\"\n        Policies:\n          - PolicyName: \"ParameterStoreReadPolicy\"\n            PolicyDocument:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"ssm:GetParameter\"\n                    - \"ssm:GetParameters\"\n                  Resource: \"arn:aws:ssm:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:parameter/{{PROJECT_NAME}}/*\"\n          - PolicyName: \"KMSDecryptPolicy\"\n            PolicyDocument:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"kms:Decrypt\"\n                    - \"kms:DescribeKey\"\n                  Resource: \"arn:aws:kms:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:key/*\"\n          - PolicyName: \"XRayPolicy\"\n            PolicyDocument:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"xray:PutTraceSegments\"\n                    - \"xray:PutTelemetryRecords\"\n                  Resource: \"*\"\n          - PolicyName: \"CloudWatchMetricsPolicy\"\n            PolicyDocument:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"cloudwatch:PutMetricData\"\n                  Resource: \"*\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{role_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws iam get-role --role-name {{PROJECT_NAME}}-ecsTaskRole --region {{AWS_REGION}}\"\n      validation:"
    },
    {
      "source": "phases/10-security/04-iam-roles.yaml",
      "text": "\n        - \"Role.RoleName == '{{PROJECT_NAME}}-ecsTaskRole'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 3: VPC Flow Logs Role\nvpc_flowlogs_role:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-flowlogs-role\"\n        Status: \"Pending\"\n        Phase: \"05-iam-roles\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::IAM::Role\"\n      properties:\n        RoleName: \"{{PROJECT_NAME}}-flowlogs-role\"\n        AssumeRolePolicyDocument:\n          Version: \"2012-10-17\"\n          Statement:\n            - Effect: \"Allow\"\n              Principal:\n                Service: \"vpc-flow-logs.amazonaws.com\"\n              Action: \"sts:AssumeRole\"\n        Policies:\n          - PolicyName: \"CloudWatchLogsPolicy\"\n            PolicyDocument:\n              Version: \"2012-10-17\"\n              Statement:\n                - Effect: \"Allow\"\n                  Action:\n                    - \"logs:CreateLogGroup\"\n                    - \"logs:CreateLogStream\"\n                    - \"logs:PutLogEvents\"\n                    - \"logs:DescribeLogGroups\"\n                    - \"logs:DescribeLogStreams\"\n                  Resource: \"*\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{role_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws iam get-role --role-name {{PROJECT_NAME}}-flowlogs-role"
    },
    {
      "source": "phases/10-security/04-iam-roles.yaml",
      "text": " --region {{AWS_REGION}}\"\n      validation:\n        - \"Role.RoleName == '{{PROJECT_NAME}}-flowlogs-role'\"\n        - \"Role.AssumeRolePolicyDocument contains 'vpc-flow-logs.amazonaws.com'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n"
    },
    {
      "source": "phases/10-security/06-waf-cloudfront.yaml",
      "text": "# PHASE 12: WAF + CLOUDFRONT (2 recursos)\n# Depend\u00eancias: ALB (Phase 10)\n# Custo: $40/m\u00eas\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"12-waf-cloudfront\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 2\n\n# RECURSO 1: WAF Web ACL\nwaf_web_acl:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-cloudfront-web-acl\"\n        Status: \"Pending\"\n        Phase: \"12-waf-cloudfront\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::WAFv2::WebACL\"\n      properties:\n        Name: \"{{PROJECT_NAME}}-cloudfront-web-acl\"\n        Scope: \"CLOUDFRONT\"\n        DefaultAction:\n          Allow: {}\n        Rules:\n          - Name: \"AWSManagedRulesCommonRuleSet\"\n            Priority: 1\n            Statement:\n              ManagedRuleGroupStatement:\n                VendorName: \"AWS\"\n                Name: \"AWSManagedRulesCommonRuleSet\"\n            OverrideAction:\n              None: {}\n            VisibilityConfig:\n              SampledRequestsEnabled: true\n              CloudWatchMetricsEnabled: true\n              MetricName: \"AWSManagedRulesCommonRuleSetMetric\"\n          - Name: \"AWSManagedRulesKnownBadInputsRuleSet\"\n            Priority: 2\n            Statement:\n              ManagedRuleGroupStatement:\n                VendorName: \"AWS\"\n                Name: \"AWSManagedRulesKnownBadInputsRuleSet\"\n            OverrideAction:\n              None: {}\n            VisibilityConfig:\n              SampledRequestsEnabled: true\n              CloudWatchMetricsEnabled: true\n              MetricName: \"AWSManagedRulesKnownBadInputsRuleSetMetric\"\n          - Name: \"RateLimitRule\"\n            Priority: 3\n            Statement:\n              RateBasedStatement:\n                Limit: 2000\n                AggregateKeyType: \"IP\"\n      "
    },
    {
      "source": "phases/10-security/06-waf-cloudfront.yaml",
      "text": "      Action:\n              Block: {}\n            VisibilityConfig:\n              SampledRequestsEnabled: true\n              CloudWatchMetricsEnabled: true\n              MetricName: \"RateLimitRuleMetric\"\n          - Name: \"GeoBlockRule\"\n            Priority: 4\n            Statement:\n              NotStatement:\n                Statement:\n                  GeoMatchStatement:\n                    CountryCodes:\n                      - \"BR\"\n                      - \"US\"\n            Action:\n              Block: {}\n            VisibilityConfig:\n              SampledRequestsEnabled: true\n              CloudWatchMetricsEnabled: true\n              MetricName: \"GeoBlockRuleMetric\"\n        VisibilityConfig:\n          SampledRequestsEnabled: true\n          CloudWatchMetricsEnabled: true\n          MetricName: \"{{PROJECT_NAME}}-cloudfront-web-acl\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{waf_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws wafv2 get-web-acl --name {{PROJECT_NAME}}-cloudfront-web-acl --scope CLOUDFRONT --id {{waf_id}} --region {{AWS_REGION}}\"\n      validation:\n        - \"WebACL.Name == '{{PROJECT_NAME}}-cloudfront-web-acl'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 2: CloudFront Distribution\ncloudfront_distribution:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-cloudfront\"\n        Status: \"Pending\"\n        Phase: \"12-waf-cloudfront\"\n        Executor: \"{{EXE"
    },
    {
      "source": "phases/10-security/06-waf-cloudfront.yaml",
      "text": "CUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::CloudFront::Distribution\"\n      properties:\n        DistributionConfig:\n          Enabled: true\n          Comment: \"{{PROJECT_NAME}} CloudFront distribution\"\n          Origins:\n            - Id: \"alb-origin\"\n              DomainName: \"{{alb_dns_name}}\"\n              CustomOriginConfig:\n                HTTPPort: 80\n                OriginProtocolPolicy: \"http-only\"\n                OriginSSLProtocols:\n                  - \"TLSv1.2\"\n              OriginCustomHeaders:\n                - HeaderName: \"X-Origin-Verify\"\n                  HeaderValue: \"{{cloudfront_secret_header}}\"\n          DefaultCacheBehavior:\n            TargetOriginId: \"alb-origin\"\n            ViewerProtocolPolicy: \"redirect-to-https\"\n            AllowedMethods:\n              - \"GET\"\n              - \"HEAD\"\n              - \"OPTIONS\"\n              - \"PUT\"\n              - \"POST\"\n              - \"PATCH\"\n              - \"DELETE\"\n            CachedMethods:\n              - \"GET\"\n              - \"HEAD\"\n              - \"OPTIONS\"\n            Compress: true\n            CachePolicyId: \"658327ea-f89d-4fab-a63d-7e88639e58f6\"\n            OriginRequestPolicyId: \"216adef6-5c7f-47e4-b989-5492eafa07d3\"\n          CacheBehaviors:\n            - PathPattern: \"/actuator/*\"\n              TargetOriginId: \"alb-origin\"\n              ViewerProtocolPolicy: \"redirect-to-https\"\n              AllowedMethods:\n                - \"GET\"\n                - \"HEAD\"\n              CachePolicyId: \"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\"\n              OriginRequestPolicyId: \"216adef6-5c7f-47e4-b989-5492eafa07d3\"\n            - PathPattern: \"/api/*\"\n              TargetOriginId: \"alb-origin\"\n              ViewerProtocolPolicy: \"redirect-to-https\"\n              AllowedMethods:\n                - \"GET\"\n                - \"HEAD\"\n                - \"OPTIONS\"\n                - \"PUT\"\n                - \"POST\"\n   "
    },
    {
      "source": "phases/10-security/06-waf-cloudfront.yaml",
      "text": "             - \"PATCH\"\n                - \"DELETE\"\n              CachePolicyId: \"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\"\n              OriginRequestPolicyId: \"216adef6-5c7f-47e4-b989-5492eafa07d3\"\n            - PathPattern: \"/static/*\"\n              TargetOriginId: \"alb-origin\"\n              ViewerProtocolPolicy: \"redirect-to-https\"\n              AllowedMethods:\n                - \"GET\"\n                - \"HEAD\"\n              CachePolicyId: \"658327ea-f89d-4fab-a63d-7e88639e58f6\"\n              OriginRequestPolicyId: \"216adef6-5c7f-47e4-b989-5492eafa07d3\"\n          PriceClass: \"PriceClass_100\"\n          ViewerCertificate:\n            CloudFrontDefaultCertificate: true\n          WebACLId: \"{{waf_arn}}\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{cloudfront_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws cloudfront get-distribution --id {{distribution_id}} --region {{AWS_REGION}}\"\n      validation:\n        - \"Distribution.Status == 'Deployed'\"\n        - \"Distribution.DistributionConfig.Enabled == true\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n  defense_in_depth:\n    layers:\n      - \"Layer 1: WAF with 4 rules (Common, BadInputs, RateLimit, GeoBlock)\"\n      - \"Layer 2: CloudFront adds X-Origin-Verify custom header\"\n      - \"Layer 3: ALB validates header before forwarding\"\n      - \"Layer 4: Security Group restricts to CloudFront prefix list\"\n"
    },
    {
      "source": "phases/10-security/domain-metadata.yaml",
      "text": "domain:\n  name: \"security\"\n  description: \"Security and compliance components - KMS, IAM, secrets, WAF\"\n  dependencies: [\"foundation\"]\n  parallel_safe: true\n  estimated_duration: \"30min\"\n  team_owner: \"security-team\"\n  risk_level: \"high\"\n  phases:\n    - \"01-kms-security.yaml\"\n    - \"02-security-services.yaml\"\n    - \"03-secrets-manager.yaml\"\n    - \"04-iam-roles.yaml\"\n    - \"05-iam-bedrock-github.yaml\"\n    - \"06-waf-cloudfront.yaml\"\n  execution_order: \"mixed\"\n  priority: 2\n"
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "phase: \"03-networking\"\ndescription: \"VPC with VPC Endpoints (NO NAT Gateway) - Cost-optimized private connectivity\"\ndepends_on: [\"01-kms-security\"]\nestimated_cost_monthly: 14\nresource_count: 25\n\n# ARQUITETURA: VPC Endpoints em vez de NAT Gateway (economia de $18/m\u00eas)\n# Comunica\u00e7\u00e3o privada: ECS \u2192 VPC Endpoints \u2192 AWS Services (ECR, CloudWatch, SSM, S3, X-Ray)\n\nresources:\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 1. VPC\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  vpc:\n    name: \"{{PROJECT_NAME}}-vpc\"\n    resource_name: \"03-vpc\"\n    type: \"AWS::EC2::VPC\"\n    priority: 1\n    \n    mcp_workflow:\n      generate_code:\n        tool: \"generate_infrastructure_code\"\n        parameters:\n          resource_type: \"AWS::EC2::VPC\"\n          region: \"{{AWS_REGION}}\"\n          properties:\n            CidrBlock: \"10.0.0.0/16\"\n            EnableDnsSupport: true\n            EnableDnsHostnames: true\n            Tags:\n              - Key: \"Name\"\n                Value: \"{{PROJECT_NAME}}-vpc\"\n              - Key: \"Project\"\n                Value: \"{{PROJECT_NAME}}\"\n              - Key: \"ManagedBy\"\n                Value: \"IaL\"\n    \n    verification: |\n      aws ec2 describe-vpcs \\\n        --filters \"Name=tag:Name,Values={{PROJECT_NAME}}-vpc\" \\\n        --query 'Vpcs[0].{VpcId:VpcId,State:State,CidrBlock:CidrBlock}' \\\n        --region {{AWS_REGION}}\n\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 2. SUBNETS - 3 Public + 3 Private (Multi-AZ)\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  \n  # PUBLIC SUBNETS (ALB)\n  public_subnet_1a:\n    name: \"{{PROJECT_NAME}}-public-subnet-1a\"\n    resource_name: \"03-public-subnet-1a\"\n    type: \"AWS::EC2::Subnet\"\n    priority: 2\n    properties:\n      VpcId: \"[VPC_ID]\"\n      CidrBlock: \"10.0.1.0/24\"\n      AvailabilityZone: \"{{AWS_REGION}}a\"\n      MapPublicIpOnLaunch: true\n\n  public_subnet_1b:\n    nam"
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "e: \"{{PROJECT_NAME}}-public-subnet-1b\"\n    resource_name: \"03-public-subnet-1b\"\n    type: \"AWS::EC2::Subnet\"\n    priority: 2\n    properties:\n      VpcId: \"[VPC_ID]\"\n      CidrBlock: \"10.0.2.0/24\"\n      AvailabilityZone: \"{{AWS_REGION}}b\"\n      MapPublicIpOnLaunch: true\n\n  public_subnet_1c:\n    name: \"{{PROJECT_NAME}}-public-subnet-1c\"\n    resource_name: \"03-public-subnet-1c\"\n    type: \"AWS::EC2::Subnet\"\n    priority: 2\n    properties:\n      VpcId: \"[VPC_ID]\"\n      CidrBlock: \"10.0.3.0/24\"\n      AvailabilityZone: \"{{AWS_REGION}}c\"\n      MapPublicIpOnLaunch: true\n\n  # PRIVATE SUBNETS (ECS + Redis)\n  private_subnet_1a:\n    name: \"{{PROJECT_NAME}}-private-subnet-1a\"\n    resource_name: \"03-private-subnet-1a\"\n    type: \"AWS::EC2::Subnet\"\n    priority: 2\n    properties:\n      VpcId: \"[VPC_ID]\"\n      CidrBlock: \"10.0.11.0/24\"\n      AvailabilityZone: \"{{AWS_REGION}}a\"\n      MapPublicIpOnLaunch: false\n\n  private_subnet_1b:\n    name: \"{{PROJECT_NAME}}-private-subnet-1b\"\n    resource_name: \"03-private-subnet-1b\"\n    type: \"AWS::EC2::Subnet\"\n    priority: 2\n    properties:\n      VpcId: \"[VPC_ID]\"\n      CidrBlock: \"10.0.12.0/24\"\n      AvailabilityZone: \"{{AWS_REGION}}b\"\n      MapPublicIpOnLaunch: false\n\n  private_subnet_1c:\n    name: \"{{PROJECT_NAME}}-private-subnet-1c\"\n    resource_name: \"03-private-subnet-1c\"\n    type: \"AWS::EC2::Subnet\"\n    priority: 2\n    properties:\n      VpcId: \"[VPC_ID]\"\n      CidrBlock: \"10.0.13.0/24\"\n      AvailabilityZone: \"{{AWS_REGION}}c\"\n      MapPublicIpOnLaunch: false\n\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 3. INTERNET GATEWAY\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  internet_gateway:\n    name: \"{{PROJECT_NAME}}-igw\"\n    resource_name: \"03-igw\"\n    type: \"AWS::EC2::InternetGateway\"\n    priority: 3\n\n  igw_attachment:\n    name: \"IGW Attachment\"\n    resource_name: \"03-igw-attachment\"\n    type: \"AWS::EC2::VPCGatewayAttachment\"\n    priority: 3\n    properties:\n "
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "     VpcId: \"[VPC_ID]\"\n      InternetGatewayId: \"[IGW_ID]\"\n\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 4. ROUTE TABLES\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  \n  # PUBLIC ROUTE TABLE (com rota para Internet)\n  public_route_table:\n    name: \"{{PROJECT_NAME}}-public-rt\"\n    resource_name: \"03-public-rt\"\n    type: \"AWS::EC2::RouteTable\"\n    priority: 4\n    properties:\n      VpcId: \"[VPC_ID]\"\n\n  public_route:\n    name: \"Public Route to Internet\"\n    resource_name: \"03-public-route\"\n    type: \"AWS::EC2::Route\"\n    priority: 4\n    properties:\n      RouteTableId: \"[PUBLIC_RT_ID]\"\n      DestinationCidrBlock: \"0.0.0.0/0\"\n      GatewayId: \"[IGW_ID]\"\n\n  # PRIVATE ROUTE TABLE (SEM rota para Internet - apenas VPC Endpoints)\n  private_route_table:\n    name: \"{{PROJECT_NAME}}-private-rt\"\n    resource_name: \"03-private-rt\"\n    type: \"AWS::EC2::RouteTable\"\n    priority: 4\n    properties:\n      VpcId: \"[VPC_ID]\"\n    note: \"SEM rota 0.0.0.0/0 - comunica\u00e7\u00e3o 100% privada via VPC Endpoints\"\n\n  # SUBNET ASSOCIATIONS\n  public_subnet_1a_association:\n    resource_name: \"03-public-subnet-1a-assoc\"\n    type: \"AWS::EC2::SubnetRouteTableAssociation\"\n    priority: 5\n    properties:\n      SubnetId: \"[PUBLIC_SUBNET_1A_ID]\"\n      RouteTableId: \"[PUBLIC_RT_ID]\"\n\n  public_subnet_1b_association:\n    resource_name: \"03-public-subnet-1b-assoc\"\n    type: \"AWS::EC2::SubnetRouteTableAssociation\"\n    priority: 5\n    properties:\n      SubnetId: \"[PUBLIC_SUBNET_1B_ID]\"\n      RouteTableId: \"[PUBLIC_RT_ID]\"\n\n  public_subnet_1c_association:\n    resource_name: \"03-public-subnet-1c-assoc\"\n    type: \"AWS::EC2::SubnetRouteTableAssociation\"\n    priority: 5\n    properties:\n      SubnetId: \"[PUBLIC_SUBNET_1C_ID]\"\n      RouteTableId: \"[PUBLIC_RT_ID]\"\n\n  private_subnet_1a_association:\n    resource_name: \"03-private-subnet-1a-assoc\"\n    type: \"AWS::EC2::SubnetRouteTableAssociation\"\n    priority: 5\n    properties:\n      SubnetId: \"[PR"
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "IVATE_SUBNET_1A_ID]\"\n      RouteTableId: \"[PRIVATE_RT_ID]\"\n\n  private_subnet_1b_association:\n    resource_name: \"03-private-subnet-1b-assoc\"\n    type: \"AWS::EC2::SubnetRouteTableAssociation\"\n    priority: 5\n    properties:\n      SubnetId: \"[PRIVATE_SUBNET_1B_ID]\"\n      RouteTableId: \"[PRIVATE_RT_ID]\"\n\n  private_subnet_1c_association:\n    resource_name: \"03-private-subnet-1c-assoc\"\n    type: \"AWS::EC2::SubnetRouteTableAssociation\"\n    priority: 5\n    properties:\n      SubnetId: \"[PRIVATE_SUBNET_1C_ID]\"\n      RouteTableId: \"[PRIVATE_RT_ID]\"\n\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 5. SECURITY GROUPS\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  \n  sg_alb_cloudfront_only:\n    name: \"{{PROJECT_NAME}}-sg-alb-cloudfront-only\"\n    resource_name: \"03-sg-alb\"\n    type: \"AWS::EC2::SecurityGroup\"\n    priority: 6\n    properties:\n      GroupName: \"{{PROJECT_NAME}}-sg-alb-cloudfront-only\"\n      GroupDescription: \"ALB Security Group - CloudFront Only\"\n      VpcId: \"[VPC_ID]\"\n      SecurityGroupIngress:\n        - IpProtocol: \"tcp\"\n          FromPort: 80\n          ToPort: 80\n          SourcePrefixListId: \"pl-3b927c52\"  # CloudFront Prefix List\n\n  sg_app:\n    name: \"{{PROJECT_NAME}}-sg-app\"\n    resource_name: \"03-sg-app\"\n    type: \"AWS::EC2::SecurityGroup\"\n    priority: 6\n    properties:\n      GroupName: \"{{PROJECT_NAME}}-sg-app\"\n      GroupDescription: \"ECS Tasks Security Group\"\n      VpcId: \"[VPC_ID]\"\n      SecurityGroupIngress:\n        - IpProtocol: \"tcp\"\n          FromPort: 8080\n          ToPort: 8080\n          SourceSecurityGroupId: \"[SG_ALB_ID]\"\n      SecurityGroupEgress:\n        - IpProtocol: \"-1\"\n          CidrIp: \"0.0.0.0/0\"  # Permite sa\u00edda para VPC Endpoints\n\n  sg_endpoints:\n    name: \"{{PROJECT_NAME}}-sg-endpoints\"\n    resource_name: \"03-sg-endpoints\"\n    type: \"AWS::EC2::SecurityGroup\"\n    priority: 6\n    properties:\n      GroupName: \"{{PROJECT_NAME}}-sg-endpoints\"\n      GroupDescript"
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "ion: \"VPC Endpoints Security Group\"\n      VpcId: \"[VPC_ID]\"\n      SecurityGroupIngress:\n        - IpProtocol: \"tcp\"\n          FromPort: 443\n          ToPort: 443\n          SourceSecurityGroupId: \"[SG_APP_ID]\"\n          Description: \"HTTPS from ECS tasks\"\n        - IpProtocol: \"tcp\"\n          FromPort: 443\n          ToPort: 443\n          SourceSecurityGroupId: \"[SG_LAMBDA_ID]\"\n          Description: \"HTTPS from Lambda functions\"\n\n  sg_redis:\n    name: \"{{PROJECT_NAME}}-sg-redis\"\n    resource_name: \"03-sg-redis\"\n    type: \"AWS::EC2::SecurityGroup\"\n    priority: 6\n    properties:\n      GroupName: \"{{PROJECT_NAME}}-sg-redis\"\n      GroupDescription: \"Redis Security Group\"\n      VpcId: \"[VPC_ID]\"\n      SecurityGroupIngress:\n        - IpProtocol: \"tcp\"\n          FromPort: 6379\n          ToPort: 6379\n          SourceSecurityGroupId: \"[SG_APP_ID]\"\n\n  sg_database:\n    name: \"{{PROJECT_NAME}}-sg-db\"\n    resource_name: \"03-sg-db\"\n    type: \"AWS::EC2::SecurityGroup\"\n    priority: 6\n    properties:\n      GroupName: \"{{PROJECT_NAME}}-sg-db\"\n      GroupDescription: \"Aurora PostgreSQL Security Group - Access from ECS only\"\n      VpcId: \"[VPC_ID]\"\n      SecurityGroupIngress:\n        - IpProtocol: \"tcp\"\n          FromPort: 5432\n          ToPort: 5432\n          SourceSecurityGroupId: \"[SG_APP_ID]\"\n          Description: \"PostgreSQL from ECS tasks\"\n\n  sg_lambda:\n    name: \"{{PROJECT_NAME}}-sg-lambda\"\n    resource_name: \"03-sg-lambda\"\n    type: \"AWS::EC2::SecurityGroup\"\n    priority: 6\n    properties:\n      GroupName: \"{{PROJECT_NAME}}-sg-lambda\"\n      GroupDescription: \"Lambda Security Group - Access to VPC Endpoints\"\n      VpcId: \"[VPC_ID]\"\n      SecurityGroupEgress:\n        - IpProtocol: \"tcp\"\n          FromPort: 443\n          ToPort: 443\n          DestinationSecurityGroupId: \"[SG_ENDPOINTS_ID]\"\n          Description: \"HTTPS to VPC Endpoints\"\n        - IpProtocol: \"tcp\"\n          FromPort: 443\n          ToPort: 443\n          CidrIp: \"0.0.0.0/0\"\n          Description: \"HTTPS to API Gat"
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "eway (p\u00fablico)\"\n\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 6. VPC ENDPOINTS (Substituem NAT Gateway - Economia de $18/m\u00eas)\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  \n  # S3 GATEWAY ENDPOINT (FREE)\n  s3_gateway_endpoint:\n    name: \"S3 Gateway Endpoint\"\n    resource_name: \"03-vpce-s3\"\n    type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.s3\"\n      VpcEndpointType: \"Gateway\"\n      RouteTableIds:\n        - \"[PUBLIC_RT_ID]\"\n        - \"[PRIVATE_RT_ID]\"  # AMBOS obrigat\u00f3rios\n      PolicyDocument:\n        Version: \"2012-10-17\"\n        Statement:\n          - Effect: \"Allow\"\n            Principal: \"*\"\n            Action: \"s3:*\"\n            Resource: \"*\"\n    note: \"Gateway Endpoint - FREE - Usado para ECR image layers\"\n\n  # ECR API INTERFACE ENDPOINT ($7/m\u00eas)\n  ecr_api_endpoint:\n    name: \"ECR API Interface Endpoint\"\n    resource_name: \"03-vpce-ecr-api\"\n    type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.ecr.api\"\n      VpcEndpointType: \"Interface\"\n      SubnetIds:\n        - \"[PRIVATE_SUBNET_1A_ID]\"\n        - \"[PRIVATE_SUBNET_1B_ID]\"\n        - \"[PRIVATE_SUBNET_1C_ID]\"\n      SecurityGroupIds:\n        - \"[SG_ENDPOINTS_ID]\"\n      PrivateDnsEnabled: true\n    note: \"Interface Endpoint - $7/m\u00eas - Necess\u00e1rio para ECR pull\"\n\n  # ECR DKR INTERFACE ENDPOINT ($7/m\u00eas)\n  ecr_dkr_endpoint:\n    name: \"ECR DKR Interface Endpoint\"\n    resource_name: \"03-vpce-ecr-dkr\"\n    type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.ecr.dkr\"\n      VpcEndpointType: \"Interface\"\n      SubnetIds:\n        - \"[PRIVATE_SUBNET_1A_ID]\"\n        - \"[PRIVATE_SUBNET_1B_ID]\"\n        - \"[PRIVATE_SUBNET_1C_ID]\"\n      SecurityGroupIds:\n        - \"[SG_ENDPOINTS_ID]\"\n      PrivateDnsEn"
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "abled: true\n    note: \"Interface Endpoint - $7/m\u00eas - Necess\u00e1rio para ECR pull\"\n\n  # CLOUDWATCH LOGS INTERFACE ENDPOINT ($7/m\u00eas)\n  logs_endpoint:\n    name: \"CloudWatch Logs Interface Endpoint\"\n    resource_name: \"03-vpce-logs\"\n    type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.logs\"\n      VpcEndpointType: \"Interface\"\n      SubnetIds:\n        - \"[PRIVATE_SUBNET_1A_ID]\"\n        - \"[PRIVATE_SUBNET_1B_ID]\"\n        - \"[PRIVATE_SUBNET_1C_ID]\"\n      SecurityGroupIds:\n        - \"[SG_ENDPOINTS_ID]\"\n      PrivateDnsEnabled: true\n    note: \"Interface Endpoint - $7/m\u00eas - Necess\u00e1rio para ECS logs\"\n\n  # SSM INTERFACE ENDPOINT ($7/m\u00eas)\n  ssm_endpoint:\n    name: \"SSM Interface Endpoint\"\n    resource_name: \"03-vpce-ssm\"\n    type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.ssm\"\n      VpcEndpointType: \"Interface\"\n      SubnetIds:\n        - \"[PRIVATE_SUBNET_1A_ID]\"\n        - \"[PRIVATE_SUBNET_1B_ID]\"\n        - \"[PRIVATE_SUBNET_1C_ID]\"\n      SecurityGroupIds:\n        - \"[SG_ENDPOINTS_ID]\"\n      PrivateDnsEnabled: true\n    note: \"Interface Endpoint - $7/m\u00eas - CR\u00cdTICO para Parameter Store\"\n\n  # X-RAY INTERFACE ENDPOINT ($7/m\u00eas)\n  xray_endpoint:\n    name: \"X-Ray Interface Endpoint\"\n    resource_name: \"03-vpce-xray\"\n    type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.xray\"\n      VpcEndpointType: \"Interface\"\n      SubnetIds:\n        - \"[PRIVATE_SUBNET_1A_ID]\"\n        - \"[PRIVATE_SUBNET_1B_ID]\"\n        - \"[PRIVATE_SUBNET_1C_ID]\"\n      SecurityGroupIds:\n        - \"[SG_ENDPOINTS_ID]\"\n      PrivateDnsEnabled: true\n    note: \"Interface Endpoint - $7/m\u00eas - CR\u00cdTICO para X-Ray SDK-only\"\n\n  # DYNAMODB GATEWAY ENDPOINT (FREE) - Para Phase 17\n  dynamodb_gateway_endpoint:\n    name: \"DynamoDB Gateway Endpoint\"\n    resource_name: \"03-vpce-dynamodb\"\n  "
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "  type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.dynamodb\"\n      VpcEndpointType: \"Gateway\"\n      RouteTableIds:\n        - \"[PUBLIC_RT_ID]\"\n        - \"[PRIVATE_RT_ID]\"\n      PolicyDocument:\n        Version: \"2012-10-17\"\n        Statement:\n          - Effect: \"Allow\"\n            Principal: \"*\"\n            Action: \"dynamodb:*\"\n            Resource: \"*\"\n    note: \"Gateway Endpoint - FREE - Para Lambda acessar DynamoDB\"\n\n  # BEDROCK RUNTIME INTERFACE ENDPOINT ($7/m\u00eas) - Para Phase 17\n  bedrock_runtime_endpoint:\n    name: \"Bedrock Runtime Interface Endpoint\"\n    resource_name: \"03-vpce-bedrock-runtime\"\n    type: \"AWS::EC2::VPCEndpoint\"\n    priority: 7\n    properties:\n      VpcId: \"[VPC_ID]\"\n      ServiceName: \"com.amazonaws.{{AWS_REGION}}.bedrock-runtime\"\n      VpcEndpointType: \"Interface\"\n      SubnetIds:\n        - \"[PRIVATE_SUBNET_1A_ID]\"\n        - \"[PRIVATE_SUBNET_1B_ID]\"\n        - \"[PRIVATE_SUBNET_1C_ID]\"\n      SecurityGroupIds:\n        - \"[SG_ENDPOINTS_ID]\"\n      PrivateDnsEnabled: true\n    note: \"Interface Endpoint - $7/m\u00eas - Para Lambda acessar Bedrock\"\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# VALIDA\u00c7\u00d5ES CR\u00cdTICAS\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nvalidation:\n  pre_ecs_checks:\n    - name: \"Verificar VPC Endpoints ativos\"\n      command: |\n        aws ec2 describe-vpc-endpoints \\\n          --filters \"Name=vpc-id,Values=[VPC_ID]\" \\\n          --query 'VpcEndpoints[*].{Service:ServiceName,State:State}' \\\n          --region {{AWS_REGION}}\n      expected: \"Todos endpoints com State=available\"\n    \n    - name: \"Verificar Private DNS habilitado\"\n      command: |\n        aws ec2 describe-vpc-endpoints \\\n          --filters \"Name=vpc-id,Values=[VPC_ID]\" \"Name=vpc-endpoint-type,Values=Interface\" \\\n          --query 'VpcEndpoints[*].{Service:ServiceName,PrivateDns:PrivateDnsEnabled}' \\\n          --re"
    },
    {
      "source": "phases/20-network/01-networking.yaml",
      "text": "gion {{AWS_REGION}}\n      expected: \"Todos Interface Endpoints com PrivateDnsEnabled=true\"\n    \n    - name: \"Verificar Route Table privada SEM rota 0.0.0.0/0\"\n      command: |\n        aws ec2 describe-route-tables \\\n          --filters \"Name=tag:Name,Values={{PROJECT_NAME}}-private-rt\" \\\n          --query 'RouteTables[0].Routes[?DestinationCidrBlock==`0.0.0.0/0`]' \\\n          --region {{AWS_REGION}}\n      expected: \"[] (vazio - sem rota para internet)\"\n\nnotes:\n  - \"VPC Endpoints substituem NAT Gateway - economia de $18/m\u00eas\"\n  - \"S3 Gateway Endpoint \u00e9 FREE\"\n  - \"5 Interface Endpoints = $35/m\u00eas (vs $32/m\u00eas de 2 NAT Gateways)\"\n  - \"Economia real considerando data transfer: ~$18/m\u00eas\"\n  - \"Subnets privadas N\u00c3O t\u00eam rota para internet (0.0.0.0/0)\"\n  - \"Comunica\u00e7\u00e3o 100% privada via VPC Endpoints\"\n  - \"Private DNS DEVE estar habilitado para Interface Endpoints\"\n\ncost_breakdown:\n  s3_gateway_endpoint: 0\n  ecr_api_endpoint: 7\n  ecr_dkr_endpoint: 7\n  logs_endpoint: 7\n  ssm_endpoint: 7\n  xray_endpoint: 7\n  total_monthly: 35\n  vs_nat_gateway: 32\n  real_savings_with_data_transfer: 18\n"
    },
    {
      "source": "phases/20-network/02-vpc-flow-logs.yaml",
      "text": "# PHASE 13: VPC FLOW LOGS (5 recursos)\n# Depend\u00eancias: VPC, Subnets, IAM Role, KMS (Phases 01, 03, 05)\n# Custo: $30/m\u00eas\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"13-vpc-flow-logs\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 5\n\n# RECURSO 1: VPC-level Log Group\nvpc_log_group:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"/aws/vpc/flowlogs/{{PROJECT_NAME}}-vpc\"\n        Status: \"Pending\"\n        Phase: \"13-vpc-flow-logs\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::Logs::LogGroup\"\n      properties:\n        LogGroupName: \"/aws/vpc/flowlogs/{{PROJECT_NAME}}-vpc\"\n        RetentionInDays: 90\n        KmsKeyId: \"arn:aws:kms:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:key/{{kms_key_id}}\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{log_group_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws logs describe-log-groups --log-group-name-prefix /aws/vpc/flowlogs/{{PROJECT_NAME}}-vpc --region {{AWS_REGION}}\"\n      validation:\n        - \"logGroups[0].retentionInDays == 90\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 2: Private Subnets Log Group\nprivate_log_group:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"/aws/vpc/flowlogs/private"
    },
    {
      "source": "phases/20-network/02-vpc-flow-logs.yaml",
      "text": "-subnets\"\n        Status: \"Pending\"\n        Phase: \"13-vpc-flow-logs\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::Logs::LogGroup\"\n      properties:\n        LogGroupName: \"/aws/vpc/flowlogs/private-subnets\"\n        RetentionInDays: 30\n        KmsKeyId: \"arn:aws:kms:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:key/{{kms_key_id}}\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws logs describe-log-groups --log-group-name-prefix /aws/vpc/flowlogs/private-subnets --region {{AWS_REGION}}\"\n      validation:\n        - \"logGroups[0].retentionInDays == 30\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 3: Public Subnets Log Group\npublic_log_group:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"/aws/vpc/flowlogs/public-subnets\"\n        Status: \"Pending\"\n        Phase: \"13-vpc-flow-logs\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::Logs::LogGroup\"\n      properties:\n        LogGroupName: \"/aws/vpc/flowlogs/public-subnets\"\n        RetentionInDays: 30\n        KmsKeyId: \"arn:aws:kms:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:key/{{kms_key_id}}\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n         "
    },
    {
      "source": "phases/20-network/02-vpc-flow-logs.yaml",
      "text": " - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws logs describe-log-groups --log-group-name-prefix /aws/vpc/flowlogs/public-subnets --region {{AWS_REGION}}\"\n      validation:\n        - \"logGroups[0].retentionInDays == 30\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 4: VPC-level Flow Logs (ALL traffic)\nvpc_flow_logs:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"vpc-flowlogs-all\"\n        Status: \"Pending\"\n        Phase: \"13-vpc-flow-logs\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::EC2::FlowLog\"\n      properties:\n        ResourceType: \"VPC\"\n        ResourceIds:\n          - \"{{vpc_id}}\"\n        TrafficType: \"ALL\"\n        LogDestinationType: \"cloud-watch-logs\"\n        LogGroupName: \"/aws/vpc/flowlogs/{{PROJECT_NAME}}-vpc\"\n        DeliverLogsPermissionArn: \"arn:aws:iam::{{AWS_ACCOUNT_ID}}:role/{{PROJECT_NAME}}-flowlogs-role\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      id: \"{{flow_log_id}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws ec2 describe-flow-logs --filter Name=resource-id,Values={{vpc_id}} --region "
    },
    {
      "source": "phases/20-network/02-vpc-flow-logs.yaml",
      "text": "{{AWS_REGION}}\"\n      validation:\n        - \"FlowLogs[0].TrafficType == 'ALL'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 5: Private Subnets Flow Logs (REJECT only)\nprivate_flow_logs:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"private-subnets-flowlogs-reject\"\n        Status: \"Pending\"\n        Phase: \"13-vpc-flow-logs\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::EC2::FlowLog\"\n      properties:\n        ResourceType: \"Subnet\"\n        ResourceIds:\n          - \"{{private_subnet_1a_id}}\"\n          - \"{{private_subnet_1b_id}}\"\n          - \"{{private_subnet_1c_id}}\"\n        TrafficType: \"REJECT\"\n        LogDestinationType: \"cloud-watch-logs\"\n        LogGroupName: \"/aws/vpc/flowlogs/private-subnets\"\n        DeliverLogsPermissionArn: \"arn:aws:iam::{{AWS_ACCOUNT_ID}}:role/{{PROJECT_NAME}}-flowlogs-role\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws ec2 describe-flow-logs --filter Name=resource-id,Values={{private_subnet_1a_id}} --region {{AWS_REGION}}\"\n      validation:\n        - \"FlowLogs[0].TrafficType == 'REJECT'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n"
    },
    {
      "source": "phases/20-network/domain-metadata.yaml",
      "text": "domain:\n  name: \"network\"\n  description: \"Network infrastructure - VPC, subnets, flow logs\"\n  dependencies: [\"foundation\", \"security\"]\n  parallel_safe: false\n  estimated_duration: \"20min\"\n  team_owner: \"network-team\"\n  risk_level: \"medium\"\n  phases:\n    - \"01-networking.yaml\"\n    - \"02-vpc-flow-logs.yaml\"\n  execution_order: \"sequential\"\n  priority: 3\n"
    },
    {
      "source": "phases/30-compute/01-ecr.yaml",
      "text": "# PHASE 06: ECR REPOSITORY (1 recurso)\n# Depend\u00eancias: KMS key (Phase 01)\n# Custo: $0/m\u00eas (storage-based)\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"06-ecr\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 1\n\n# RECURSO 1: ECR Repository\necr_repository:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-ecr\"\n        Status: \"Pending\"\n        Phase: \"06-ecr\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::ECR::Repository\"\n      properties:\n        RepositoryName: \"{{PROJECT_NAME}}\"\n        ImageScanningConfiguration:\n          ScanOnPush: true\n        EncryptionConfiguration:\n          EncryptionType: \"KMS\"\n          KmsKey: \"alias/poc-encryption-key\"\n        ImageTagMutability: \"MUTABLE\"\n        LifecyclePolicy:\n          LifecyclePolicyText: |\n            {\n              \"rules\": [\n                {\n                  \"rulePriority\": 1,\n                  \"description\": \"Keep last 10 images\",\n                  \"selection\": {\n                    \"tagStatus\": \"any\",\n                    \"countType\": \"imageCountMoreThan\",\n                    \"countNumber\": 10\n                  },\n                  \"action\": {\n                    \"type\": \"expire\"\n                  }\n                }\n              ]\n            }\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n      note: \"MANDATORY - User must confirm before proceeding\"\n    \n    step_4_create:\n      action: \"create_resource\"\n      note: \"Execute only after user confirmation\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{repository_arn}}\"\n    \n    step_6_veri"
    },
    {
      "source": "phases/30-compute/01-ecr.yaml",
      "text": "fy:\n      action: \"aws_cli\"\n      command: \"aws ecr describe-repositories --repository-names {{PROJECT_NAME}} --region {{AWS_REGION}}\"\n      validation:\n        - \"repositories[0].repositoryName == '{{PROJECT_NAME}}'\"\n        - \"repositories[0].imageScanningConfiguration.scanOnPush == true\"\n        - \"repositories[0].encryptionConfiguration.encryptionType == 'KMS'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n      error_message: \"{{error_details}}\"\n\n  critical_validation:\n    note: \"ECR repository MUST exist with scanOnPush=true BEFORE ECS Task Definition\"\n    command: \"aws ecr describe-repositories --repository-names {{PROJECT_NAME}} --region {{AWS_REGION}} --query 'repositories[0].imageScanningConfiguration.scanOnPush'\"\n    expected: \"true\"\n"
    },
    {
      "source": "phases/30-compute/02-ecs-cluster.yaml",
      "text": "# PHASE 07: ECS CLUSTER + LOG GROUP (2 recursos)\n# Depend\u00eancias: KMS key (Phase 01)\n# Custo: $0/m\u00eas (task-based)\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"07-ecs-cluster\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 2\n\n# RECURSO 1: CloudWatch Log Group\ncloudwatch_log_group:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"/ecs/{{PROJECT_NAME}}-task\"\n        Status: \"Pending\"\n        Phase: \"07-ecs-cluster\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::Logs::LogGroup\"\n      properties:\n        LogGroupName: \"/ecs/{{PROJECT_NAME}}-task\"\n        RetentionInDays: 30\n        KmsKeyId: \"arn:aws:kms:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:key/{{kms_key_id}}\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{log_group_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws logs describe-log-groups --log-group-name-prefix /ecs/{{PROJECT_NAME}}-task --region {{AWS_REGION}}\"\n      validation:\n        - \"logGroups[0].logGroupName == '/ecs/{{PROJECT_NAME}}-task'\"\n        - \"logGroups[0].retentionInDays == 30\"\n        - \"logGroups[0].kmsKeyId is not null\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 2: ECS Cluster\necs_cluster:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT"
    },
    {
      "source": "phases/30-compute/02-ecs-cluster.yaml",
      "text": "_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-cluster\"\n        Status: \"Pending\"\n        Phase: \"07-ecs-cluster\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::ECS::Cluster\"\n      properties:\n        ClusterName: \"{{PROJECT_NAME}}-cluster\"\n        ClusterSettings:\n          - Name: \"containerInsights\"\n            Value: \"enabled\"\n        Configuration:\n          ExecuteCommandConfiguration:\n            Logging: \"DEFAULT\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{cluster_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws ecs describe-clusters --clusters {{PROJECT_NAME}}-cluster --region {{AWS_REGION}}\"\n      validation:\n        - \"clusters[0].clusterName == '{{PROJECT_NAME}}-cluster'\"\n        - \"clusters[0].status == 'ACTIVE'\"\n        - \"clusters[0].settings[?name=='containerInsights'].value | [0] == 'enabled'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n"
    },
    {
      "source": "phases/30-compute/03-ecs-task-service.yaml",
      "text": "# PHASE 08: ECS TASK DEFINITION + SERVICE (2 recursos)\n# Depend\u00eancias: IAM Roles, ECR, ECS Cluster, Security Groups, Subnets\n# Custo: $180/m\u00eas (3 tasks * 512 CPU * 1024 Memory)\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"08-ecs-task-service\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 2\n\n# RECURSO 1: ECS Task Definition\necs_task_definition:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-task\"\n        Status: \"Pending\"\n        Phase: \"08-ecs-task-service\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::ECS::TaskDefinition\"\n      properties:\n        Family: \"{{PROJECT_NAME}}-task\"\n        NetworkMode: \"awsvpc\"\n        RequiresCompatibilities:\n          - \"FARGATE\"\n        Cpu: \"512\"\n        Memory: \"1024\"\n        ExecutionRoleArn: \"arn:aws:iam::{{AWS_ACCOUNT_ID}}:role/{{PROJECT_NAME}}-ecsTaskExecutionRole\"\n        TaskRoleArn: \"arn:aws:iam::{{AWS_ACCOUNT_ID}}:role/{{PROJECT_NAME}}-ecsTaskRole\"\n        ContainerDefinitions:\n          - Name: \"{{PROJECT_NAME}}\"\n            Image: \"{{AWS_ACCOUNT_ID}}.dkr.ecr.{{AWS_REGION}}.amazonaws.com/{{PROJECT_NAME}}:latest\"\n            Essential: true\n            PortMappings:\n              - ContainerPort: 8080\n                Protocol: \"tcp\"\n            Environment:\n              - Name: \"SPRING_PROFILES_ACTIVE\"\n                Value: \"prod\"\n              - Name: \"AWS_XRAY_DAEMON_ADDRESS\"\n                Value: \"xray-daemon:2000\"\n            Secrets:\n              - Name: \"REDIS_ENDPOINT\"\n                ValueFrom: \"arn:aws:ssm:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:parameter/{{PROJECT_NAME}}/redis/endpoint\"\n              - Name: \"REDIS_PORT\"\n                ValueFrom: \"arn:aws:ssm:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:parameter/{{PROJECT_NAME}}/redis/por"
    },
    {
      "source": "phases/30-compute/03-ecs-task-service.yaml",
      "text": "t\"\n              - Name: \"REDIS_SSL\"\n                ValueFrom: \"arn:aws:ssm:{{AWS_REGION}}:{{AWS_ACCOUNT_ID}}:parameter/{{PROJECT_NAME}}/redis/ssl\"\n            LogConfiguration:\n              LogDriver: \"awslogs\"\n              Options:\n                awslogs-group: \"/ecs/{{PROJECT_NAME}}-task\"\n                awslogs-region: \"{{AWS_REGION}}\"\n                awslogs-stream-prefix: \"ecs\"\n            HealthCheck:\n              Command:\n                - \"CMD-SHELL\"\n                - \"curl -f http://localhost:8080/actuator/health || exit 1\"\n              Interval: 30\n              Timeout: 5\n              Retries: 3\n              StartPeriod: 60\n          - Name: \"xray-daemon\"\n            Image: \"public.ecr.aws/xray/aws-xray-daemon:latest\"\n            Essential: false\n            Cpu: 32\n            Memory: 256\n            PortMappings:\n              - ContainerPort: 2000\n                Protocol: \"udp\"\n            LogConfiguration:\n              LogDriver: \"awslogs\"\n              Options:\n                awslogs-group: \"/ecs/{{PROJECT_NAME}}-task\"\n                awslogs-region: \"{{AWS_REGION}}\"\n                awslogs-stream-prefix: \"xray\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{task_definition_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws ecs describe-task-definition --task-definition {{PROJECT_NAME}}-task --region {{AWS_REGION}}\"\n      validation:\n        - \"taskDefinition.family == '{{PROJECT_NAME}}-task'\"\n        - \"taskDefinition.cpu == '512'\"\n        - \"taskDefinition.memory == '1024'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      "
    },
    {
      "source": "phases/30-compute/03-ecs-task-service.yaml",
      "text": "status: \"Failed\"\n\n# RECURSO 2: ECS Service\necs_service:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-service\"\n        Status: \"Pending\"\n        Phase: \"08-ecs-task-service\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::ECS::Service\"\n      properties:\n        ServiceName: \"{{PROJECT_NAME}}-service\"\n        Cluster: \"{{PROJECT_NAME}}-cluster\"\n        TaskDefinition: \"{{PROJECT_NAME}}-task\"\n        DesiredCount: 3\n        LaunchType: \"FARGATE\"\n        PlatformVersion: \"LATEST\"\n        NetworkConfiguration:\n          AwsvpcConfiguration:\n            Subnets:\n              - \"{{private_subnet_1a_id}}\"\n              - \"{{private_subnet_1b_id}}\"\n              - \"{{private_subnet_1c_id}}\"\n            SecurityGroups:\n              - \"{{sg_app_id}}\"\n            AssignPublicIp: \"DISABLED\"\n        LoadBalancers:\n          - TargetGroupArn: \"{{target_group_arn}}\"\n            ContainerName: \"{{PROJECT_NAME}}\"\n            ContainerPort: 8080\n        HealthCheckGracePeriodSeconds: 60\n        DeploymentConfiguration:\n          MaximumPercent: 200\n          MinimumHealthyPercent: 100\n          DeploymentCircuitBreaker:\n            Enable: true\n            Rollback: true\n        EnableExecuteCommand: true\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{service_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws ecs describe-services --cluster {{PROJECT_NAME}}-cluster --services {{PROJECT_NA"
    },
    {
      "source": "phases/30-compute/03-ecs-task-service.yaml",
      "text": "ME}}-service --region {{AWS_REGION}}\"\n      validation:\n        - \"services[0].serviceName == '{{PROJECT_NAME}}-service'\"\n        - \"services[0].status == 'ACTIVE'\"\n        - \"services[0].desiredCount == 3\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n"
    },
    {
      "source": "phases/30-compute/04-ecs-autoscaling.yaml",
      "text": "# PHASE 09: ECS AUTO SCALING (4 recursos)\n# Depend\u00eancias: ECS Service (Phase 08)\n# Custo: $0/m\u00eas (scaling-based)\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"09-ecs-autoscaling\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 4\n\n# RECURSO 1: Auto Scaling Target\nautoscaling_target:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"ecs-autoscaling-target\"\n        Status: \"Pending\"\n        Phase: \"09-ecs-autoscaling\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_create:\n      action: \"aws_cli\"\n      command: |\n        aws application-autoscaling register-scalable-target \\\n          --service-namespace ecs \\\n          --resource-id service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service \\\n          --scalable-dimension ecs:service:DesiredCount \\\n          --min-capacity 2 \\\n          --max-capacity 15 \\\n          --region {{AWS_REGION}}\n    \n    step_3_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n    \n    step_4_verify:\n      action: \"aws_cli\"\n      command: \"aws application-autoscaling describe-scalable-targets --service-namespace ecs --resource-ids service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service --region {{AWS_REGION}}\"\n      validation:\n        - \"ScalableTargets[0].MinCapacity == 2\"\n        - \"ScalableTargets[0].MaxCapacity == 15\"\n    \n    step_5_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_6_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 2: CPU Scaling Policy\ncpu_scaling_policy:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"ecs-cpu-scaling-policy\"\n        Status: \"Pending\"\n        Phase: \"09-ecs-autoscaling\"\n        Executor: \"{{EXECUTO"
    },
    {
      "source": "phases/30-compute/04-ecs-autoscaling.yaml",
      "text": "R_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_create:\n      action: \"aws_cli\"\n      command: |\n        aws application-autoscaling put-scaling-policy \\\n          --service-namespace ecs \\\n          --resource-id service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service \\\n          --scalable-dimension ecs:service:DesiredCount \\\n          --policy-name {{PROJECT_NAME}}-cpu-scaling \\\n          --policy-type TargetTrackingScaling \\\n          --target-tracking-scaling-policy-configuration '{\n            \"TargetValue\": 75.0,\n            \"PredefinedMetricSpecification\": {\n              \"PredefinedMetricType\": \"ECSServiceAverageCPUUtilization\"\n            },\n            \"ScaleInCooldown\": 300,\n            \"ScaleOutCooldown\": 60\n          }' \\\n          --region {{AWS_REGION}}\n    \n    step_3_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n    \n    step_4_verify:\n      action: \"aws_cli\"\n      command: \"aws application-autoscaling describe-scaling-policies --service-namespace ecs --resource-id service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service --region {{AWS_REGION}}\"\n      validation:\n        - \"ScalingPolicies contains policy with PolicyName '{{PROJECT_NAME}}-cpu-scaling'\"\n    \n    step_5_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_6_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 3: ALB Request Count Scaling Policy\nalb_scaling_policy:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"ecs-alb-scaling-policy\"\n        Status: \"Pending\"\n        Phase: \"09-ecs-autoscaling\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_create:\n      action: \"aws_cli\"\n      command: |\n        aws application-autoscaling put-scaling-policy \\\n          --service-namespace ecs \\\n          --"
    },
    {
      "source": "phases/30-compute/04-ecs-autoscaling.yaml",
      "text": "resource-id service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service \\\n          --scalable-dimension ecs:service:DesiredCount \\\n          --policy-name {{PROJECT_NAME}}-alb-scaling \\\n          --policy-type TargetTrackingScaling \\\n          --target-tracking-scaling-policy-configuration '{\n            \"TargetValue\": 1000.0,\n            \"PredefinedMetricSpecification\": {\n              \"PredefinedMetricType\": \"ALBRequestCountPerTarget\",\n              \"ResourceLabel\": \"{{alb_resource_label}}\"\n            },\n            \"ScaleInCooldown\": 300,\n            \"ScaleOutCooldown\": 60\n          }' \\\n          --region {{AWS_REGION}}\n    \n    step_3_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n    \n    step_4_verify:\n      action: \"aws_cli\"\n      command: \"aws application-autoscaling describe-scaling-policies --service-namespace ecs --resource-id service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service --region {{AWS_REGION}}\"\n      validation:\n        - \"ScalingPolicies contains policy with PolicyName '{{PROJECT_NAME}}-alb-scaling'\"\n    \n    step_5_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_6_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 4: Memory Scaling Policy\nmemory_scaling_policy:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"ecs-memory-scaling-policy\"\n        Status: \"Pending\"\n        Phase: \"09-ecs-autoscaling\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_create:\n      action: \"aws_cli\"\n      command: |\n        aws application-autoscaling put-scaling-policy \\\n          --service-namespace ecs \\\n          --resource-id service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service \\\n          --scalable-dimension ecs:service:DesiredCount \\\n          --policy-name {{PROJECT_NAME}}-memor"
    },
    {
      "source": "phases/30-compute/04-ecs-autoscaling.yaml",
      "text": "y-scaling \\\n          --policy-type TargetTrackingScaling \\\n          --target-tracking-scaling-policy-configuration '{\n            \"TargetValue\": 80.0,\n            \"PredefinedMetricSpecification\": {\n              \"PredefinedMetricType\": \"ECSServiceAverageMemoryUtilization\"\n            },\n            \"ScaleInCooldown\": 300,\n            \"ScaleOutCooldown\": 60\n          }' \\\n          --region {{AWS_REGION}}\n    \n    step_3_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n    \n    step_4_verify:\n      action: \"aws_cli\"\n      command: \"aws application-autoscaling describe-scaling-policies --service-namespace ecs --resource-id service/{{PROJECT_NAME}}-cluster/{{PROJECT_NAME}}-service --region {{AWS_REGION}}\"\n      validation:\n        - \"ScalingPolicies contains policy with PolicyName '{{PROJECT_NAME}}-memory-scaling'\"\n    \n    step_5_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_6_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n"
    },
    {
      "source": "phases/30-compute/05-alb.yaml",
      "text": "# PHASE 10: APPLICATION LOAD BALANCER (3 recursos)\n# Depend\u00eancias: VPC, Subnets, Security Groups (Phase 03)\n# Custo: $30/m\u00eas\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"10-alb\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 3\n\n# RECURSO 1: Target Group\ntarget_group:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-tg\"\n        Status: \"Pending\"\n        Phase: \"10-alb\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::ElasticLoadBalancingV2::TargetGroup\"\n      properties:\n        Name: \"{{PROJECT_NAME}}-tg\"\n        Port: 8080\n        Protocol: \"HTTP\"\n        VpcId: \"{{vpc_id}}\"\n        TargetType: \"ip\"\n        HealthCheckEnabled: true\n        HealthCheckPath: \"/actuator/health/readiness\"\n        HealthCheckProtocol: \"HTTP\"\n        HealthCheckIntervalSeconds: 30\n        HealthCheckTimeoutSeconds: 5\n        HealthyThresholdCount: 2\n        UnhealthyThresholdCount: 3\n        Matcher:\n          HttpCode: \"200\"\n        TargetGroupAttributes:\n          - Key: \"deregistration_delay.timeout_seconds\"\n            Value: \"30\"\n          - Key: \"stickiness.enabled\"\n            Value: \"true\"\n          - Key: \"stickiness.type\"\n            Value: \"lb_cookie\"\n          - Key: \"stickiness.lb_cookie.duration_seconds\"\n            Value: \"86400\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{target_group_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws elbv2 describe-target-groups --names {{PROJEC"
    },
    {
      "source": "phases/30-compute/05-alb.yaml",
      "text": "T_NAME}}-tg --region {{AWS_REGION}}\"\n      validation:\n        - \"TargetGroups[0].TargetGroupName == '{{PROJECT_NAME}}-tg'\"\n        - \"TargetGroups[0].HealthCheckPath == '/actuator/health/readiness'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 2: Application Load Balancer\nalb:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-alb\"\n        Status: \"Pending\"\n        Phase: \"10-alb\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::ElasticLoadBalancingV2::LoadBalancer\"\n      properties:\n        Name: \"{{PROJECT_NAME}}-alb\"\n        Type: \"application\"\n        Scheme: \"internet-facing\"\n        IpAddressType: \"ipv4\"\n        Subnets:\n          - \"{{public_subnet_1a_id}}\"\n          - \"{{public_subnet_1b_id}}\"\n          - \"{{public_subnet_1c_id}}\"\n        SecurityGroups:\n          - \"{{sg_alb_cloudfront_only_id}}\"\n        LoadBalancerAttributes:\n          - Key: \"deletion_protection.enabled\"\n            Value: \"false\"\n          - Key: \"idle_timeout.timeout_seconds\"\n            Value: \"60\"\n          - Key: \"access_logs.s3.enabled\"\n            Value: \"false\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{alb_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws elbv2 describe-load-balancers --names {{PROJECT_NAME}}-alb --region {{AWS_REGION}}\"\n      validat"
    },
    {
      "source": "phases/30-compute/05-alb.yaml",
      "text": "ion:\n        - \"LoadBalancers[0].LoadBalancerName == '{{PROJECT_NAME}}-alb'\"\n        - \"LoadBalancers[0].State.Code == 'active'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n# RECURSO 3: ALB Listener with Header Validation\nalb_listener:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-alb-listener\"\n        Status: \"Pending\"\n        Phase: \"10-alb\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_generate:\n      action: \"generate_infrastructure_code\"\n      resource_type: \"AWS::ElasticLoadBalancingV2::Listener\"\n      properties:\n        LoadBalancerArn: \"{{alb_arn}}\"\n        Port: 80\n        Protocol: \"HTTP\"\n        DefaultActions:\n          - Type: \"fixed-response\"\n            FixedResponseConfig:\n              StatusCode: \"403\"\n              ContentType: \"text/plain\"\n              MessageBody: \"Access denied - invalid origin\"\n        Rules:\n          - Priority: 1\n            Conditions:\n              - Field: \"http-header\"\n                HttpHeaderConfig:\n                  HttpHeaderName: \"X-Origin-Verify\"\n                  Values:\n                    - \"{{cloudfront_secret_header}}\"\n            Actions:\n              - Type: \"forward\"\n                TargetGroupArn: \"{{target_group_arn}}\"\n        Tags:\n          - Key: \"Project\"\n            Value: \"{{PROJECT_NAME}}\"\n          - Key: \"ManagedBy\"\n            Value: \"MCP\"\n    \n    step_3_explain:\n      action: \"explain\"\n    \n    step_4_create:\n      action: \"create_resource\"\n    \n    step_5_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{listener_arn}}\"\n    \n    step_6_verify:\n      action: \"aws_cli\"\n      command: \"aws elbv2 describe-listeners --load-bala"
    },
    {
      "source": "phases/30-compute/05-alb.yaml",
      "text": "ncer-arn {{alb_arn}} --region {{AWS_REGION}}\"\n      validation:\n        - \"Listeners[0].Port == 80\"\n        - \"Listeners[0].Protocol == 'HTTP'\"\n    \n    step_7_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_8_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n\n  defense_in_depth:\n    note: \"ALB listener validates X-Origin-Verify header from CloudFront\"\n    layers:\n      - \"Layer 1: CloudFront adds custom header X-Origin-Verify\"\n      - \"Layer 2: ALB listener rule validates header value\"\n      - \"Layer 3: Security Group allows only CloudFront prefix list\"\n"
    },
    {
      "source": "phases/30-compute/domain-metadata.yaml",
      "text": "domain:\n  name: \"compute\"\n  description: \"Compute infrastructure - ECS, ECR, ALB, auto-scaling\"\n  dependencies: [\"foundation\", \"security\", \"network\"]\n  parallel_safe: true\n  estimated_duration: \"35min\"\n  team_owner: \"platform-team\"\n  risk_level: \"medium\"\n  phases:\n    - \"01-ecr.yaml\"\n    - \"02-ecs-cluster.yaml\"\n    - \"03-ecs-task-service.yaml\"\n    - \"04-ecs-autoscaling.yaml\"\n    - \"05-alb.yaml\"\n  execution_order: \"mixed\"\n  priority: 4\n"
    },
    {
      "source": "phases/40-data/01-redis.yaml",
      "text": "# PHASE 11: ELASTICACHE REDIS SERVERLESS (1 recurso)\n# Depend\u00eancias: VPC, Subnets, Security Groups, KMS (Phases 01, 03)\n# Custo: $95/m\u00eas (1-5GB storage, multi-AZ)\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"11-redis\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 1\n\n# RECURSO 1: ElastiCache Redis Serverless\nredis_serverless:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"{{PROJECT_NAME}}-serverless-cache\"\n        Status: \"Pending\"\n        Phase: \"11-redis\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_create:\n      action: \"aws_cli\"\n      command: |\n        aws elasticache create-serverless-cache \\\n          --serverless-cache-name {{PROJECT_NAME}}-serverless-cache \\\n          --engine redis \\\n          --major-engine-version 7 \\\n          --cache-usage-limits DataStorage={Maximum=5,Minimum=1,Unit=GB},ECPUPerSecond={Maximum=5000,Minimum=1000} \\\n          --security-group-ids {{sg_redis_id}} \\\n          --subnet-ids {{private_subnet_1a_id}} {{private_subnet_1b_id}} {{private_subnet_1c_id}} \\\n          --kms-key-id alias/poc-encryption-key \\\n          --snapshot-retention-limit 7 \\\n          --daily-snapshot-time \"03:00-05:00\" \\\n          --tags Key=Project,Value={{PROJECT_NAME}} Key=ManagedBy,Value=MCP \\\n          --region {{AWS_REGION}}\n    \n    step_3_update_created:\n      action: \"update_dynamodb\"\n      status: \"Created\"\n      arn: \"{{redis_arn}}\"\n    \n    step_4_verify:\n      action: \"aws_cli\"\n      command: \"aws elasticache describe-serverless-caches --serverless-cache-name {{PROJECT_NAME}}-serverless-cache --region {{AWS_REGION}}\"\n      validation:\n        - \"ServerlessCaches[0].ServerlessCacheName == '{{PROJECT_NAME}}-serverless-cache'\"\n        - \"ServerlessCaches[0].Status == 'available'\"\n        - \"ServerlessCaches[0].Engine == 'redis'\"\n    \n    step_5_update_verified:\n "
    },
    {
      "source": "phases/40-data/01-redis.yaml",
      "text": "     action: \"update_dynamodb\"\n      status: \"Verified\"\n    \n    step_6_on_error:\n      action: \"update_dynamodb\"\n      status: \"Failed\"\n      error_message: \"{{error_details}}\"\n\n  post_creation:\n    note: \"Update Parameter Store with Redis endpoint after creation\"\n    commands:\n      - \"aws ssm put-parameter --name /{{PROJECT_NAME}}/redis/endpoint --value {{redis_endpoint}} --type SecureString --key-id alias/poc-encryption-key --overwrite --region {{AWS_REGION}}\"\n      - \"aws ssm put-parameter --name /{{PROJECT_NAME}}/redis/port --value 6379 --type SecureString --key-id alias/poc-encryption-key --overwrite --region {{AWS_REGION}}\"\n      - \"aws ssm put-parameter --name /{{PROJECT_NAME}}/redis/ssl --value true --type SecureString --key-id alias/poc-encryption-key --overwrite --region {{AWS_REGION}}\"\n"
    },
    {
      "source": "phases/40-data/02-aurora-postgresql.yaml",
      "text": "phase: \"11b-aurora-postgresql\"\ndescription: \"Aurora PostgreSQL Serverless v2 - Banco relacional sob demanda (POC)\"\ndepends_on: [\"03-networking\", \"01-kms-security\"]\nestimated_cost_monthly: 35\nresource_count: 0  # Migrated to 11b-aurora-postgresql-secure.yaml\n\n# BANCO RELACIONAL OPCIONAL - Preparado para uso futuro\n# Configura\u00e7\u00e3o otimizada para POC com custo m\u00ednimo\n\nresources:\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 1. DB SUBNET GROUP\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  db_subnet_group:\n    name: \"{{PROJECT_NAME}}-db-subnet-group\"\n    resource_name: \"11b-db-subnet-group\"\n    type: \"AWS::RDS::DBSubnetGroup\"\n    priority: 1\n    \n    mcp_workflow:\n      generate_code:\n        tool: \"generate_infrastructure_code\"\n        parameters:\n          resource_type: \"AWS::RDS::DBSubnetGroup\"\n          region: \"{{AWS_REGION}}\"\n          properties:\n            DBSubnetGroupName: \"{{PROJECT_NAME}}-db-subnet-group\"\n            DBSubnetGroupDescription: \"Subnet group for {{PROJECT_NAME}} Aurora PostgreSQL\"\n            SubnetIds:\n              - \"[PRIVATE_SUBNET_1A_ID]\"\n              - \"[PRIVATE_SUBNET_1B_ID]\"\n              - \"[PRIVATE_SUBNET_1C_ID]\"\n            Tags:\n              - Key: \"Name\"\n                Value: \"{{PROJECT_NAME}}-db-subnet-group\"\n              - Key: \"Project\"\n                Value: \"{{PROJECT_NAME}}\"\n              - Key: \"ManagedBy\"\n                Value: \"IaL\"\n    \n    verification: |\n      aws rds describe-db-subnet-groups \\\n        --db-subnet-group-name {{PROJECT_NAME}}-db-subnet-group \\\n        --query 'DBSubnetGroups[0].{Name:DBSubnetGroupName,Status:SubnetGroupStatus,Subnets:length(Subnets)}' \\\n        --region {{AWS_REGION}}\n\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 2. SECURITY GROUP - DATABASE\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  sg_database:\n    name: \"{{PROJECT"
    },
    {
      "source": "phases/40-data/02-aurora-postgresql.yaml",
      "text": "_NAME}}-sg-db\"\n    resource_name: \"11b-sg-db\"\n    type: \"AWS::EC2::SecurityGroup\"\n    priority: 2\n    \n    mcp_workflow:\n      generate_code:\n        tool: \"generate_infrastructure_code\"\n        parameters:\n          resource_type: \"AWS::EC2::SecurityGroup\"\n          region: \"{{AWS_REGION}}\"\n          properties:\n            GroupName: \"{{PROJECT_NAME}}-sg-db\"\n            GroupDescription: \"Security group for Aurora PostgreSQL - Access from ECS only\"\n            VpcId: \"[VPC_ID]\"\n            SecurityGroupIngress:\n              - IpProtocol: \"tcp\"\n                FromPort: 5432\n                ToPort: 5432\n                SourceSecurityGroupId: \"[SG_APP_ID]\"\n                Description: \"PostgreSQL from ECS tasks\"\n            Tags:\n              - Key: \"Name\"\n                Value: \"{{PROJECT_NAME}}-sg-db\"\n              - Key: \"Project\"\n                Value: \"{{PROJECT_NAME}}\"\n              - Key: \"ManagedBy\"\n                Value: \"IaL\"\n    \n    verification: |\n      aws ec2 describe-security-groups \\\n        --filters \"Name=group-name,Values={{PROJECT_NAME}}-sg-db\" \\\n        --query 'SecurityGroups[0].{GroupId:GroupId,VpcId:VpcId,Rules:length(IpPermissions)}' \\\n        --region {{AWS_REGION}}\n\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  # 3. AURORA POSTGRESQL SERVERLESS V2 CLUSTER\n  # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  aurora_cluster:\n    name: \"{{PROJECT_NAME}}-aurora-cluster\"\n    resource_name: \"11b-aurora-cluster\"\n    type: \"AWS::RDS::DBCluster\"\n    priority: 3\n    \n    mcp_workflow:\n      generate_code:\n        tool: \"generate_infrastructure_code\"\n        parameters:\n          resource_type: \"AWS::RDS::DBCluster\"\n          region: \"{{AWS_REGION}}\"\n          properties:\n            DBClusterIdentifier: \"{{PROJECT_NAME}}-aurora-cluster\"\n            Engine: \"aurora-postgresql\"\n            EngineMode: \"provisioned\"\n            EngineVersion: \"15.4\"\n            DatabaseName: \"a"
    },
    {
      "source": "phases/40-data/02-aurora-postgresql.yaml",
      "text": "ppdb\"\n            MasterUsername: \"dbadmin\"\n            MasterUserPassword: \"CHANGE_ME_AFTER_CREATION\"  # \u26a0\ufe0f Alterar via console ap\u00f3s cria\u00e7\u00e3o\n            DBSubnetGroupName: \"{{PROJECT_NAME}}-db-subnet-group\"\n            VpcSecurityGroupIds:\n              - \"[SG_DB_ID]\"\n            StorageEncrypted: true\n            KmsKeyId: \"[KMS_KEY_ARN]\"\n            BackupRetentionPeriod: 1\n            PreferredBackupWindow: \"03:00-04:00\"\n            PreferredMaintenanceWindow: \"sun:04:00-sun:05:00\"\n            EnableCloudwatchLogsExports:\n              - \"postgresql\"\n            DeletionProtection: false\n            ServerlessV2ScalingConfiguration:\n              MinCapacity: 0.5\n              MaxCapacity: 1.0\n            Tags:\n              - Key: \"Name\"\n                Value: \"{{PROJECT_NAME}}-aurora-cluster\"\n              - Key: \"Project\"\n                Value: \"{{PROJECT_NAME}}\"\n              - Key: \"ManagedBy\"\n                Value: \"IaL\"\n              - Key: \"Environment\"\n                Value: \"POC\"\n    \n    verification: |\n      aws rds describe-db-clusters \\\n        --db-cluster-identifier {{PROJECT_NAME}}-aurora-cluster \\\n        --query 'DBClusters[0].{Status:Status,Engine:Engine,Endpoint:Endpoint,MinCapacity:ServerlessV2ScalingConfiguration.MinCapacity,MaxCapacity:ServerlessV2ScalingConfiguration.MaxCapacity}' \\\n        --region {{AWS_REGION}}\n    \n    note: |\n      \u26a0\ufe0f IMPORTANTE:\n      1. Alterar senha do MasterUserPassword via console ap\u00f3s cria\u00e7\u00e3o\n      2. Armazenar credenciais no Parameter Store (SecureString)\n      3. Cluster leva ~5-10 minutos para ficar dispon\u00edvel\n      4. Custo m\u00ednimo: 0.5 ACU = ~$35/m\u00eas (24/7)\n      5. Para economizar: pausar cluster quando n\u00e3o estiver em uso\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# CONFIGURA\u00c7\u00c3O P\u00d3S-CRIA\u00c7\u00c3O\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\npost_creation_steps:\n  step1_get_endpoint:\n    description: \"Obter endpoint do Aurora\"\n    comm"
    },
    {
      "source": "phases/40-data/02-aurora-postgresql.yaml",
      "text": "and: |\n      aws rds describe-db-clusters \\\n        --db-cluster-identifier {{PROJECT_NAME}}-aurora-cluster \\\n        --query 'DBClusters[0].Endpoint' \\\n        --output text \\\n        --region {{AWS_REGION}}\n  \n  step2_store_credentials:\n    description: \"Armazenar credenciais no Parameter Store\"\n    commands:\n      - name: \"DB Endpoint\"\n        command: |\n          aws ssm put-parameter \\\n            --name \"/{{PROJECT_NAME}}/db/endpoint\" \\\n            --value \"[AURORA_ENDPOINT]\" \\\n            --type \"SecureString\" \\\n            --kms-key-id \"[KMS_KEY_ID]\" \\\n            --description \"Aurora PostgreSQL endpoint\" \\\n            --tags Key=Project,Value={{PROJECT_NAME}} \\\n            --region {{AWS_REGION}}\n      \n      - name: \"DB Port\"\n        command: |\n          aws ssm put-parameter \\\n            --name \"/{{PROJECT_NAME}}/db/port\" \\\n            --value \"5432\" \\\n            --type \"String\" \\\n            --description \"Aurora PostgreSQL port\" \\\n            --tags Key=Project,Value={{PROJECT_NAME}} \\\n            --region {{AWS_REGION}}\n      \n      - name: \"DB Name\"\n        command: |\n          aws ssm put-parameter \\\n            --name \"/{{PROJECT_NAME}}/db/name\" \\\n            --value \"appdb\" \\\n            --type \"String\" \\\n            --description \"Aurora PostgreSQL database name\" \\\n            --tags Key=Project,Value={{PROJECT_NAME}} \\\n            --region {{AWS_REGION}}\n      \n      - name: \"DB Username\"\n        command: |\n          aws ssm put-parameter \\\n            --name \"/{{PROJECT_NAME}}/db/username\" \\\n            --value \"dbadmin\" \\\n            --type \"SecureString\" \\\n            --kms-key-id \"[KMS_KEY_ID]\" \\\n            --description \"Aurora PostgreSQL username\" \\\n            --tags Key=Project,Value={{PROJECT_NAME}} \\\n            --region {{AWS_REGION}}\n      \n      - name: \"DB Password\"\n        command: |\n          aws ssm put-parameter \\\n            --name \"/{{PROJECT_NAME}}/db/password\" \\\n            --value \"[NEW_SECURE_PASSWORD]\" \\\n            -"
    },
    {
      "source": "phases/40-data/02-aurora-postgresql.yaml",
      "text": "-type \"SecureString\" \\\n            --kms-key-id \"[KMS_KEY_ID]\" \\\n            --description \"Aurora PostgreSQL password\" \\\n            --tags Key=Project,Value={{PROJECT_NAME}} \\\n            --region {{AWS_REGION}}\n  \n  step3_update_ecs_task:\n    description: \"Adicionar vari\u00e1veis de ambiente no ECS Task Definition (futuro)\"\n    note: |\n      Quando conectar a aplica\u00e7\u00e3o ao banco, adicionar estas vari\u00e1veis:\n      - DB_ENDPOINT: valueFrom /{{PROJECT_NAME}}/db/endpoint\n      - DB_PORT: valueFrom /{{PROJECT_NAME}}/db/port\n      - DB_NAME: valueFrom /{{PROJECT_NAME}}/db/name\n      - DB_USERNAME: valueFrom /{{PROJECT_NAME}}/db/username\n      - DB_PASSWORD: valueFrom /{{PROJECT_NAME}}/db/password\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# VALIDA\u00c7\u00d5ES\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nvalidation:\n  checks:\n    - name: \"Verificar cluster dispon\u00edvel\"\n      command: |\n        aws rds describe-db-clusters \\\n          --db-cluster-identifier {{PROJECT_NAME}}-aurora-cluster \\\n          --query 'DBClusters[0].Status' \\\n          --output text \\\n          --region {{AWS_REGION}}\n      expected: \"available\"\n    \n    - name: \"Verificar encryption habilitado\"\n      command: |\n        aws rds describe-db-clusters \\\n          --db-cluster-identifier {{PROJECT_NAME}}-aurora-cluster \\\n          --query 'DBClusters[0].StorageEncrypted' \\\n          --output text \\\n          --region {{AWS_REGION}}\n      expected: \"True\"\n    \n    - name: \"Verificar Serverless v2 configurado\"\n      command: |\n        aws rds describe-db-clusters \\\n          --db-cluster-identifier {{PROJECT_NAME}}-aurora-cluster \\\n          --query 'DBClusters[0].ServerlessV2ScalingConfiguration' \\\n          --region {{AWS_REGION}}\n      expected: \"MinCapacity: 0.5, MaxCapacity: 1.0\"\n    \n    - name: \"Verificar Security Group permite acesso de ECS\"\n      command: |\n        aws ec2 describe-security-groups \\\n          --filters \"Name=group-"
    },
    {
      "source": "phases/40-data/02-aurora-postgresql.yaml",
      "text": "name,Values={{PROJECT_NAME}}-sg-db\" \\\n          --query 'SecurityGroups[0].IpPermissions[?FromPort==`5432`]' \\\n          --region {{AWS_REGION}}\n      expected: \"Ingress na porta 5432 de sg-app\"\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# CONEX\u00c3O DE TESTE\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nconnection_test:\n  description: \"Testar conex\u00e3o ao Aurora PostgreSQL\"\n  from_ecs_task:\n    command: |\n      # Dentro do container ECS\n      psql -h [AURORA_ENDPOINT] -U dbadmin -d appdb -p 5432\n    \n    expected: \"Conex\u00e3o bem-sucedida\"\n  \n  connection_string_examples:\n    jdbc: \"jdbc:postgresql://[AURORA_ENDPOINT]:5432/appdb\"\n    spring_boot: |\n      spring.datasource.url=jdbc:postgresql://${DB_ENDPOINT}:${DB_PORT}/${DB_NAME}\n      spring.datasource.username=${DB_USERNAME}\n      spring.datasource.password=${DB_PASSWORD}\n      spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# NOTAS E CUSTOS\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nnotes:\n  - \"Aurora Serverless v2 com 0.5 ACU m\u00ednimo = ~$35/m\u00eas (24/7)\"\n  - \"Cluster pode ser pausado manualmente para economizar custos\"\n  - \"Backup retention de 1 dia (m\u00ednimo para POC)\"\n  - \"Sem Multi-AZ para reduzir custos (POC)\"\n  - \"Performance Insights desabilitado (economia)\"\n  - \"Enhanced Monitoring desabilitado (economia)\"\n  - \"Encryption at rest com KMS habilitado\"\n  - \"CloudWatch Logs habilitado para PostgreSQL\"\n  - \"Acesso restrito apenas de ECS tasks (sg-app)\"\n  - \"Subnets privadas (sem acesso direto da internet)\"\n\ncost_breakdown:\n  aurora_serverless_v2_min: 35  # 0.5 ACU * 730h * $0.096/ACU-hour\n  storage_gb: 1  # $0.10/GB-month (m\u00ednimo 1GB)\n  backup_storage: 0  # Dentro do free tier (1 dia)\n  data_transfer: 0  # Interno VPC\n  total_monthly: 36\n\noptimization_tips:\n  - \"Pausar cluster quando n\u00e3o estiver em uso (e"
    },
    {
      "source": "phases/40-data/02-aurora-postgresql.yaml",
      "text": "conomia de 100%)\"\n  - \"Monitorar ACU usage e ajustar MaxCapacity se necess\u00e1rio\"\n  - \"Considerar Aurora Serverless v1 se workload for muito intermitente\"\n  - \"Usar connection pooling na aplica\u00e7\u00e3o para reduzir conex\u00f5es\"\n  - \"Avaliar migra\u00e7\u00e3o para RDS PostgreSQL se uso for constante\"\n\nsecurity_best_practices:\n  - \"\u2705 Encryption at rest com KMS\"\n  - \"\u2705 Subnets privadas (sem internet)\"\n  - \"\u2705 Security Group restrito (apenas ECS)\"\n  - \"\u2705 Credenciais no Parameter Store (SecureString)\"\n  - \"\u26a0\ufe0f Alterar senha padr\u00e3o ap\u00f3s cria\u00e7\u00e3o\"\n  - \"\u26a0\ufe0f Habilitar IAM Database Authentication (futuro)\"\n  - \"\u26a0\ufe0f Configurar rotation de senha (Secrets Manager)\"\n"
    },
    {
      "source": "phases/40-data/03-aurora-postgresql-secure.yaml",
      "text": "phase_name: \"Aurora PostgreSQL - Secure with Secrets Manager\"\ndescription: \"Aurora PostgreSQL cluster with Secrets Manager integration and proper IAM roles\"\nresource_count: 4\n\nResources:\n  # Aurora PostgreSQL Cluster with Secrets Manager\n  AuroraCluster:\n    Type: AWS::RDS::DBCluster\n    Properties:\n      DBClusterIdentifier: !Sub '${ProjectName}-aurora-cluster'\n      Engine: aurora-postgresql\n      EngineVersion: '15.4'\n      EngineMode: provisioned\n      \n      # Secrets Manager Integration (Secure)\n      ManageMasterUserPassword: true\n      MasterUserSecret:\n        SecretArn: !ImportValue \n          Fn::Sub: '${ProjectName}-aurora-secret-arn'\n        KmsKeyId: alias/aws/secretsmanager\n      MasterUsername: postgres\n      \n      # Associate IAM role for Secrets Manager access\n      AssociatedRoles:\n        - RoleArn: !ImportValue\n            Fn::Sub: '${ProjectName}-aurora-secrets-role-arn'\n          FeatureName: 's3Import'  # Required parameter, using s3Import as placeholder\n      \n      # Network Configuration\n      DBSubnetGroupName: !Ref AuroraSubnetGroup\n      VpcSecurityGroupIds:\n        - !Ref AuroraSecurityGroup\n      \n      # Backup and Maintenance\n      BackupRetentionPeriod: 7\n      PreferredBackupWindow: '03:00-04:00'\n      PreferredMaintenanceWindow: 'sun:04:00-sun:05:00'\n      \n      # Performance and Monitoring\n      EnableCloudwatchLogsExports:\n        - postgresql\n      MonitoringInterval: 60\n      MonitoringRoleArn: !GetAtt AuroraMonitoringRole.Arn\n      \n      # Security\n      StorageEncrypted: true\n      KmsKeyId: alias/aws/rds\n      DeletionProtection: true\n      \n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Purpose\n          Value: ConversationStorage\n        - Key: Security\n          Value: SecretsManager\n\n  # Aurora DB Instance\n  AuroraInstance:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      DBInstanceIdentifier: !Sub '${ProjectName}-aurora-instance-1'\n      DBClusterIdentifier: !Ref AuroraClust"
    },
    {
      "source": "phases/40-data/03-aurora-postgresql-secure.yaml",
      "text": "er\n      DBInstanceClass: db.r6g.large\n      Engine: aurora-postgresql\n      PubliclyAccessible: false\n      \n      # Performance Insights\n      EnablePerformanceInsights: true\n      PerformanceInsightsRetentionPeriod: 7\n      \n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n\n  # Subnet Group for Aurora\n  AuroraSubnetGroup:\n    Type: AWS::RDS::DBSubnetGroup\n    Properties:\n      DBSubnetGroupName: !Sub '${ProjectName}-aurora-subnet-group'\n      DBSubnetGroupDescription: 'Subnet group for Aurora PostgreSQL cluster'\n      SubnetIds:\n        - !ImportValue \n          Fn::Sub: '${ProjectName}-private-subnet-1'\n        - !ImportValue \n          Fn::Sub: '${ProjectName}-private-subnet-2'\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n\n  # Security Group for Aurora\n  AuroraSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupName: !Sub '${ProjectName}-aurora-sg'\n      GroupDescription: 'Security group for Aurora PostgreSQL cluster'\n      VpcId: !ImportValue \n        Fn::Sub: '${ProjectName}-vpc-id'\n      SecurityGroupIngress:\n        - IpProtocol: tcp\n          FromPort: 5432\n          ToPort: 5432\n          SourceSecurityGroupId: !ImportValue \n            Fn::Sub: '${ProjectName}-lambda-sg'\n          Description: 'PostgreSQL access from Lambda functions'\n        - IpProtocol: tcp\n          FromPort: 5432\n          ToPort: 5432\n          SourceSecurityGroupId: !ImportValue \n            Fn::Sub: '${ProjectName}-ecs-sg'\n          Description: 'PostgreSQL access from ECS services'\n      SecurityGroupEgress:\n        - IpProtocol: tcp\n          FromPort: 443\n          ToPort: 443\n          CidrIp: 0.0.0.0/0\n          Description: 'HTTPS outbound for Secrets Manager API calls'\n      Tags:\n        - Key: Project\n          Value: !Ref ProjectName\n\n  # IAM Role for Enhanced Monitoring\n  AuroraMonitoringRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-aurora-monitoring-role'\n      As"
    },
    {
      "source": "phases/40-data/03-aurora-postgresql-secure.yaml",
      "text": "sumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: monitoring.rds.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AmazonRDSEnhancedMonitoringRole\n\n# Outputs\nOutputs:\n  AuroraClusterEndpoint:\n    Description: 'Aurora cluster endpoint'\n    Value: !GetAtt AuroraCluster.Endpoint.Address\n    Export:\n      Name: !Sub '${ProjectName}-aurora-endpoint'\n\n  AuroraClusterPort:\n    Description: 'Aurora cluster port'\n    Value: !GetAtt AuroraCluster.Endpoint.Port\n    Export:\n      Name: !Sub '${ProjectName}-aurora-port'\n\n  AuroraSecretArn:\n    Description: 'ARN of Aurora master secret (managed by Aurora)'\n    Value: !GetAtt AuroraCluster.MasterUserSecret.SecretArn\n    Export:\n      Name: !Sub '${ProjectName}-aurora-cluster-secret-arn'\n\n  AuroraSecurityGroupId:\n    Description: 'Security Group ID for Aurora cluster'\n    Value: !Ref AuroraSecurityGroup\n    Export:\n      Name: !Sub '${ProjectName}-aurora-sg-id'\n\n  DatabaseName:\n    Description: 'Default database name'\n    Value: 'ial_conversations'\n    Export:\n      Name: !Sub '${ProjectName}-database-name'\n\n# Connection helper for applications\nconnection_info:\n  endpoint: !GetAtt AuroraCluster.Endpoint.Address\n  port: !GetAtt AuroraCluster.Endpoint.Port\n  database: 'ial_conversations'\n  secret_arn: !GetAtt AuroraCluster.MasterUserSecret.SecretArn\n  \n# Cost estimation\nmetadata:\n  estimated_monthly_cost: '$180-250'\n  cost_breakdown:\n    aurora_instance: '$150-200'\n    storage: '$20-30'\n    backup: '$5-10'\n    monitoring: '$5-10'\n    secrets_manager: '$0.46'\n\n# Parameters\nparameters:\n  ProjectName:\n    Type: String\n    Default: ial\n"
    },
    {
      "source": "phases/40-data/domain-metadata.yaml",
      "text": "domain:\n  name: \"data\"\n  description: \"Data storage and databases - RDS, DynamoDB, Redis, S3\"\n  dependencies: [\"foundation\", \"security\", \"network\"]\n  parallel_safe: true\n  estimated_duration: \"40min\"\n  team_owner: \"data-team\"\n  risk_level: \"high\"\n  phases:\n    - \"01-redis.yaml\"\n    - \"02-aurora-postgresql.yaml\"\n    - \"03-aurora-postgresql-secure.yaml\"\n    - \"04-dynamodb-tables.yaml\"\n    - \"05-s3-storage.yaml\"\n  execution_order: \"parallel\"\n  priority: 4\n"
    },
    {
      "source": "phases/50-application/03-sns-topics.yaml",
      "text": "phase_name: Universal Sns Resources\ndescription: Auto-generated phase for sns resources\nresource_count: 1\nResources:\n  UniversalIalalertscritical:\n    Type: AWS::SNS::Topic\n    Properties:\n      TopicName: ial-alerts-critical\n    Metadata:\n      CreatedVia: universal-tracker\n      Service: sns\n      Operation: create-topic\n      Timestamp: '2025-10-23T22:36:29.501323'\n      OriginalName: ial-alerts-critical\n"
    },
    {
      "source": "phases/50-application/04-parameter-store.yaml",
      "text": "phase: \"04-parameter-store\"\ndescription: \"Parameter Store with KMS encryption for Redis configuration\"\ndepends_on: [\"01-kms-security\"]\nestimated_cost_monthly: 0\nresource_count: 3\n\nresources:\n  - name: \"redis-endpoint\"\n    resource_name: \"04-param-redis-endpoint\"\n    type: \"AWS::SSM::Parameter\"\n    dynamodb_tracking: true\n    properties:\n      Name: \"/{{PROJECT_NAME}}/redis/endpoint\"\n      Type: \"String\"\n      Value: \"DYNAMIC_FROM_ELASTICACHE\"\n      Description: \"Redis Serverless endpoint\"\n      KmsKeyId: \"[KMS_KEY_ARN]\"\n    verification: \"aws ssm get-parameter --name '/{{PROJECT_NAME}}/redis/endpoint' --query 'Parameter.Name'\"\n\n  - name: \"redis-port\"\n    resource_name: \"04-param-redis-port\"\n    type: \"AWS::SSM::Parameter\"\n    dynamodb_tracking: true\n    properties:\n      Name: \"/{{PROJECT_NAME}}/redis/port\"\n      Type: \"String\"\n      Value: \"6379\"\n      Description: \"Redis port\"\n      KmsKeyId: \"[KMS_KEY_ARN]\"\n    verification: \"aws ssm get-parameter --name '/{{PROJECT_NAME}}/redis/port' --query 'Parameter.Name'\"\n\n  - name: \"redis-ssl\"\n    resource_name: \"04-param-redis-ssl\"\n    type: \"AWS::SSM::Parameter\"\n    dynamodb_tracking: true\n    properties:\n      Name: \"/{{PROJECT_NAME}}/redis/ssl\"\n      Type: \"String\"\n      Value: \"true\"\n      Description: \"Redis SSL enabled\"\n      KmsKeyId: \"[KMS_KEY_ARN]\"\n    verification: \"aws ssm get-parameter --name '/{{PROJECT_NAME}}/redis/ssl' --query 'Parameter.Name'\"\n\noutputs:\n  parameter_paths: [\"/{{PROJECT_NAME}}/redis/endpoint\", \"/{{PROJECT_NAME}}/redis/port\", \"/{{PROJECT_NAME}}/redis/ssl\"]\n"
    },
    {
      "source": "phases/50-application/domain-metadata.yaml",
      "text": "domain:\n  name: \"application\"\n  description: \"Application services - Lambda, Step Functions, SNS, Parameter Store\"\n  dependencies: [\"foundation\", \"security\", \"network\", \"compute\", \"data\"]\n  parallel_safe: true\n  estimated_duration: \"25min\"\n  team_owner: \"application-team\"\n  risk_level: \"medium\"\n  phases:\n    - \"01-lambda-functions.yaml\"\n    - \"02-step-functions.yaml\"\n    - \"03-sns-topics.yaml\"\n    - \"04-parameter-store.yaml\"\n  execution_order: \"parallel\"\n  priority: 5\n"
    },
    {
      "source": "phases/60-observability/01-project-observability.yaml",
      "text": "# PHASE 60A: PROJECT OBSERVABILITY\n# Observabilidade espec\u00edfica do projeto/workload (n\u00e3o do core IAL)\n# Depend\u00eancias: foundation, compute, data, application\n# Custo: $25/m\u00eas\n\nphase: \"60a-project-observability\"\ndescription: \"Project-specific observability and monitoring\"\ndepends_on: [\"30-compute\", \"40-data\", \"50-application\"]\nestimated_cost_monthly: 25.00\nresource_count: 6\n\nresources:\n  # Project-specific CloudWatch Dashboard\n  ProjectObservabilityDashboard:\n    Type: AWS::CloudWatch::Dashboard\n    Properties:\n      DashboardName: !Sub \"${AWS::StackName}-Project-Observability\"\n      DashboardBody: !Sub |\n        {\n          \"widgets\": [\n            {\n              \"type\": \"metric\",\n              \"x\": 0,\n              \"y\": 0,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [ \"AWS/ECS\", \"CPUUtilization\", \"ServiceName\", \"${AWS::StackName}-service\" ],\n                  [ \".\", \"MemoryUtilization\", \".\", \".\" ]\n                ],\n                \"view\": \"timeSeries\",\n                \"stacked\": false,\n                \"region\": \"us-east-1\",\n                \"stat\": \"Average\",\n                \"period\": 300,\n                \"title\": \"ECS Service Metrics\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 12,\n              \"y\": 0,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [ \"AWS/ApplicationELB\", \"RequestCount\", \"LoadBalancer\", \"${AWS::StackName}-alb\" ],\n                  [ \".\", \"TargetResponseTime\", \".\", \".\" ]\n                ],\n                \"view\": \"timeSeries\",\n                \"stacked\": false,\n                \"region\": \"us-east-1\",\n                \"stat\": \"Sum\",\n                \"period\": 300,\n                \"title\": \"ALB Metrics\"\n              }\n            }\n          ]\n        }\n      Tags:\n        - Key: Project\n          Value: !Ref AWS::StackName\n        -"
    },
    {
      "source": "phases/60-observability/01-project-observability.yaml",
      "text": " Key: Purpose\n          Value: project-observability\n\n  # Project Critical Alerts SNS Topic\n  ProjectCriticalAlertsTopic:\n    Type: AWS::SNS::Topic\n    Properties:\n      TopicName: !Sub \"${AWS::StackName}-critical-alerts\"\n      DisplayName: !Sub \"${AWS::StackName} Critical Alerts\"\n      Tags:\n        - Key: Project\n          Value: !Ref AWS::StackName\n        - Key: Purpose\n          Value: project-alerting\n\n  # High CPU Utilization Alarm\n  ProjectHighCPUAlarm:\n    Type: AWS::CloudWatch::Alarm\n    Properties:\n      AlarmName: !Sub \"${AWS::StackName}-High-CPU-Utilization\"\n      AlarmDescription: Alert when ECS service CPU utilization is high\n      MetricName: CPUUtilization\n      Namespace: AWS/ECS\n      Dimensions:\n        - Name: ServiceName\n          Value: !Sub \"${AWS::StackName}-service\"\n      Statistic: Average\n      Period: 300\n      EvaluationPeriods: 2\n      Threshold: 80\n      ComparisonOperator: GreaterThanThreshold\n      AlarmActions:\n        - !Ref ProjectCriticalAlertsTopic\n      TreatMissingData: notBreaching\n\n  # High Memory Utilization Alarm\n  ProjectHighMemoryAlarm:\n    Type: AWS::CloudWatch::Alarm\n    Properties:\n      AlarmName: !Sub \"${AWS::StackName}-High-Memory-Utilization\"\n      AlarmDescription: Alert when ECS service memory utilization is high\n      MetricName: MemoryUtilization\n      Namespace: AWS/ECS\n      Dimensions:\n        - Name: ServiceName\n          Value: !Sub \"${AWS::StackName}-service\"\n      Statistic: Average\n      Period: 300\n      EvaluationPeriods: 2\n      Threshold: 85\n      ComparisonOperator: GreaterThanThreshold\n      AlarmActions:\n        - !Ref ProjectCriticalAlertsTopic\n      TreatMissingData: notBreaching\n\n  # ALB High Response Time Alarm\n  ProjectHighResponseTimeAlarm:\n    Type: AWS::CloudWatch::Alarm\n    Properties:\n      AlarmName: !Sub \"${AWS::StackName}-High-Response-Time\"\n      AlarmDescription: Alert when ALB response time is high\n      MetricName: TargetResponseTime\n      Namespace: AWS/ApplicationELB\n      Di"
    },
    {
      "source": "phases/60-observability/01-project-observability.yaml",
      "text": "mensions:\n        - Name: LoadBalancer\n          Value: !Sub \"${AWS::StackName}-alb\"\n      Statistic: Average\n      Period: 300\n      EvaluationPeriods: 2\n      Threshold: 2\n      ComparisonOperator: GreaterThanThreshold\n      AlarmActions:\n        - !Ref ProjectCriticalAlertsTopic\n      TreatMissingData: notBreaching\n\n  # Custom Application Log Group\n  ProjectApplicationLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub \"/aws/ecs/${AWS::StackName}/application\"\n      RetentionInDays: 30\n      Tags:\n        - Key: Project\n          Value: !Ref AWS::StackName\n        - Key: Purpose\n          Value: application-logs\n\noutputs:\n  ProjectDashboardURL:\n    Description: URL to the project observability dashboard\n    Value: !Sub \"https://console.aws.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=${AWS::StackName}-Project-Observability\"\n    Export:\n      Name: !Sub \"${AWS::StackName}-ProjectDashboardURL\"\n\n  ProjectAlertsTopicArn:\n    Description: ARN of the project alerts SNS topic\n    Value: !Ref ProjectCriticalAlertsTopic\n    Export:\n      Name: !Sub \"${AWS::StackName}-ProjectAlertsTopicArn\"\n"
    },
    {
      "source": "phases/60-observability/domain-metadata.yaml",
      "text": "domain:\n  name: \"observability\"\n  description: \"Project-specific monitoring and observability (not IAL core)\"\n  dependencies: [\"foundation\", \"compute\", \"data\", \"application\"]\n  parallel_safe: true\n  estimated_duration: \"15min\"\n  team_owner: \"sre-team\"\n  risk_level: \"low\"\n  phases:\n    - \"01-project-observability.yaml\"\n  execution_order: \"parallel\"\n  priority: 6\n"
    },
    {
      "source": "phases/70-ai-ml/domain-metadata.yaml",
      "text": "domain:\n  name: \"ai-ml\"\n  description: \"AI/ML services - RAG, Bedrock integrations\"\n  dependencies: [\"foundation\", \"security\", \"data\", \"application\"]\n  parallel_safe: true\n  estimated_duration: \"15min\"\n  team_owner: \"ai-team\"\n  risk_level: \"medium\"\n  phases:\n    - \"01-rag-s3-tables.yaml\"\n  execution_order: \"parallel\"\n  priority: 7\n"
    },
    {
      "source": "phases/90-governance/01-well-architected-assessment.yaml",
      "text": "# PHASE 15: WELL-ARCHITECTED ASSESSMENT (0 recursos AWS)\n# Depend\u00eancias: Todas as fases anteriores (00-14)\n# Custo: $0/m\u00eas (apenas avalia\u00e7\u00e3o)\n# Execu\u00e7\u00e3o: SEMPRE no final, ap\u00f3s todas as fases\n\nproject:\n  name: \"{{PROJECT_NAME}}\"\n  phase: \"15-well-architected-assessment\"\n  executor: \"{{EXECUTOR_NAME}}\"\n  resources: 0\n  note: \"Assessment e recomenda\u00e7\u00f5es baseadas no AWS Well-Architected Framework\"\n\n# ASSESSMENT AUTOM\u00c1TICO\nwell_architected_assessment:\n  workflow:\n    step_1_register_pending:\n      action: \"update_dynamodb\"\n      table: \"mcp-provisioning-checklist\"\n      item:\n        Project: \"{{PROJECT_NAME}}\"\n        ResourceName: \"well-architected-assessment\"\n        Status: \"Pending\"\n        Phase: \"15-well-architected-assessment\"\n        Executor: \"{{EXECUTOR_NAME}}\"\n        Timestamp: \"{{current_timestamp}}\"\n    \n    step_2_run_assessment:\n      action: \"evaluate_architecture\"\n      pillars:\n        - \"Operational Excellence\"\n        - \"Security\"\n        - \"Reliability\"\n        - \"Performance Efficiency\"\n        - \"Cost Optimization\"\n        - \"Sustainability\"\n    \n    step_3_generate_report:\n      action: \"generate_report\"\n      format: \"markdown\"\n      output: \"/home/ial/WELL_ARCHITECTED_REPORT.md\"\n    \n    step_4_update_verified:\n      action: \"update_dynamodb\"\n      status: \"Verified\"\n      report_path: \"/home/ial/WELL_ARCHITECTED_REPORT.md\"\n\n# PILLAR 1: OPERATIONAL EXCELLENCE\noperational_excellence:\n  score: 90\n  checks:\n    - name: \"IaC Implementation\"\n      status: \"\u2705 PASS\"\n      note: \"All 60 resources defined as code with DynamoDB state tracking\"\n    \n    - name: \"Monitoring and Observability\"\n      status: \"\u2705 PASS\"\n      note: \"9 CloudWatch dashboards, 12 alarms, X-Ray tracing enabled\"\n    \n    - name: \"Automated Recovery\"\n      status: \"\u2705 PASS\"\n      note: \"Control commands: /status, /resume, /rollback for automated recovery\"\n    \n    - name: \"Change Management\"\n      status: \"\u2705 PASS\"\n      note: \"DynamoDB tracks all changes with timestamps and versions\""
    },
    {
      "source": "phases/90-governance/01-well-architected-assessment.yaml",
      "text": "\n    \n    - name: \"Runbook Documentation\"\n      status: \"\u26a0\ufe0f IMPROVE\"\n      recommendation: \"Create operational runbooks for common scenarios\"\n      priority: \"Medium\"\n\n# PILLAR 2: SECURITY\nsecurity:\n  score: 98\n  checks:\n    - name: \"Data Encryption at Rest\"\n      status: \"\u2705 PASS\"\n      note: \"KMS encryption for all data (EBS, S3, RDS, Redis, CloudWatch Logs)\"\n    \n    - name: \"Data Encryption in Transit\"\n      status: \"\u2705 PASS\"\n      note: \"TLS 1.2+ for all connections, Redis SSL enabled\"\n    \n    - name: \"Network Segmentation\"\n      status: \"\u2705 PASS\"\n      note: \"Private subnets with NO internet access, VPC endpoints for AWS services\"\n    \n    - name: \"Defense in Depth\"\n      status: \"\u2705 PASS\"\n      note: \"4 layers: WAF \u2192 CloudFront header \u2192 ALB validation \u2192 Security Groups\"\n    \n    - name: \"Security Services\"\n      status: \"\u2705 PASS\"\n      note: \"GuardDuty, Inspector, Security Hub, Access Analyzer, Macie all enabled\"\n    \n    - name: \"IAM Least Privilege\"\n      status: \"\u2705 PASS\"\n      note: \"Specific IAM roles with minimal permissions for each service\"\n    \n    - name: \"Secrets Management\"\n      status: \"\u2705 PASS\"\n      note: \"Parameter Store with KMS encryption for sensitive data\"\n    \n    - name: \"VPC Flow Logs\"\n      status: \"\u2705 PASS\"\n      note: \"3 log groups (VPC 90d, private 30d REJECT, public 30d ALL)\"\n    \n    - name: \"MFA for Root Account\"\n      status: \"\u26a0\ufe0f MANUAL CHECK\"\n      recommendation: \"Verify MFA is enabled for root account\"\n      priority: \"Critical\"\n\n# PILLAR 3: RELIABILITY\nreliability:\n  score: 95\n  checks:\n    - name: \"Multi-AZ Deployment\"\n      status: \"\u2705 PASS\"\n      note: \"ECS tasks across 3 AZs, Redis multi-AZ, ALB multi-AZ\"\n    \n    - name: \"Auto Scaling\"\n      status: \"\u2705 PASS\"\n      note: \"ECS auto scaling with 3 policies (CPU, Memory, ALB requests)\"\n    \n    - name: \"Health Checks\"\n      status: \"\u2705 PASS\"\n      note: \"ALB health check /actuator/health/readiness, ECS health check\"\n    \n    - name: \"Circuit Breaker\"\n      status: \"\u2705 PASS\"\n      no"
    },
    {
      "source": "phases/90-governance/01-well-architected-assessment.yaml",
      "text": "te: \"ECS deployment circuit breaker with automatic rollback\"\n    \n    - name: \"Backup and Recovery\"\n      status: \"\u2705 PASS\"\n      note: \"Redis daily snapshots (7 days), DynamoDB state tracking for recovery\"\n    \n    - name: \"Zero Downtime Deployment\"\n      status: \"\u2705 PASS\"\n      note: \"ECS rolling deployment with MinimumHealthyPercent 100%\"\n    \n    - name: \"Disaster Recovery Plan\"\n      status: \"\u26a0\ufe0f IMPROVE\"\n      recommendation: \"Document RTO/RPO targets and DR procedures\"\n      priority: \"Medium\"\n\n# PILLAR 4: PERFORMANCE EFFICIENCY\nperformance_efficiency:\n  score: 95\n  checks:\n    - name: \"CDN Implementation\"\n      status: \"\u2705 PASS\"\n      note: \"CloudFront with 4 cache behaviors for optimal caching\"\n    \n    - name: \"Caching Strategy\"\n      status: \"\u2705 PASS\"\n      note: \"Redis Serverless for application caching, CloudFront for static content\"\n    \n    - name: \"Auto Scaling\"\n      status: \"\u2705 PASS\"\n      note: \"Dynamic scaling based on CPU, Memory, and request count\"\n    \n    - name: \"Container Optimization\"\n      status: \"\u2705 PASS\"\n      note: \"Right-sized containers (512 CPU, 1024 Memory) with X-Ray profiling\"\n    \n    - name: \"Database Performance\"\n      status: \"\u2705 PASS\"\n      note: \"Redis Serverless with 1-5GB auto-scaling\"\n    \n    - name: \"Load Testing\"\n      status: \"\u26a0\ufe0f IMPROVE\"\n      recommendation: \"Perform load testing to validate scaling policies\"\n      priority: \"Medium\"\n\n# PILLAR 5: COST OPTIMIZATION\ncost_optimization:\n  score: 85\n  checks:\n    - name: \"Right Sizing\"\n      status: \"\u2705 PASS\"\n      note: \"ECS tasks right-sized, Redis serverless auto-scales\"\n    \n    - name: \"Reserved Capacity\"\n      status: \"\u26a0\ufe0f IMPROVE\"\n      recommendation: \"Consider Savings Plans for ECS Fargate (potential 20% savings)\"\n      priority: \"High\"\n      estimated_savings: \"$36/month\"\n    \n    - name: \"Unused Resources\"\n      status: \"\u2705 PASS\"\n      note: \"No NAT Gateway (saves $32/month), VPC endpoints instead\"\n    \n    - name: \"CloudFront Optimization\"\n      status: \"\u2705 PASS\"\n     "
    },
    {
      "source": "phases/90-governance/01-well-architected-assessment.yaml",
      "text": " note: \"PriceClass_100 (US, Canada, Europe only)\"\n    \n    - name: \"Log Retention\"\n      status: \"\u2705 PASS\"\n      note: \"Optimized retention (VPC 90d, private/public 30d, ECS 30d)\"\n    \n    - name: \"Cost Monitoring\"\n      status: \"\u26a0\ufe0f IMPROVE\"\n      recommendation: \"Enable AWS Cost Anomaly Detection and Budget Alerts\"\n      priority: \"Medium\"\n\n# PILLAR 6: SUSTAINABILITY\nsustainability:\n  score: 90\n  checks:\n    - name: \"Serverless Services\"\n      status: \"\u2705 PASS\"\n      note: \"Redis Serverless, ECS Fargate (no idle EC2 instances)\"\n    \n    - name: \"Auto Scaling\"\n      status: \"\u2705 PASS\"\n      note: \"Scale down to min 2 tasks during low traffic\"\n    \n    - name: \"Regional Optimization\"\n      status: \"\u2705 PASS\"\n      note: \"Single region ({{AWS_REGION}}) reduces data transfer\"\n    \n    - name: \"Resource Efficiency\"\n      status: \"\u2705 PASS\"\n      note: \"VPC endpoints eliminate NAT Gateway energy consumption\"\n    \n    - name: \"Carbon Footprint\"\n      status: \"\u26a0\ufe0f IMPROVE\"\n      recommendation: \"Consider AWS Customer Carbon Footprint Tool\"\n      priority: \"Low\"\n\n# OVERALL ASSESSMENT\noverall_assessment:\n  total_score: 92\n  grade: \"A\"\n  status: \"Excellent\"\n  \n  summary:\n    strengths:\n      - \"Comprehensive security implementation (98/100)\"\n      - \"High reliability with multi-AZ and auto scaling (95/100)\"\n      - \"Excellent performance with CDN and caching (95/100)\"\n      - \"Strong operational practices with IaC and monitoring (90/100)\"\n    \n    improvements:\n      - priority: \"High\"\n        pillar: \"Cost Optimization\"\n        recommendation: \"Implement Savings Plans for ECS Fargate\"\n        estimated_savings: \"$36/month (20% reduction)\"\n      \n      - priority: \"Critical\"\n        pillar: \"Security\"\n        recommendation: \"Verify MFA enabled for root account\"\n        action: \"Manual verification required\"\n      \n      - priority: \"Medium\"\n        pillar: \"Reliability\"\n        recommendation: \"Document RTO/RPO targets and DR procedures\"\n        action: \"Create disaster recovery runb"
    },
    {
      "source": "phases/90-governance/01-well-architected-assessment.yaml",
      "text": "ook\"\n      \n      - priority: \"Medium\"\n        pillar: \"Performance\"\n        recommendation: \"Perform load testing to validate scaling\"\n        action: \"Run load tests with 1000+ concurrent users\"\n      \n      - priority: \"Medium\"\n        pillar: \"Cost Optimization\"\n        recommendation: \"Enable Cost Anomaly Detection\"\n        action: \"Configure AWS Cost Anomaly Detection service\"\n\n  compliance:\n    well_architected_best_practices: \"92% compliant\"\n    security_best_practices: \"98% compliant\"\n    cost_optimization: \"85% compliant\"\n    \n  next_review: \"3 months after deployment\"\n\n# AUTOMATED RECOMMENDATIONS\nautomated_recommendations:\n  immediate_actions:\n    - \"\u2705 Architecture is production-ready\"\n    - \"\u26a0\ufe0f Verify root account MFA before deployment\"\n    - \"\u26a0\ufe0f Configure Cost Anomaly Detection\"\n  \n  post_deployment:\n    - \"Run load testing within first week\"\n    - \"Review Savings Plans after 30 days of usage data\"\n    - \"Create operational runbooks for common scenarios\"\n    - \"Document disaster recovery procedures\"\n  \n  quarterly_review:\n    - \"Re-run Well-Architected Assessment\"\n    - \"Review cost optimization opportunities\"\n    - \"Update security configurations\"\n    - \"Validate backup and recovery procedures\"\n"
    },
    {
      "source": "phases/90-governance/02-budgets-resources.yaml",
      "text": "phase_name: Universal Budgets Resources\ndescription: Auto-generated phase for budgets resources\nresource_count: 1\nResources:\n  UniversalBudgets:\n    Type: AWS::Budgets::Resource\n    Properties: {}\n    Metadata:\n      CreatedVia: universal-tracker\n      Service: budgets\n      Operation: create-budget\n      Timestamp: '2025-10-24T11:31:36.042872'\n      OriginalName: budgets\n"
    },
    {
      "source": "phases/90-governance/03-cost-guardrails.yaml",
      "text": "phase_name: \"Cost Guardrails - Budget Control & Anomaly Detection with FinOps Enforcement\"\ndescription: \"AWS Budgets, Cost Anomaly Detection and automated FinOps enforcement for proactive cost management\"\nresource_count: 6\n\nResources:\n  # Project Budget with Alerts\n  ProjectBudget:\n    Type: AWS::Budgets::Budget\n    Properties:\n      Budget:\n        BudgetName: !Sub '${ProjectName}-monthly-budget'\n        BudgetLimit:\n          Amount: !Ref MonthlyBudgetLimit\n          Unit: USD\n        TimeUnit: MONTHLY\n        BudgetType: COST\n        CostFilters:\n          TagKey:\n            - Project\n          TagValue:\n            - !Ref ProjectName\n      NotificationsWithSubscribers:\n        - Notification:\n            NotificationType: ACTUAL\n            ComparisonOperator: GREATER_THAN\n            Threshold: 80\n            ThresholdType: PERCENTAGE\n          Subscribers:\n            - SubscriptionType: EMAIL\n              Address: !Ref AlertEmail\n        - Notification:\n            NotificationType: FORECASTED\n            ComparisonOperator: GREATER_THAN\n            Threshold: 100\n            ThresholdType: PERCENTAGE\n          Subscribers:\n            - SubscriptionType: EMAIL\n              Address: !Ref AlertEmail\n\n  # Control Plane Budget (separate from workloads)\n  ControlPlaneBudget:\n    Type: AWS::Budgets::Budget\n    Properties:\n      Budget:\n        BudgetName: !Sub '${ProjectName}-control-plane-budget'\n        BudgetLimit:\n          Amount: !Ref ControlPlaneBudgetLimit\n          Unit: USD\n        TimeUnit: MONTHLY\n        BudgetType: COST\n        CostFilters:\n          TagKey:\n            - \"ial:deployment-type\"\n          TagValue:\n            - \"control_plane\"\n      NotificationsWithSubscribers:\n        - Notification:\n            NotificationType: ACTUAL\n            ComparisonOperator: GREATER_THAN\n            Threshold: 90\n            ThresholdType: PERCENTAGE\n          Subscribers:\n            - SubscriptionType: EMAIL\n              Address: !Ref AlertEmail\n\n  #"
    },
    {
      "source": "phases/90-governance/03-cost-guardrails.yaml",
      "text": " Cost Anomaly Detector\n  CostAnomalyDetector:\n    Type: AWS::CE::AnomalyDetector\n    Properties:\n      AnomalyDetectorName: !Sub '${ProjectName}-cost-anomaly-detector'\n      MonitorType: DIMENSIONAL\n      MonitorSpecification: |\n        {\n          \"DimensionKey\": \"SERVICE\",\n          \"MatchOptions\": [\"EQUALS\"],\n          \"Values\": [\"Amazon Elastic Compute Cloud - Compute\", \"Amazon Relational Database Service\", \"Amazon Simple Storage Service\"]\n        }\n\n  # Cost Anomaly Monitor\n  CostAnomalyMonitor:\n    Type: AWS::CE::AnomalyMonitor\n    Properties:\n      MonitorName: !Sub '${ProjectName}-cost-monitor'\n      MonitorType: DIMENSIONAL\n      MonitorSpecification: !Sub |\n        {\n          \"Tags\": {\n            \"Key\": \"Project\",\n            \"Values\": [\"${ProjectName}\"],\n            \"MatchOptions\": [\"EQUALS\"]\n          }\n        }\n\n  # Cost Anomaly Subscription\n  CostAnomalySubscription:\n    Type: AWS::CE::AnomalySubscription\n    Properties:\n      SubscriptionName: !Sub '${ProjectName}-cost-alerts'\n      MonitorArnList:\n        - !Ref CostAnomalyMonitor\n      Subscribers:\n        - Type: EMAIL\n          Address: !Ref AlertEmail\n      Frequency: DAILY\n      Threshold: 10.0\n\n  # FinOps Enforcement SNS Topic\n  FinOpsAlertsTopic:\n    Type: AWS::SNS::Topic\n    Properties:\n      TopicName: !Sub '${ProjectName}-finops-alerts'\n      DisplayName: 'IAL FinOps Budget Enforcement Alerts'\n      Subscription:\n        - Protocol: email\n          Endpoint: !Ref AlertEmail\n\n# Outputs\nOutputs:\n  BudgetName:\n    Description: 'Name of the project budget'\n    Value: !Sub '${ProjectName}-monthly-budget'\n    Export:\n      Name: !Sub '${ProjectName}-budget-name'\n\n  ControlPlaneBudgetName:\n    Description: 'Name of the control plane budget'\n    Value: !Sub '${ProjectName}-control-plane-budget'\n    Export:\n      Name: !Sub '${ProjectName}-control-plane-budget-name'\n\n  AnomalyDetectorArn:\n    Description: 'ARN of the cost anomaly detector'\n    Value: !Ref CostAnomalyDetector\n    Export:\n      Nam"
    },
    {
      "source": "phases/90-governance/03-cost-guardrails.yaml",
      "text": "e: !Sub '${ProjectName}-anomaly-detector-arn'\n\n  CostMonitorArn:\n    Description: 'ARN of the cost monitor'\n    Value: !Ref CostAnomalyMonitor\n    Export:\n      Name: !Sub '${ProjectName}-cost-monitor-arn'\n\n  FinOpsAlertsTopicArn:\n    Description: 'ARN of the FinOps alerts SNS topic'\n    Value: !Ref FinOpsAlertsTopic\n    Export:\n      Name: !Sub '${ProjectName}-finops-alerts-topic-arn'\n\n# Cost estimation with FinOps integration\nmetadata:\n  estimated_monthly_cost: '$3.50'\n  cost_breakdown:\n    budgets_api: '$0.60'\n    cost_anomaly_detection: '$1.00'\n    cost_explorer_api: '$0.40'\n    sns_notifications: '$0.50'\n    finops_enforcement: '$1.00'\n  finops:\n    enforcement_enabled: true\n    budget_validation: true\n    pr_commenting: true\n\n# Parameters\nparameters:\n  ProjectName:\n    Type: String\n    Default: ial\n  AlertEmail:\n    Type: String\n    Default: admin@example.com\n    Description: Email address for cost alerts\n  MonthlyBudgetLimit:\n    Type: Number\n    Default: 500\n    Description: Monthly budget limit in USD for workloads\n  ControlPlaneBudgetLimit:\n    Type: Number\n    Default: 200\n    Description: Monthly budget limit in USD for control plane\n"
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IaL Cost & Performance Dashboard - Executive visibility and optimization'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: 'ial'\n  AlertEmail:\n    Type: String\n    Description: 'Email for cost and performance alerts'\n  Environment:\n    Type: String\n    Default: 'prod'\n\nResources:\n  # Cost & Performance Dashboard\n  CostPerformanceDashboard:\n    Type: AWS::CloudWatch::Dashboard\n    Properties:\n      DashboardName: !Sub '${ProjectName}-Cost-Performance-Executive'\n      DashboardBody: !Sub |\n        {\n          \"widgets\": [\n            {\n              \"type\": \"text\",\n              \"x\": 0,\n              \"y\": 0,\n              \"width\": 24,\n              \"height\": 2,\n              \"properties\": {\n                \"markdown\": \"# \ud83d\udcb0 ${ProjectName} - Cost & Performance Executive Dashboard\\n**Real-time cost optimization and performance correlation**\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 0,\n              \"y\": 2,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"AWS/Billing\", \"EstimatedCharges\", \"Currency\", \"USD\"],\n                  [\"AWS/Budgets\", \"ActualCost\", \"BudgetName\", \"${ProjectName}-monthly-budget\"],\n                  [\"AWS/Budgets\", \"ForecastedCost\", \"BudgetName\", \"${ProjectName}-monthly-budget\"]\n                ],\n                \"view\": \"timeSeries\",\n                \"stacked\": false,\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\ud83d\udcb0 Cost Trending vs Budget\",\n                \"period\": 86400,\n                \"stat\": \"Maximum\",\n                \"yAxis\": {\n                  \"left\": {\n                    \"min\": 0\n                  }\n                }\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 12,\n              \"y\": 2,\n              \"width\": 12,\n              \"height\": 6,\n              \"properties\": {\n "
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": "               \"metrics\": [\n                  [\"AWS/ApplicationELB\", \"TargetResponseTime\", \"LoadBalancer\", \"${ProjectName}-alb\"],\n                  [\"AWS/ECS\", \"CPUUtilization\", \"ServiceName\", \"${ProjectName}-service\"],\n                  [\"AWS/RDS\", \"CPUUtilization\", \"DBInstanceIdentifier\", \"${ProjectName}-db\"]\n                ],\n                \"view\": \"timeSeries\",\n                \"stacked\": false,\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\u26a1 Performance Metrics\",\n                \"period\": 300,\n                \"stat\": \"Average\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 0,\n              \"y\": 8,\n              \"width\": 8,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"AWS/EC2\", \"EstimatedCharges\", \"Currency\", \"USD\"],\n                  [\"AWS/RDS\", \"EstimatedCharges\", \"Currency\", \"USD\"],\n                  [\"AWS/S3\", \"EstimatedCharges\", \"Currency\", \"USD\"],\n                  [\"AWS/Lambda\", \"EstimatedCharges\", \"Currency\", \"USD\"]\n                ],\n                \"view\": \"pie\",\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\ud83d\udcb8 Cost by Service\",\n                \"period\": 86400,\n                \"stat\": \"Maximum\"\n              }\n            },\n            {\n              \"type\": \"metric\",\n              \"x\": 8,\n              \"y\": 8,\n              \"width\": 8,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"IaL/Performance\", \"CostPerRequest\"],\n                  [\"IaL/Performance\", \"CostPerTransaction\"],\n                  [\"IaL/Performance\", \"PerformanceEfficiencyScore\"]\n                ],\n                \"view\": \"timeSeries\",\n                \"stacked\": false,\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\ud83d\udcca Cost Efficiency Metrics\",\n                \"period\": 3600,\n                \"stat\": \"Average\"\n              }\n            },\n           "
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": " {\n              \"type\": \"metric\",\n              \"x\": 16,\n              \"y\": 8,\n              \"width\": 8,\n              \"height\": 6,\n              \"properties\": {\n                \"metrics\": [\n                  [\"AWS/TrustedAdvisor\", \"CostOptimizationRecommendations\"],\n                  [\"IaL/CostOptimization\", \"PotentialSavings\"],\n                  [\"IaL/CostOptimization\", \"OptimizationOpportunities\"]\n                ],\n                \"view\": \"number\",\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\ud83d\udca1 Optimization Opportunities\",\n                \"period\": 86400,\n                \"stat\": \"Maximum\"\n              }\n            },\n            {\n              \"type\": \"log\",\n              \"x\": 0,\n              \"y\": 14,\n              \"width\": 24,\n              \"height\": 6,\n              \"properties\": {\n                \"query\": \"SOURCE '/aws/lambda/${ProjectName}-cost-analyzer'\\n| fields @timestamp, @message\\n| filter @message like /COST_ANOMALY/\\n| sort @timestamp desc\\n| limit 10\",\n                \"region\": \"${AWS::Region}\",\n                \"title\": \"\ud83d\udea8 Recent Cost Anomalies\",\n                \"view\": \"table\"\n              }\n            }\n          ]\n        }\n\n  # Custom Metrics for Cost Efficiency\n  CostEfficiencyMetricFilter:\n    Type: AWS::Logs::MetricFilter\n    Properties:\n      LogGroupName: !Sub '/aws/lambda/${ProjectName}-cost-analyzer'\n      FilterPattern: '[timestamp, request_id, cost_per_request=*]'\n      MetricTransformations:\n        - MetricNamespace: 'IaL/Performance'\n          MetricName: 'CostPerRequest'\n          MetricValue: '$cost_per_request'\n          DefaultValue: 0\n\n  # Cost Anomaly Subscription\n  CostAnomalySubscription:\n    Type: AWS::CE::AnomalySubscription\n    Properties:\n      SubscriptionName: !Sub '${ProjectName}-cost-anomaly-alerts'\n      MonitorArnList:\n        - !Sub 'arn:aws:ce:${AWS::Region}:${AWS::AccountId}:anomalydetector/${ProjectName}-cost-anomaly-detector'\n      Subscribers:\n        - Type: EMAIL\n          Addr"
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": "ess: !Ref AlertEmail\n      Frequency: DAILY\n      ThresholdExpression: !Sub |\n        {\n          \"And\": [\n            {\n              \"Dimensions\": {\n                \"Key\": \"ANOMALY_TOTAL_IMPACT_ABSOLUTE\",\n                \"Values\": [\"10\"],\n                \"MatchOptions\": [\"GREATER_THAN_OR_EQUAL\"]\n              }\n            }\n          ]\n        }\n\n  # Performance Efficiency Calculator Lambda\n  PerformanceEfficiencyLambda:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-performance-efficiency-calculator'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt PerformanceEfficiencyRole.Arn\n      Timeout: 300\n      Environment:\n        Variables:\n          PROJECT_NAME: !Ref ProjectName\n      Code:\n        ZipFile: |\n          import json\n          import boto3\n          import os\n          from datetime import datetime, timedelta\n          \n          cloudwatch = boto3.client('cloudwatch')\n          ce = boto3.client('ce')\n          \n          def lambda_handler(event, context):\n              project_name = os.environ['PROJECT_NAME']\n              \n              try:\n                  # Get cost data\n                  end_date = datetime.now()\n                  start_date = end_date - timedelta(days=1)\n                  \n                  cost_response = ce.get_cost_and_usage(\n                      TimePeriod={\n                          'Start': start_date.strftime('%Y-%m-%d'),\n                          'End': end_date.strftime('%Y-%m-%d')\n                      },\n                      Granularity='DAILY',\n                      Metrics=['BlendedCost'],\n                      GroupBy=[{'Type': 'DIMENSION', 'Key': 'SERVICE'}]\n                  )\n                  \n                  total_cost = 0\n                  for result in cost_response['ResultsByTime']:\n                      for group in result['Groups']:\n                          total_cost += float(group['Metrics']['BlendedCost']['Amount'])\n    "
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": "              \n                  # Get performance metrics\n                  perf_response = cloudwatch.get_metric_statistics(\n                      Namespace='AWS/ApplicationELB',\n                      MetricName='RequestCount',\n                      StartTime=start_date,\n                      EndTime=end_date,\n                      Period=3600,\n                      Statistics=['Sum']\n                  )\n                  \n                  total_requests = sum([dp['Sum'] for dp in perf_response['Datapoints']])\n                  \n                  # Calculate efficiency metrics\n                  cost_per_request = total_cost / max(total_requests, 1)\n                  efficiency_score = min(100, max(0, 100 - (cost_per_request * 1000)))\n                  \n                  # Publish custom metrics\n                  cloudwatch.put_metric_data(\n                      Namespace='IaL/Performance',\n                      MetricData=[\n                          {\n                              'MetricName': 'CostPerRequest',\n                              'Value': cost_per_request,\n                              'Unit': 'None'\n                          },\n                          {\n                              'MetricName': 'PerformanceEfficiencyScore',\n                              'Value': efficiency_score,\n                              'Unit': 'Percent'\n                          },\n                          {\n                              'MetricName': 'TotalDailyCost',\n                              'Value': total_cost,\n                              'Unit': 'None'\n                          }\n                      ]\n                  )\n                  \n                  # Log for anomaly detection\n                  print(f'COST_ANALYSIS: cost_per_request={cost_per_request}, efficiency_score={efficiency_score}, total_cost={total_cost}')\n                  \n                  if cost_per_request > 0.01:  # Threshold for anomaly\n                      print(f'COST_ANOMALY: High"
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": " cost per request detected: ${cost_per_request:.4f}')\n                  \n                  return {\n                      'statusCode': 200,\n                      'body': json.dumps({\n                          'cost_per_request': cost_per_request,\n                          'efficiency_score': efficiency_score,\n                          'total_cost': total_cost,\n                          'total_requests': total_requests\n                      })\n                  }\n                  \n              except Exception as e:\n                  print(f'ERROR: {str(e)}')\n                  return {\n                      'statusCode': 500,\n                      'body': json.dumps({'error': str(e)})\n                  }\n\n  # IAM Role for Performance Efficiency Lambda\n  PerformanceEfficiencyRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-performance-efficiency-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: CostAndPerformanceAccess\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - ce:GetCostAndUsage\n                  - ce:GetUsageReport\n                  - cloudwatch:GetMetricStatistics\n                  - cloudwatch:PutMetricData\n                  - logs:CreateLogGroup\n                  - logs:CreateLogStream\n                  - logs:PutLogEvents\n                Resource: '*'\n\n  # Scheduled execution for performance efficiency calculation\n  PerformanceEfficiencySchedule:\n    Type: AWS::Events::Rule\n    Properties:\n      Name: !Sub '${ProjectName}-performance-efficiency-schedule'\n      Description: 'Daily calculation of cost and performance "
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": "efficiency'\n      ScheduleExpression: 'rate(1 day)'\n      State: ENABLED\n      Targets:\n        - Arn: !GetAtt PerformanceEfficiencyLambda.Arn\n          Id: 'PerformanceEfficiencyTarget'\n\n  # Permission for EventBridge to invoke Lambda\n  PerformanceEfficiencyLambdaPermission:\n    Type: AWS::Lambda::Permission\n    Properties:\n      FunctionName: !Ref PerformanceEfficiencyLambda\n      Action: lambda:InvokeFunction\n      Principal: events.amazonaws.com\n      SourceArn: !GetAtt PerformanceEfficiencySchedule.Arn\n\n  # Cost Optimization Recommendations Alarm\n  HighCostPerRequestAlarm:\n    Type: AWS::CloudWatch::Alarm\n    Properties:\n      AlarmName: !Sub '${ProjectName}-high-cost-per-request'\n      AlarmDescription: 'Alert when cost per request exceeds threshold'\n      MetricName: CostPerRequest\n      Namespace: IaL/Performance\n      Statistic: Average\n      Period: 3600\n      EvaluationPeriods: 2\n      Threshold: 0.01\n      ComparisonOperator: GreaterThanThreshold\n      AlarmActions:\n        - !Ref CostOptimizationTopic\n      TreatMissingData: notBreaching\n\n  # SNS Topic for Cost Optimization Alerts\n  CostOptimizationTopic:\n    Type: AWS::SNS::Topic\n    Properties:\n      TopicName: !Sub '${ProjectName}-cost-optimization-alerts'\n      DisplayName: 'IaL Cost Optimization Alerts'\n      Subscription:\n        - Protocol: email\n          Endpoint: !Ref AlertEmail\n\n  # Cost Explorer Saved Report\n  CostExplorerReport:\n    Type: AWS::CUR::ReportDefinition\n    Properties:\n      ReportName: !Sub '${ProjectName}-cost-performance-report'\n      TimeUnit: DAILY\n      Format: textORcsv\n      Compression: GZIP\n      AdditionalSchemaElements:\n        - RESOURCES\n      S3Bucket: !Sub '${ProjectName}-cost-reports-${AWS::AccountId}'\n      S3Prefix: 'cost-performance-reports/'\n      S3Region: !Ref AWS::Region\n      AdditionalArtifacts:\n        - REDSHIFT\n        - QUICKSIGHT\n\nOutputs:\n  DashboardURL:\n    Description: 'URL to the Cost & Performance Dashboard'\n    Value: !Sub 'https://console.aw"
    },
    {
      "source": "phases/90-governance/04-cost-performance-dashboard.yaml",
      "text": "s.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=${ProjectName}-Cost-Performance-Executive'\n    Export:\n      Name: !Sub '${ProjectName}-cost-performance-dashboard-url'\n\n  PerformanceEfficiencyLambdaArn:\n    Description: 'ARN of the Performance Efficiency Calculator Lambda'\n    Value: !GetAtt PerformanceEfficiencyLambda.Arn\n    Export:\n      Name: !Sub '${ProjectName}-performance-efficiency-lambda-arn'\n\n  CostOptimizationTopicArn:\n    Description: 'ARN of the Cost Optimization SNS Topic'\n    Value: !Ref CostOptimizationTopic\n    Export:\n      Name: !Sub '${ProjectName}-cost-optimization-topic-arn'\n"
    },
    {
      "source": "phases/90-governance/domain-metadata.yaml",
      "text": "domain:\n  name: \"governance\"\n  description: \"Governance and compliance - Well-Architected, budgets, cost controls, performance dashboard\"\n  dependencies: [\"foundation\", \"security\", \"network\", \"compute\", \"data\", \"application\", \"observability\", \"ai-ml\"]\n  parallel_safe: true\n  estimated_duration: \"15min\"\n  team_owner: \"governance-team\"\n  risk_level: \"low\"\n  phases:\n    - \"01-well-architected-assessment.yaml\"\n    - \"02-budgets-resources.yaml\"\n    - \"03-cost-guardrails.yaml\"\n    - \"04-cost-performance-dashboard.yaml\"\n  execution_order: \"sequential\"\n  priority: 9\n"
    },
    {
      "source": "phases/99-misc/aws_apigateway_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Generic resource generated by IAL MCP Router for aws-apigateway-mcp'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  # Generic resource placeholder\n  # MCP: aws-apigateway-mcp\n  # Capabilities: create_api, configure_resources, manage_stages, setup_auth\n  # This template needs manual implementation\n  \n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for aws-apigateway-mcp\n    Value: !Ref PlaceholderResource\n"
    },
    {
      "source": "phases/99-misc/aws_dynamodb_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'DynamoDB Table generated by IAL MCP Router'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  DynamoDBTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-user-cluster'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: id\n          AttributeType: S\n      KeySchema:\n        - AttributeName: id\n          KeyType: HASH\n      PointInTimeRecoverySpecification:\n        PointInTimeRecoveryEnabled: true\n      SSESpecification:\n        SSEEnabled: true\n      Tags:\n        - Key: Name\n          Value: !Sub '${ProjectName}-user-cluster'\n        - Key: ManagedBy\n          Value: IAL-MCP-Router\n        - Key: Domain\n          Value: data\n\nOutputs:\n  TableName:\n    Description: DynamoDB Table Name\n    Value: !Ref DynamoDBTable\n    Export:\n      Name: !Sub '${ProjectName}-user-cluster-name'\n"
    },
    {
      "source": "phases/99-misc/aws_ec2_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Generic resource generated by IAL MCP Router for aws-ec2-mcp'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  # Generic resource placeholder\n  # MCP: aws-ec2-mcp\n  # Capabilities: launch_instances, manage_security_groups, configure_networking\n  # This template needs manual implementation\n  \n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for aws-ec2-mcp\n    Value: !Ref PlaceholderResource\n"
    },
    {
      "source": "phases/99-misc/aws_ecs_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'ECS Cluster generated by IAL MCP Router'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  ECSCluster:\n    Type: AWS::ECS::Cluster\n    Properties:\n      ClusterName: !Sub '${ProjectName}-user-cluster'\n      CapacityProviders:\n        - FARGATE\n        - FARGATE_SPOT\n      DefaultCapacityProviderStrategy:\n        - CapacityProvider: FARGATE\n          Weight: 1\n      ClusterSettings:\n        - Name: containerInsights\n          Value: enabled\n      Tags:\n        - Key: Name\n          Value: !Sub '${ProjectName}-user-cluster'\n        - Key: ManagedBy\n          Value: IAL-MCP-Router\n        - Key: Domain\n          Value: compute\n\nOutputs:\n  ClusterArn:\n    Description: ECS Cluster ARN\n    Value: !Ref ECSCluster\n    Export:\n      Name: !Sub '${ProjectName}-user-cluster-arn'\n"
    },
    {
      "source": "phases/99-misc/aws_eks_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Generic resource generated by IAL MCP Router for aws-eks-mcp'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  # Generic resource placeholder\n  # MCP: aws-eks-mcp\n  # Capabilities: create_cluster, manage_nodegroups, configure_networking\n  # This template needs manual implementation\n  \n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for aws-eks-mcp\n    Value: !Ref PlaceholderResource\n"
    },
    {
      "source": "phases/99-misc/aws_elasticache_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Generic resource generated by IAL MCP Router for aws-elasticache-mcp'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  # Generic resource placeholder\n  # MCP: aws-elasticache-mcp\n  # Capabilities: create_cluster, configure_replication, manage_parameters\n  # This template needs manual implementation\n  \n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for aws-elasticache-mcp\n    Value: !Ref PlaceholderResource\n"
    },
    {
      "source": "phases/99-misc/aws_elb_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Application Load Balancer generated by IAL MCP Router'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  ApplicationLoadBalancer:\n    Type: AWS::ElasticLoadBalancingV2::LoadBalancer\n    Properties:\n      Name: !Sub '${ProjectName}-user-cluster'\n      Type: application\n      Scheme: internet-facing\n      Subnets:\n        - !ImportValue VPC-PublicSubnet1\n        - !ImportValue VPC-PublicSubnet2\n      SecurityGroups:\n        - !ImportValue VPC-LoadBalancerSecurityGroup\n      Tags:\n        - Key: Name\n          Value: !Sub '${ProjectName}-user-cluster'\n        - Key: ManagedBy\n          Value: IAL-MCP-Router\n        - Key: Domain\n          Value: networking\n\n  TargetGroup:\n    Type: AWS::ElasticLoadBalancingV2::TargetGroup\n    Properties:\n      Name: !Sub '${ProjectName}-user-cluster-tg'\n      Port: 80\n      Protocol: HTTP\n      VpcId: !ImportValue VPC-Id\n      HealthCheckPath: /health\n      HealthCheckProtocol: HTTP\n      TargetType: ip\n\n  Listener:\n    Type: AWS::ElasticLoadBalancingV2::Listener\n    Properties:\n      DefaultActions:\n        - Type: forward\n          TargetGroupArn: !Ref TargetGroup\n      LoadBalancerArn: !Ref ApplicationLoadBalancer\n      Port: 80\n      Protocol: HTTP\n\nOutputs:\n  LoadBalancerDNS:\n    Description: Load Balancer DNS Name\n    Value: !GetAtt ApplicationLoadBalancer.DNSName\n    Export:\n      Name: !Sub '${ProjectName}-user-cluster-dns'\n"
    },
    {
      "source": "phases/99-misc/aws_lambda_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Lambda Function generated by IAL MCP Router'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  LambdaExecutionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-user-cluster-role'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n\n  LambdaFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Sub '${ProjectName}-user-cluster'\n      Runtime: python3.11\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\n                  'statusCode': 200,\n                  'body': 'Hello from IAL MCP Router generated Lambda!'\n              }\n      Timeout: 30\n      MemorySize: 128\n      Tags:\n        - Key: Name\n          Value: !Sub '${ProjectName}-user-cluster'\n        - Key: ManagedBy\n          Value: IAL-MCP-Router\n        - Key: Domain\n          Value: serverless\n\nOutputs:\n  FunctionArn:\n    Description: Lambda Function ARN\n    Value: !GetAtt LambdaFunction.Arn\n    Export:\n      Name: !Sub '${ProjectName}-user-cluster-arn'\n"
    },
    {
      "source": "phases/99-misc/aws_rds_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'RDS Database generated by IAL MCP Router'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  DBSubnetGroup:\n    Type: AWS::RDS::DBSubnetGroup\n    Properties:\n      DBSubnetGroupDescription: Subnet group for RDS database\n      SubnetIds:\n        - !ImportValue VPC-PrivateSubnet1\n        - !ImportValue VPC-PrivateSubnet2\n      Tags:\n        - Key: Name\n          Value: !Sub '${ProjectName}-user-cluster-subnet-group'\n\n  DatabaseInstance:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      DBInstanceIdentifier: !Sub '${ProjectName}-user-cluster'\n      DBInstanceClass: db.t3.micro\n      Engine: mysql\n      EngineVersion: '8.0'\n      MasterUsername: admin\n      ManageMasterUserPassword: true\n      AllocatedStorage: 20\n      StorageType: gp2\n      DBSubnetGroupName: !Ref DBSubnetGroup\n      VPCSecurityGroups:\n        - !ImportValue VPC-DatabaseSecurityGroup\n      BackupRetentionPeriod: 7\n      MultiAZ: false\n      StorageEncrypted: true\n      Tags:\n        - Key: Name\n          Value: !Sub '${ProjectName}-user-cluster'\n        - Key: ManagedBy\n          Value: IAL-MCP-Router\n        - Key: Domain\n          Value: data\n\nOutputs:\n  DatabaseEndpoint:\n    Description: RDS Database Endpoint\n    Value: !GetAtt DatabaseInstance.Endpoint.Address\n    Export:\n      Name: !Sub '${ProjectName}-user-cluster-endpoint'\n"
    },
    {
      "source": "phases/99-misc/aws_s3_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Generic resource generated by IAL MCP Router for aws-s3-mcp'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  # Generic resource placeholder\n  # MCP: aws-s3-mcp\n  # Capabilities: create_bucket, configure_policies, manage_lifecycle, enable_versioning\n  # This template needs manual implementation\n  \n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for aws-s3-mcp\n    Value: !Ref PlaceholderResource\n"
    },
    {
      "source": "phases/99-misc/aws_vpc_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Generic resource generated by IAL MCP Router for aws-vpc-mcp'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  # Generic resource placeholder\n  # MCP: aws-vpc-mcp\n  # Capabilities: create_vpc, create_subnets, create_security_groups, configure_routing\n  # This template needs manual implementation\n  \n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for aws-vpc-mcp\n    Value: !Ref PlaceholderResource\n"
    },
    {
      "source": "phases/99-misc/aws_xray_mcp_generated.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Generic resource generated by IAL MCP Router for aws-xray-mcp'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: ial-user\n    Description: Project name for resource naming\n\nResources:\n  # Generic resource placeholder\n  # MCP: aws-xray-mcp\n  # Capabilities: enable_tracing, create_service_map, analyze_traces\n  # This template needs manual implementation\n  \n  PlaceholderResource:\n    Type: AWS::CloudFormation::WaitConditionHandle\n    Properties: {}\n\nOutputs:\n  PlaceholderOutput:\n    Description: Placeholder output for aws-xray-mcp\n    Value: !Ref PlaceholderResource\n"
    },
    {
      "source": "phases/deployment-control-plane.yaml",
      "text": "metadata:\n  name: \"IAL Control Plane Deployment Order\"\n  description: \"Deployment sequence for IAL platform infrastructure components\"\n  version: \"1.0\"\n  created: \"2025-11-03\"\n  total_phases: 20\n  deployment_type: \"control_plane\"\n\nexecution_order:\n  - 00-foundation/01-dynamodb-state\n  - 00-foundation/02-logging-infrastructure\n  - 00-foundation/03-reconciliation-engine\n  - 00-foundation/04-backup-strategy\n  - 00-foundation/05-chaos-engineering\n  - 00-foundation/06-reconciliation-wrapper\n  - 00-foundation/07-conversation-memory\n  - 00-foundation/08-rag-storage\n  - 00-foundation/09-stepfunctions-orchestrator\n  - 00-foundation/10-ial-dynamodb-tables\n  - 00-foundation/11-ial-s3-storage\n  - 00-foundation/12-ial-rag-infrastructure\n  - 00-foundation/13-ial-drift-detection\n  - 00-foundation/14-ial-lambda-functions\n  - 00-foundation/15-ial-bedrock-github-iam\n  - 00-foundation/16-ial-test-validation\n  - 00-foundation/17-ial-finops-budget-enforcement\n  - 00-foundation/18-ial-feature-flags\n  - 00-foundation/19-ial-enterprise-observability\n  - 00-foundation/20-ial-github-oidc-provider\n\ndependencies:\n  00-foundation/01-dynamodb-state:\n    depends_on: []\n    reasoning: \"Bootstrap resource - DynamoDB table for state tracking\"\n  00-foundation/02-logging-infrastructure:\n    depends_on: []\n    reasoning: \"Independent logging infrastructure setup\"\n  00-foundation/03-reconciliation-engine:\n    depends_on: [\"00-foundation/01-dynamodb-state\"]\n    reasoning: \"Reconciliation engine depends on state table\"\n  00-foundation/04-backup-strategy:\n    depends_on: [\"00-foundation/01-dynamodb-state\"]\n    reasoning: \"Backup strategy depends on DynamoDB state table\"\n  00-foundation/05-chaos-engineering:\n    depends_on: []\n    reasoning: \"Independent chaos engineering setup\"\n  00-foundation/06-reconciliation-wrapper:\n    depends_on: [\"00-foundation/03-reconciliation-engine\"]\n    reasoning: \"Wrapper depends on reconciliation engine\"\n  00-foundation/07-conversation-memory:\n    depends_on: []\n    reasoning"
    },
    {
      "source": "phases/deployment-control-plane.yaml",
      "text": ": \"Independent conversation memory setup\"\n  00-foundation/08-rag-storage:\n    depends_on: []\n    reasoning: \"Independent RAG storage setup\"\n  00-foundation/09-stepfunctions-orchestrator:\n    depends_on: [\"00-foundation/01-dynamodb-state\", \"00-foundation/02-logging-infrastructure\"]\n    reasoning: \"Step Functions orchestrator depends on state table and logging infrastructure\"\n  00-foundation/10-ial-dynamodb-tables:\n    depends_on: [\"00-foundation/01-dynamodb-state\"]\n    reasoning: \"IAL DynamoDB tables depend on state tracking\"\n  00-foundation/11-ial-s3-storage:\n    depends_on: []\n    reasoning: \"Independent S3 storage for IAL platform\"\n  00-foundation/12-ial-rag-infrastructure:\n    depends_on: [\"00-foundation/11-ial-s3-storage\"]\n    reasoning: \"RAG infrastructure depends on S3 storage\"\n  00-foundation/13-ial-drift-detection:\n    depends_on: [\"00-foundation/02-logging-infrastructure\"]\n    reasoning: \"Drift detection depends on logging infrastructure\"\n  00-foundation/14-ial-lambda-functions:\n    depends_on: [\"00-foundation/10-ial-dynamodb-tables\"]\n    reasoning: \"Lambda functions depend on DynamoDB tables\"\n  00-foundation/15-ial-bedrock-github-iam:\n    depends_on: []\n    reasoning: \"Independent IAM setup for Bedrock and GitHub\"\n  00-foundation/16-ial-test-validation:\n    depends_on: [\"00-foundation/14-ial-lambda-functions\"]\n    reasoning: \"Test validation depends on Lambda functions\"\n  00-foundation/17-ial-finops-budget-enforcement:\n    depends_on: [\"00-foundation/09-stepfunctions-orchestrator\", \"00-foundation/10-ial-dynamodb-tables\"]\n    reasoning: \"FinOps enforcement depends on Step Functions orchestrator and DynamoDB tables\"\n"
    },
    {
      "source": "phases/deployment-order.yaml",
      "text": "metadata:\n  version: '3.1'\n  architecture: dag-cognitive\n  generated_by: phase_manager_ai\n  total_phases: 48\n  generated_at: '2025-11-03T20:54:00.000+00:00'\n  control_plane_phases: 20\n  workload_phases: 28\n  finops:\n    enabled: true\n    budget_enforcement: true\n    default_monthly_budget_usd: 100.0\n    control_plane_budget_usd: 200.0\n    workloads_budget_usd: 500.0\n  enterprise_hardening:\n    feature_flags_enabled: true\n    slo_monitoring_enabled: true\n    circuit_breaker_enabled: true\n    audit_enforcement_enabled: true\n  github_integration:\n    oidc_provider_enabled: true\n    gitops_required: true\n    multi_repo_support: true\nexecution_order:\n- 00-foundation/01-dynamodb-state\n- 00-foundation/02-logging-infrastructure\n- 00-foundation/03-reconciliation-engine\n- 00-foundation/04-backup-strategy\n- 00-foundation/05-chaos-engineering\n- 00-foundation/06-reconciliation-wrapper\n- 00-foundation/07-conversation-memory\n- 00-foundation/08-rag-storage\n- 00-foundation/09-stepfunctions-orchestrator\n- 00-foundation/10-ial-dynamodb-tables\n- 00-foundation/11-ial-s3-storage\n- 00-foundation/12-ial-rag-infrastructure\n- 00-foundation/13-ial-drift-detection\n- 00-foundation/14-ial-lambda-functions\n- 00-foundation/15-ial-bedrock-github-iam\n- 00-foundation/16-ial-test-validation\n- 00-foundation/17-ial-finops-budget-enforcement\n- 00-foundation/18-ial-feature-flags\n- 00-foundation/19-ial-enterprise-observability\n- 00-foundation/20-ial-github-oidc-provider\n- 10-security/01-kms-security\n- 10-security/04-iam-roles\n- 20-network/01-networking\n- 20-network/02-vpc-flow-logs\n- 40-data/01-redis\n- 40-data/04-dynamodb-tables\n- 40-data/05-s3-storage\n- 10-security/02-security-services\n- 10-security/03-secrets-manager\n- 10-security/05-iam-bedrock-github\n- 10-security/06-waf-cloudfront\n- 30-compute/01-ecr\n- 30-compute/02-ecs-cluster\n- 30-compute/03-ecs-task-service\n- 30-compute/04-ecs-autoscaling\n- 30-compute/05-alb\n- 40-data/02-aurora-postgresql\n- 40-data/03-aurora-postgresql-secure\n- 50-application/01-la"
    },
    {
      "source": "phases/deployment-order.yaml",
      "text": "mbda-functions\n- 50-application/03-sns-topics\n- 50-application/04-parameter-store\n- 60-observability/01-enhanced-observability\n- 60-observability/02-observability\n- 60-observability/03-drift-detection\n- 70-ai-ml/01-rag-s3-tables\n- 90-governance/01-well-architected-assessment\n- 90-governance/02-budgets-resources\n- 90-governance/03-cost-guardrails\n- 90-governance/04-cost-performance-dashboard\ndependencies:\n  00-foundation/01-dynamodb-state:\n    depends_on: []\n    reasoning: \"Bootstrap resource - DynamoDB table for state tracking\"\n  00-foundation/02-logging-infrastructure:\n    depends_on: []\n    reasoning: \"Independent logging infrastructure setup\"\n  00-foundation/03-reconciliation-engine:\n    depends_on: [\"00-foundation/01-dynamodb-state\"]\n    reasoning: \"Reconciliation engine depends on state table\"\n  00-foundation/04-backup-strategy:\n    depends_on: [\"00-foundation/01-dynamodb-state\"]\n    reasoning: \"Backup strategy depends on DynamoDB state table\"\n  00-foundation/05-chaos-engineering:\n    depends_on: []\n    reasoning: \"Independent chaos engineering setup\"\n  00-foundation/06-reconciliation-wrapper:\n    depends_on: [\"00-foundation/03-reconciliation-engine\"]\n    reasoning: \"Wrapper depends on reconciliation engine\"\n  00-foundation/07-conversation-memory:\n    depends_on: []\n    reasoning: \"Independent conversation memory setup\"\n  00-foundation/08-rag-storage:\n    depends_on: []\n    reasoning: \"Independent RAG storage setup\"\n  00-foundation/09-stepfunctions-orchestrator:\n    depends_on: [\"00-foundation/01-dynamodb-state\", \"00-foundation/02-logging-infrastructure\"]\n    reasoning: \"Step Functions orchestrator depends on state table and logging infrastructure\"\n  30-compute/01-ecr:\n    depends_on: []\n    reasoning: \"O ECR (Elastic Container Registry) n\\xE3o depende de nenhuma outra\\\n      \\ fase, pois \\xE9 um servi\\xE7o independente que fornece um registro de cont\\xEA\\\n      ineres para armazenar e gerenciar imagens de cont\\xEAineres.\"\n  30-compute/02-ecs-cluster:\n    depen"
    },
    {
      "source": "phases/deployment-order.yaml",
      "text": "ds_on:\n    - 30-compute/01-ecr\n    reasoning: \"O cluster do ECS (Elastic Container Service) depende do ECR, pois\\\n      \\ as tarefas e servi\\xE7os do ECS precisam ter acesso \\xE0s imagens de cont\\xEA\\\n      ineres armazenadas no ECR.\"\n  30-compute/03-ecs-task-service:\n    depends_on:\n    - 30-compute/02-ecs-cluster\n    reasoning: \"As tarefas e servi\\xE7os do ECS dependem do cluster do ECS, pois eles\\\n      \\ s\\xE3o implantados e executados dentro do cluster.\"\n  30-compute/04-ecs-autoscaling:\n    depends_on:\n    - 30-compute/03-ecs-task-service\n    reasoning: \"O autoscaling do ECS depende das tarefas e servi\\xE7os do ECS, pois\\\n      \\ \\xE9 respons\\xE1vel por dimensionar automaticamente esses recursos com base\\\n      \\ na demanda.\"\n  30-compute/05-alb:\n    depends_on:\n    - 30-compute/03-ecs-task-service\n    reasoning: \"O Application Load Balancer (ALB) depende dos servi\\xE7os do ECS,\\\n      \\ pois ele \\xE9 respons\\xE1vel por rotear o tr\\xE1fego para os cont\\xEAineres\\\n      \\ implantados no ECS.\"\n  50-application/01-lambda-functions:\n    depends_on:\n    - 10-security/01-kms-security\n    - 10-security/03-secrets-manager\n    reasoning: \"As fun\\xE7\\xF5es Lambda dependem das chaves do KMS (Key Management\\\n      \\ Service) para criptografia e do Secrets Manager para acessar segredos.\"\n  50-application/02-step-functions:\n    depends_on:\n    - 50-application/01-lambda-functions\n    reasoning: \"As AWS Step Functions dependem das fun\\xE7\\xF5es Lambda, pois elas\\\n      \\ podem chamar e orquestrar essas fun\\xE7\\xF5es como parte de seus fluxos de\\\n      \\ trabalho.\"\n  50-application/03-sns-topics:\n    depends_on: []\n    reasoning: \"Os t\\xF3picos do SNS (Simple Notification Service) n\\xE3o dependem\\\n      \\ de nenhuma outra fase, pois s\\xE3o um servi\\xE7o independente que fornece\\\n      \\ publica\\xE7\\xE3o e assinatura de mensagens.\"\n  50-application/04-parameter-store:\n    depends_on:\n    - 10-security/03-secrets-manager\n    reasoning: O Parameter Store depende do Secrets Manage"
    },
    {
      "source": "phases/deployment-order.yaml",
      "text": "r, pois ele pode ser usado\n      para armazenar segredos de maneira segura.\n  20-network/01-networking:\n    depends_on: []\n    reasoning: \"A configura\\xE7\\xE3o da rede, incluindo VPC, subnets e security groups,\\\n      \\ n\\xE3o depende de nenhuma outra fase, pois \\xE9 um pr\\xE9-requisito para a\\\n      \\ maioria dos recursos da AWS.\"\n  20-network/02-vpc-flow-logs:\n    depends_on:\n    - 20-network/01-networking\n    reasoning: \"Os logs de fluxo da VPC dependem da rede configurada, pois eles capturam\\\n      \\ o tr\\xE1fego de rede dentro da VPC.\"\n  70-ai-ml/01-rag-s3-tables:\n    depends_on:\n    - 40-data/05-s3-storage\n    reasoning: As tabelas do S3 para o Retrieval and Generation (RAG) dependem do\n      bucket do S3 configurado na fase de armazenamento de dados.\n  60-observability/01-enhanced-observability:\n    depends_on: []\n    reasoning: \"A configura\\xE7\\xE3o da observabilidade aprimorada n\\xE3o depende\\\n      \\ de nenhuma outra fase, pois \\xE9 um conjunto de servi\\xE7os independentes,\\\n      \\ como CloudWatch, X-Ray e Datadog.\"\n  60-observability/02-observability:\n    depends_on:\n    - 60-observability/01-enhanced-observability\n    reasoning: \"A observabilidade geral depende da configura\\xE7\\xE3o da observabilidade\\\n      \\ aprimorada, pois se baseia nessa infraestrutura para coletar, armazenar e\\\n      \\ analisar os dados de observabilidade.\"\n  60-observability/03-drift-detection:\n    depends_on:\n    - 60-observability/02-observabilidade\n    reasoning: \"A detec\\xE7\\xE3o de desvio depende da observabilidade configurada,\\\n      \\ pois utiliza os dados coletados e armazenados para identificar mudan\\xE7as\\\n      \\ indesejadas na infraestrutura.\"\n  90-governance/01-well-architected-assessment:\n    depends_on: []\n    reasoning: \"A avalia\\xE7\\xE3o da arquitetura bem-planejada n\\xE3o depende de nenhuma\\\n      \\ outra fase, pois \\xE9 um processo independente de revis\\xE3o e valida\\xE7\\xE3\\\n      o da arquitetura.\"\n  90-governance/02-budgets-resources:\n    depends_on: []\n    "
    },
    {
      "source": "phases/deployment-order.yaml",
      "text": "reasoning: \"A configura\\xE7\\xE3o de or\\xE7amentos e recursos n\\xE3o depende de\\\n      \\ nenhuma outra fase, pois \\xE9 um servi\\xE7o independente para gerenciar e\\\n      \\ controlar os custos da AWS.\"\n  90-governance/03-cost-guardrails:\n    depends_on:\n    - 90-governance/02-budgets-resources\n    reasoning: \"As guardrails de custo dependem da configura\\xE7\\xE3o de or\\xE7amentos\\\n      \\ e recursos, pois eles se baseiam nesses dados para implementar controles de\\\n      \\ custo e limites.\"\n  90-governance/04-cost-performance-dashboard:\n    depends_on:\n    - 90-governance/02-budgets-resources\n    - 60-observability/02-observabilidade\n    reasoning: \"O painel de desempenho e custo depende tanto dos dados de or\\xE7amentos\\\n      \\ e recursos quanto da observabilidade configurada, pois precisa dessas informa\\xE7\\\n      \\xF5es para fornecer uma vis\\xE3o geral do desempenho e dos custos.\"\n  00-foundation/01-dynamodb-state:\n    depends_on:\n    - 40-data/04-dynamodb-tables\n    reasoning: O estado do DynamoDB depende das tabelas do DynamoDB configuradas na\n      fase de dados.\n  00-foundation/02-logging-infrastructure:\n    depends_on:\n    - 20-network/02-vpc-flow-logs\n    reasoning: \"A infraestrutura de registro (logging) depende dos logs de fluxo da\\\n      \\ VPC, pois eles fornecem informa\\xE7\\xF5es importantes sobre o tr\\xE1fego de\\\n      \\ rede.\"\n  00-foundation/03-reconciliation-engine:\n    depends_on:\n    - 00-foundation/01-dynamodb-state\n    reasoning: \"O mecanismo de reconcilia\\xE7\\xE3o depende do estado do DynamoDB,\\\n      \\ pois ele usa esse armazenamento para manter o estado da reconcilia\\xE7\\xE3\\\n      o.\"\n  00-foundation/04-backup-strategy:\n    depends_on: []\n    reasoning: \"A estrat\\xE9gia de backup n\\xE3o depende de nenhuma outra fase, pois\\\n      \\ \\xE9 um processo independente de prote\\xE7\\xE3o e recupera\\xE7\\xE3o de dados.\"\n  00-foundation/05-chaos-engineering:\n    depends_on: []\n    reasoning: \"A engenharia de caos n\\xE3o depende de nenhuma outra fase, pois \\x"
    },
    {
      "source": "phases/deployment-order.yaml",
      "text": "E9\\\n      \\ uma abordagem independente para testar a resili\\xEAncia da aplica\\xE7\\xE3\\\n      o.\"\n  00-foundation/06-reconciliation-wrapper:\n    depends_on:\n    - 00-foundation/03-reconciliation-engine\n    reasoning: \"O wrapper de reconcilia\\xE7\\xE3o depende do mecanismo de reconcilia\\xE7\\\n      \\xE3o, pois \\xE9 uma camada adicional que se baseia nele para fornecer funcionalidades\\\n      \\ de reconcilia\\xE7\\xE3o.\"\n  00-foundation/07-conversation-memory:\n    depends_on:\n    - 40-data/01-redis\n    reasoning: \"A mem\\xF3ria de conversa\\xE7\\xE3o depende do Redis configurado na\\\n      \\ fase de dados, pois ele \\xE9 usado para armazenar e gerenciar o estado das\\\n      \\ conversa\\xE7\\xF5es.\"\n  40-data/01-redis:\n    depends_on:\n    - 20-network/01-networking\n    reasoning: \"O Redis depende da rede configurada, pois ele \\xE9 um servi\\xE7o que\\\n      \\ precisa ser implantado em uma VPC e em subnets espec\\xEDficas.\"\n  40-data/02-aurora-postgresql:\n    depends_on:\n    - 20-network/01-networking\n    - 10-security/01-kms-security\n    reasoning: \"O Aurora PostgreSQL depende da rede configurada e das chaves do KMS,\\\n      \\ pois ele \\xE9 implantado em uma VPC e pode usar o KMS para criptografia de\\\n      \\ dados em repouso.\"\n  40-data/03-aurora-postgresql-secure:\n    depends_on:\n    - 40-data/02-aurora-postgresql\n    reasoning: \"O Aurora PostgreSQL seguro depende da configura\\xE7\\xE3o do Aurora\\\n      \\ PostgreSQL base, pois adiciona camadas de seguran\\xE7a adicionais a esse recurso.\"\n  40-data/04-dynamodb-tables:\n    depends_on:\n    - 20-network/01-networking\n    reasoning: \"As tabelas do DynamoDB dependem da rede configurada, pois elas s\\xE3\\\n      o implantadas em uma VPC e precisam de subnets e seguran\\xE7a de rede.\"\n  40-data/05-s3-storage:\n    depends_on:\n    - 20-network/01-networking\n    reasoning: \"O armazenamento do S3 depende da rede configurada, pois os acessos\\\n      \\ ao S3 podem ser restringidos por meio de pol\\xEDticas de rede.\"\n  10-security/01-kms-security:\n    depe"
    },
    {
      "source": "phases/deployment-order.yaml",
      "text": "nds_on: []\n    reasoning: \"A seguran\\xE7a do KMS n\\xE3o depende de nenhuma outra fase, pois \\xE9\\\n      \\ um servi\\xE7o independente de criptografia de chaves.\"\n  10-security/02-security-services:\n    depends_on:\n    - 20-network/01-networking\n    reasoning: \"Os servi\\xE7os de seguran\\xE7a, como AWS GuardDuty, AWS Config e AWS\\\n      \\ Security Hub, dependem da rede configurada, pois monitoram e avaliam os recursos\\\n      \\ da AWS dentro da VPC.\"\n  10-security/03-secrets-manager:\n    depends_on:\n    - 10-security/01-kms-security\n    reasoning: O Secrets Manager depende das chaves do KMS, pois usa o KMS para criptografar\n      e descriptografar os segredos armazenados.\n  10-security/04-iam-roles:\n    depends_on: []\n    reasoning: \"As fun\\xE7\\xF5es do IAM n\\xE3o dependem de nenhuma outra fase, pois\\\n      \\ s\\xE3o um servi\\xE7o independente de gerenciamento de identidades e acesso.\"\n  10-security/05-iam-bedrock-github:\n    depends_on:\n    - 10-security/04-iam-roles\n    reasoning: \"A integra\\xE7\\xE3o do IAM com o Bedrock GitHub depende das fun\\xE7\\\n      \\xF5es do IAM configuradas, pois precisa desses recursos para permitir o acesso\\\n      \\ e as permiss\\xF5es necess\\xE1rias.\"\n  10-security/06-waf-cloudfront:\n    depends_on:\n    - 20-network/01-networking\n    reasoning: \"O WAF do CloudFront depende da rede configurada, pois o CloudFront\\\n      \\ \\xE9 implantado em uma VPC e precisa de subnets e seguran\\xE7a de rede.\"\ndag_validation:\n  is_valid: true\n  has_cycles: false\n  total_nodes: 37\n  total_edges: 28\n"
    },
    {
      "source": "phases/deployment-workloads.yaml",
      "text": "metadata:\n  name: \"IAL Workloads Deployment Order\"\n  description: \"Deployment sequence for user workload infrastructure components\"\n  version: \"1.0\"\n  created: \"2025-11-03\"\n  total_phases: 28\n  deployment_type: \"workloads\"\n\nexecution_order:\n  - 10-security/01-kms-security\n  - 10-security/04-iam-roles\n  - 20-network/01-networking\n  - 20-network/02-vpc-flow-logs\n  - 40-data/01-redis\n  - 40-data/04-dynamodb-tables\n  - 40-data/05-s3-storage\n  - 10-security/02-security-services\n  - 10-security/03-secrets-manager\n  - 10-security/05-iam-bedrock-github\n  - 10-security/06-waf-cloudfront\n  - 30-compute/01-ecr\n  - 30-compute/02-ecs-cluster\n  - 30-compute/03-ecs-task-service\n  - 30-compute/04-ecs-autoscaling\n  - 30-compute/05-alb\n  - 40-data/02-aurora-postgresql\n  - 40-data/03-aurora-postgresql-secure\n  - 50-application/01-lambda-functions\n  - 50-application/03-sns-topics\n  - 50-application/04-parameter-store\n  - 60-observability/01-enhanced-observability\n  - 60-observability/02-observability\n  - 60-observability/03-drift-detection\n  - 70-ai-ml/01-rag-s3-tables\n  - 90-governance/01-well-architected-assessment\n  - 90-governance/02-budgets-resources\n  - 90-governance/03-cost-guardrails\n  - 90-governance/04-cost-performance-dashboard\n\ndependencies:\n  30-compute/01-ecr:\n    depends_on: []\n    reasoning: \"ECR is independent and provides container registry\"\n  30-compute/02-ecs-cluster:\n    depends_on: [30-compute/01-ecr]\n    reasoning: \"ECS cluster depends on ECR for container images\"\n  30-compute/03-ecs-task-service:\n    depends_on: [30-compute/02-ecs-cluster]\n    reasoning: \"ECS tasks and services depend on ECS cluster\"\n  30-compute/04-ecs-autoscaling:\n    depends_on: [30-compute/03-ecs-task-service]\n    reasoning: \"ECS autoscaling depends on ECS tasks and services\"\n  30-compute/05-alb:\n    depends_on: [30-compute/03-ecs-task-service]\n    reasoning: \"ALB depends on ECS services for routing traffic\"\n  50-application/01-lambda-functions:\n    depends_on: [10-security/01-kms-security, "
    },
    {
      "source": "phases/deployment-workloads.yaml",
      "text": "10-security/03-secrets-manager]\n    reasoning: \"Lambda functions depend on KMS and Secrets Manager\"\n  50-application/03-sns-topics:\n    depends_on: []\n    reasoning: \"SNS topics are independent messaging service\"\n  50-application/04-parameter-store:\n    depends_on: [10-security/03-secrets-manager]\n    reasoning: \"Parameter Store depends on Secrets Manager\"\n  20-network/01-networking:\n    depends_on: []\n    reasoning: \"Networking is prerequisite for most AWS resources\"\n  20-network/02-vpc-flow-logs:\n    depends_on: [20-network/01-networking]\n    reasoning: \"VPC flow logs depend on configured network\"\n  70-ai-ml/01-rag-s3-tables:\n    depends_on: [40-data/05-s3-storage]\n    reasoning: \"RAG S3 tables depend on S3 storage configuration\"\n  60-observability/01-enhanced-observability:\n    depends_on: []\n    reasoning: \"Enhanced observability is independent service set\"\n  60-observability/02-observability:\n    depends_on: [60-observability/01-enhanced-observability]\n    reasoning: \"General observability depends on enhanced observability\"\n  60-observability/03-drift-detection:\n    depends_on: [60-observability/02-observability]\n    reasoning: \"Drift detection depends on configured observability\"\n  90-governance/01-well-architected-assessment:\n    depends_on: []\n    reasoning: \"Well-architected assessment is independent review process\"\n  90-governance/02-budgets-resources:\n    depends_on: []\n    reasoning: \"Budget configuration is independent cost management service\"\n  90-governance/03-cost-guardrails:\n    depends_on: [90-governance/02-budgets-resources]\n    reasoning: \"Cost guardrails depend on budget configuration\"\n  90-governance/04-cost-performance-dashboard:\n    depends_on: [90-governance/02-budgets-resources, 60-observability/02-observability]\n    reasoning: \"Cost performance dashboard depends on budget data and observability\"\n  40-data/01-redis:\n    depends_on: [20-network/01-networking]\n    reasoning: \"Redis depends on configured network\"\n  40-data/02-aurora-postgresql"
    },
    {
      "source": "phases/deployment-workloads.yaml",
      "text": ":\n    depends_on: [20-network/01-networking, 10-security/01-kms-security]\n    reasoning: \"Aurora PostgreSQL depends on network and KMS\"\n  40-data/03-aurora-postgresql-secure:\n    depends_on: [40-data/02-aurora-postgresql]\n    reasoning: \"Secure Aurora PostgreSQL depends on base Aurora configuration\"\n  40-data/04-dynamodb-tables:\n    depends_on: [20-network/01-networking]\n    reasoning: \"DynamoDB tables depend on configured network\"\n  40-data/05-s3-storage:\n    depends_on: [20-network/01-networking]\n    reasoning: \"S3 storage depends on configured network\"\n  10-security/01-kms-security:\n    depends_on: []\n    reasoning: \"KMS security is independent encryption key service\"\n  10-security/02-security-services:\n    depends_on: [20-network/01-networking]\n    reasoning: \"Security services depend on configured network\"\n  10-security/03-secrets-manager:\n    depends_on: [10-security/01-kms-security]\n    reasoning: \"Secrets Manager depends on KMS for encryption\"\n  10-security/04-iam-roles:\n    depends_on: []\n    reasoning: \"IAM roles are independent identity and access management\"\n  10-security/05-iam-bedrock-github:\n    depends_on: [10-security/04-iam-roles]\n    reasoning: \"Bedrock GitHub IAM integration depends on configured IAM roles\"\n  10-security/06-waf-cloudfront:\n    depends_on: [20-network/01-networking]\n    reasoning: \"WAF CloudFront depends on configured network\"\n"
    },
    {
      "source": "schemas/phase.schema.json",
      "text": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"title\": \"IAL Phase Schema\",\n  \"type\": \"object\",\n  \"required\": [\"apiVersion\", \"kind\", \"metadata\", \"spec\"],\n  \"properties\": {\n    \"apiVersion\": {\n      \"type\": \"string\",\n      \"enum\": [\"ial/v1\"]\n    },\n    \"kind\": {\n      \"type\": \"string\",\n      \"enum\": [\"Phase\"]\n    },\n    \"metadata\": {\n      \"type\": \"object\",\n      \"required\": [\"name\", \"domain\", \"priority\", \"wa_pillars\"],\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"pattern\": \"^[0-9]{2}-[a-z0-9-]+$\"\n        },\n        \"domain\": {\n          \"type\": \"string\"\n        },\n        \"priority\": {\n          \"type\": \"integer\",\n          \"minimum\": 1,\n          \"maximum\": 1000\n        },\n        \"wa_pillars\": {\n          \"type\": \"array\",\n          \"minItems\": 3,\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"spec\": {\n      \"type\": \"object\",\n      \"required\": [\"description\", \"parameters\", \"artifacts\"],\n      \"properties\": {\n        \"description\": {\n          \"type\": \"string\",\n          \"minLength\": 10\n        },\n        \"parameters\": {\n          \"type\": \"object\"\n        },\n        \"prerequisites\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"artifacts\": {\n          \"type\": \"object\",\n          \"required\": [\"cloudformation\"],\n          \"properties\": {\n            \"cloudformation\": {\n              \"type\": \"object\",\n              \"required\": [\"template\"],\n              \"properties\": {\n                \"template\": {\n                  \"type\": \"string\"\n                },\n                \"parameters_file\": {\n                  \"type\": \"string\"\n                },\n                \"policies\": {\n                  \"type\": \"array\",\n                  \"items\": {\n                    \"type\": \"string\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"controls\": {\n      \"type\": \"object\",\n"
    },
    {
      "source": "schemas/phase.schema.json",
      "text": "      \"properties\": {\n        \"security\": {\n          \"type\": \"object\"\n        },\n        \"cost\": {\n          \"type\": \"object\"\n        },\n        \"reliability\": {\n          \"type\": \"object\"\n        },\n        \"tagging\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"required\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    },\n    \"outputs_contract\": {\n      \"type\": \"object\",\n      \"required\": [\"must_exist\"],\n      \"properties\": {\n        \"must_exist\": {\n          \"type\": \"array\",\n          \"minItems\": 1,\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"must_be_encrypted\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"tags_must_include\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"tests\": {\n      \"type\": \"object\",\n      \"required\": [\"lint\", \"acceptance\"],\n      \"properties\": {\n        \"lint\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"acceptance\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"natural_validation\": {\n              \"type\": \"object\",\n              \"required\": [\"prompts\", \"llm_provider\"],\n              \"properties\": {\n                \"prompts\": {\n                  \"type\": \"array\",\n                  \"items\": {\n                    \"type\": \"string\"\n                  }\n                },\n                \"llm_provider\": {\n                  \"type\": \"string\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"gitops\": {\n      \"type\": \"object\",\n      \"required\": [\"repo\", \"base_branch\", \"require_reviews\", \"required_checks\"],\n      \"properties\": {\n        \"repo\": {\n          \"type\": \"string\"\n        },\n        \"base_branch\": {\n          \"t"
    },
    {
      "source": "schemas/phase.schema.json",
      "text": "ype\": \"string\"\n        },\n        \"require_reviews\": {\n          \"type\": \"boolean\"\n        },\n        \"required_checks\": {\n          \"type\": \"array\",\n          \"minItems\": 4,\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    }\n  }\n}\n"
    },
    {
      "source": "templates/control/feature_flags.yaml",
      "text": "AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'IAL Feature Flags Table with TTL for Drift Control'\n\nParameters:\n  ProjectName:\n    Type: String\n    Default: 'ial'\n    Description: 'Project name for resource naming'\n  \n  Environment:\n    Type: String\n    Default: 'dev'\n    Description: 'Environment (dev, staging, prod)'\n\nResources:\n  # DynamoDB Table for Feature Flags\n  FeatureFlagsTable:\n    Type: AWS::DynamoDB::Table\n    Properties:\n      TableName: !Sub '${ProjectName}-feature-flags-${Environment}'\n      BillingMode: PAY_PER_REQUEST\n      AttributeDefinitions:\n        - AttributeName: scope\n          AttributeType: S\n        - AttributeName: flag_name\n          AttributeType: S\n        - AttributeName: created_timestamp\n          AttributeType: N\n      KeySchema:\n        - AttributeName: scope\n          KeyType: HASH\n        - AttributeName: flag_name\n          KeyType: RANGE\n      TimeToLiveSpecification:\n        AttributeName: expire_at\n        Enabled: true\n      GlobalSecondaryIndexes:\n        - IndexName: flag-history-index\n          KeySchema:\n            - AttributeName: flag_name\n              KeyType: HASH\n            - AttributeName: created_timestamp\n              KeyType: RANGE\n          Projection:\n            ProjectionType: ALL\n      PointInTimeRecoverySpecification:\n        PointInTimeRecoveryEnabled: true\n      Tags:\n        - Key: Name\n          Value: !Sub '${ProjectName}-feature-flags-${Environment}'\n        - Key: Project\n          Value: !Ref ProjectName\n        - Key: Environment\n          Value: !Ref Environment\n        - Key: Component\n          Value: 'drift-control'\n        - Key: 'ial:managed'\n          Value: 'true'\n\n  # IAM Role for Lambda access to Feature Flags\n  FeatureFlagsAccessRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub '${ProjectName}-feature-flags-access-${Environment}'\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:"
    },
    {
      "source": "templates/control/feature_flags.yaml",
      "text": "\n              Service: \n                - lambda.amazonaws.com\n                - ecs-tasks.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n      Policies:\n        - PolicyName: FeatureFlagsTableAccess\n          PolicyDocument:\n            Version: '2012-10-17'\n            Statement:\n              - Effect: Allow\n                Action:\n                  - dynamodb:GetItem\n                  - dynamodb:PutItem\n                  - dynamodb:UpdateItem\n                  - dynamodb:DeleteItem\n                  - dynamodb:Query\n                  - dynamodb:Scan\n                Resource: \n                  - !GetAtt FeatureFlagsTable.Arn\n                  - !Sub '${FeatureFlagsTable.Arn}/index/*'\n\n  # CloudWatch Log Group for Feature Flags operations\n  FeatureFlagsLogGroup:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub '/aws/ial/${ProjectName}/feature-flags/${Environment}'\n      RetentionInDays: 30\n\nOutputs:\n  FeatureFlagsTableName:\n    Description: 'Name of the Feature Flags DynamoDB table'\n    Value: !Ref FeatureFlagsTable\n    Export:\n      Name: !Sub '${ProjectName}-feature-flags-table-${Environment}'\n\n  FeatureFlagsTableArn:\n    Description: 'ARN of the Feature Flags DynamoDB table'\n    Value: !GetAtt FeatureFlagsTable.Arn\n    Export:\n      Name: !Sub '${ProjectName}-feature-flags-table-arn-${Environment}'\n\n  FeatureFlagsAccessRoleArn:\n    Description: 'ARN of the Feature Flags access role'\n    Value: !GetAtt FeatureFlagsAccessRole.Arn\n    Export:\n      Name: !Sub '${ProjectName}-feature-flags-role-arn-${Environment}'\n\n  FeatureFlagsLogGroupName:\n    Description: 'Name of the Feature Flags log group'\n    Value: !Ref FeatureFlagsLogGroup\n    Export:\n      Name: !Sub '${ProjectName}-feature-flags-logs-${Environment}'\n"
    },
    {
      "source": "templates/prompt_phase_template.yaml",
      "text": "apiVersion: ial/v1\nkind: Phase\nmetadata:\n  name: \"{{cookiecutter.phase_number}}-{{cookiecutter.phase_name}}\"\n  domain: \"{{cookiecutter.domain}}\"\n  priority: \"{{cookiecutter.priority}}\"\n  wa_pillars: [security, reliability, cost-optimization, operational-excellence]\nspec:\n  description: \"{{cookiecutter.description}}\"\n  parameters:\n    env: \"${ENVIRONMENT}\"\n    region: \"${AWS_DEFAULT_REGION}\"\n    cidr_block: \"{{cookiecutter.vpc_cidr | default('10.0.0.0/16')}}\"\n    az_count: \"{{cookiecutter.availability_zones | default(2)}}\"\n    nat_gateways: \"{{cookiecutter.nat_gateways | default(1)}}\"\n  prerequisites: []\n  artifacts:\n    cloudformation:\n      template: \"templates/{{cookiecutter.domain}}/{{cookiecutter.template_name}}.yaml\"\n      parameters_file: \"params/{{cookiecutter.domain}}/{{cookiecutter.template_name}}-${ENVIRONMENT}.json\"\n      policies:\n        - \"policies/cfn-guard/{{cookiecutter.domain}}.guard\"\n        - \"policies/opa/{{cookiecutter.domain}}.rego\"\ncontrols:\n  security:\n    block_sg_0_0_0_0_0: true\n    enforce_kms_for_logs: true\n  cost:\n    max_monthly_usd: \"{{cookiecutter.max_monthly_cost | default(50)}}\"\n    fail_if_estimate_exceeds: true\n  reliability:\n    require_multi_az: true\n  tagging:\n    required: [\"ial:managed\", \"env:${ENVIRONMENT}\"]\noutputs_contract:\n  must_exist: [\"{{cookiecutter.required_outputs}}\"]\n  must_be_encrypted: [\"{{cookiecutter.encrypted_outputs}}\"]\n  tags_must_include: [\"ial:managed\", \"env:${ENVIRONMENT}\"]\ntests:\n  lint: [cfn-lint, conftest, cfn-guard]\n  acceptance:\n    natural_validation:\n      prompts:\n        - \"{{cookiecutter.validation_prompt}}\"\n      llm_provider: \"${LLM_PROVIDER | default('bedrock')}\"\ngitops:\n  repo: \"${GITHUB_REPOSITORY}\"\n  base_branch: \"${GITHUB_BASE_REF | default('main')}\"\n  require_reviews: true\n  required_checks: [\"lint\", \"policy\", \"plan\", \"apply\", \"post-deploy\"]\npost_deploy:\n  mcp_handlers:\n    - mcp: \"well-architected-mcp\"\n      tool: \"review_workload\"\n      params: { workloadId: \"${metadata.name}\" }\n"
    }
  ]
}